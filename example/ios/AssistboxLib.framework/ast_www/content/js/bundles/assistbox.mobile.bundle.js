!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){"use strict";function o(e,t,n,o,r,i){t.showWaitingPage(n.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE")),"true"===o.getAndRemove("redirectToMainApplication")?(i.showErrorToastr(n.instant("ASSISTBOX_UNEXPECTED_ERROR")),r((function(){AssistBoxRedirection.goBackToMainApplication(null,null,null)}),2e3)):t.removeWaitingPage()}o.$inject=["$scope","$rootScope","$translate","LocalStorageUtil","$timeout","ToastrService"],e.exports=o},function(e,t){function n(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h,m,a){e.user=i.currentUser,e.isExpertUser=!1,e.activateUser=i.activateUser,e.isDestroyed=!1,e.hiddenComponentsChecked=!1,e.hiddenComponents=[],o.removeWaitingPage(),e.isMeetingStarted=!1,e.meetingResult={};let v=!1;e.participants=[];var S,y=!1;e.companyId=e.user.companyId;e.user.room;e.onlineUsers=l.onlineUsers;let C=ParticipationType();e.meetingLobbyEnabled=!1,e.isMeetingEnded=!1,a.getConfigurationsByTypeAndCompanyId("MEETING",e.user.companyId).then(t=>{t.data.SHOW_RESULT_MODAL&&"T"==t.data.SHOW_RESULT_MODAL&&(v=!0,d("SurveyResultController",{$scope:e}))}),d("ChatController",{$scope:e}),d("VideoCallCommonController",{$scope:e}),e.getHiddenComponents("mobileClient"),e.updateVideoPosition=function(){o.$broadcast("updateVideoPosition")};let I=function(){$(".loading").remove(),$(".loadingSpan").html(u.instant("ASSISTBOX_HANGUP")),f((function(){e.stopMeeting()}),2500)},b=function(){const e=h.getIsNotificationBased();return null==e||"true"!=e.toLowerCase()||0!=l.getOnlineUsers().length||(p.warn("notification based call, no one is present in the room"),I(),!1)};e.joinMeeting=function(){p.info("joinMeeting"),$("#lobbyScreen").length&&$("#lobbyScreen").remove(),$("#videoDiv").append(r("<div class='loading'>Loading&#8230;</div>")(e)),$("#videoDiv").append(r(" <div  class='loadingSpinner'><span class='loadingSpan'> "+u.instant("ASSISTBOX_WAITING_CLAIM_HANDLER")+"</span></div>")(e)),T()},document.addEventListener("deviceready",(function(){p.info("ClientController deviceready"),"browser"!=cordova.platformId&&chrome.power.requestKeepAwake("display"),"android"==cordova.platformId||"ios"==cordova.platformId?e.initOrientationChangeListener():window.screen.orientation.lock("landscape"),$("#clientIonContent").length?($("#clientIonContent").append(r("<video-view></video-view>")(o)),b()&&a.getConfigurationsByTypeAndCompanyId("MEETING",e.companyId).then(t=>{t.data.SHOW_LOBBY_PAGE&&"T"==t.data.SHOW_LOBBY_PAGE&&(e.meetingLobbyEnabled=!0),p.info("Meeting lobby page is "+(e.meetingLobbyEnabled?"enabled":"disabled")),cordova.plugins.phonertc.setMeetingLobbyEnabled(e.meetingLobbyEnabled),function(){let e=sessionStorage.getItem("camera");null!=e&&null!=e||(e="front");var t=m.defer();"android"==cordova.platformId?(o.showWaitingPage(u.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE")),cordova.plugins.phonertc.checkCameraAvailability((function(){p.info("ClientController checkCameraAvailability success "),o.removeWaitingPage(),t.resolve()}),(function(){p.error("ClientController checkCameraAvailability error "),o.removeWaitingPage(),t.reject()}),e)):t.resolve();return t.promise}().then((function(){e.meetingLobbyEnabled?($("#videoDiv").append(r("<div id='lobbyScreen' class='lobby-container'><div class='lobby-title'>"+u.instant("ASSISTBOX_LOBBY_PAGE_TITLE")+"</div><div class='lobby-text'>"+u.instant("ASSISTBOX_LOBBY_PAGE_TEXT")+"</div><div class='lobby-button'><button id='joinMeetingButton' ng-click='joinMeeting()' class='button btn-blue'>"+u.instant("ASSISTBOX_LBL_JOIN_MEETING")+"&nbsp;<i class='fas fa-sign-in-alt'/></button></div></div>")(e)),e.updateVideoPosition(),cordova.plugins.phonertc.initializeLocalTracks(!0,!0),cordova.plugins.phonertc.showLocalVideoView()):e.joinMeeting()})).catch((function(){"android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera(),g.showToastrLongTop(u.instant("ASSISTBOX_CANNOT_OPEN_CAMERA")),I()}))})):p.error("#clientIonContent not defined.")}),!1);var T=function(){p.info("activateUser"),e.activateUser&&(p.info("activating user"),l.activateUser(e.user))};o.$on("activateUser",(function(t,n){p.info("onActivateUser: "+n.fullName),e.isMeetingStarted||navigator.notification.beep(1)})),o.$on("offlineUser",(function(e,t){p.info("onOfflineUser: "+t.fullName),b()})),o.$on("inactivateUser",(function(e,t){p.info("onInactivateUser: "+t.fullName),b()})),e.stopMeeting=function(){E(),isMeetingStopped=!0,l.endCall(),p.info("stopMeeting")},e.$on("triggerRemoteAction",(function(t,n){var o=n.remoteActionRequestMessage,r=n.callBack;switch(p.info("triggerRemoteAction",o),o.type){case"triggerCapturePhoto":A(o,r);break;case"changeCameraDirection":e.changeCameraDirection();break;case"getNetworkStats":S&&clearInterval(S),w(o,r);break;default:console.log("Process function is not found for remote action: "+o.type)}})),e.$on("changeTrackType",(function(e,t){var n=t.trackType;cordova.plugins.phonertc.changeTrackType(n),p.info("switchStreams",t)}));var w=function(t,n){console.log("in get network stats");var o=t.type,r=function(t){var r={type:o,status:"success",speed:t,user:e.user};n(r)},i=function(e){console.log(e),n({type:o,status:"error",error:e})};S=setInterval((function(){cordova.plugins.phonertc.getNetworkStats(r,i)}),5e3),cordova.plugins.phonertc.getNetworkStats(r,i)},A=function(t,n){var o=t.type,r=function(){n({type:o,status:"success"}),e.openChatModal(),p.info("triggerCapturePhoto success")},i=function(e){n({type:o,status:"error",error:e}),p.error("triggerCapturePhoto error",e)},a=u.instant("ASSISTBOX_CAPTURE_PHOTO_CONFIRMATION_TITLE"),s=u.instant("ASSISTBOX_CAPTURE_PHOTO_CONFIRMATION"),c=u.instant("ASSISTBOX_APPROVE"),l=u.instant("ASSISTBOX_APPROVE_AND_REMEMBER"),d=u.instant("ASSISTBOX_DENY");y?e.triggerChatPhotoCapture(r,i):navigator.notification.confirm(s,(function(t){if(1==t)e.triggerChatPhotoCapture(r,i),p.info("triggerCapturePhoto approve");else if(2==t)y=!0,e.triggerChatPhotoCapture(r,i),p.info("triggerCapturePhoto approveAndRemember");else{p.error("triggerCapturePhoto reject"),i("remote_action_rejected")}}),a,[c,l,d])};e.openChatModal=function(){e.openChatWithCallback((function(){cordova.plugins.phonertc.hideVideoView()}),-1),p.info("openChatModal")},e.closeChatModal=function(){e.isChatModelOpen&&(e.closeChatWithCallback((function(){f((function(){cordova.plugins.phonertc.showVideoView(e.videoStatus)}),250)})),p.info("closeChatModal"))},e.$on("$destroy",(function(){e.isDestroyed||(e.isDestroyed=!0,sessionStorage.setItem("camera","Front"),p.info("client controller destroy"),p.clearLogLevelAndCurrentUser(),s.clear(),"true"===c.retrieve("redirectToMainApplication")?(c.remove("redirectToMainApplication"),AssistBoxRedirection.goBackToMainApplication(null,null,null)):n.go("mainPage",{location:"replace"}))}));var E=function(){e.meetingEndTime=new Date,clearInterval(e.saveMeetingIntervalId)};e.$on("endMeeting",(function(t,n){S&&clearInterval(S),l.disconnectCurrentUserSocket(),cordova.plugins.Keyboard.close(),e.isMeetingEnded||(e.isMeetingEnded=!0,n.endCallInitiatior||E(),e.isMeetingStarted?e.saveMeetingResult(C.PARTICIPANT).then((function(t){p.info("saveMeetingResult when meeting ended. id: "+t.id+" meetingStartDate: "+t.meetingStartedDate+" meetingCompletedDate: "+t.meetingCompletedDate),v&&e.meetingResult&&e.meetingResult.id?(e.closeChatModal(),cordova.plugins.phonertc.closeInAppBrowser(),e.openSurveyResultModal(!e.isExpertUser,(function(){e.$broadcast("$destroy")}))):e.$broadcast("$destroy")})).catch((function(t){e.$broadcast("$destroy")})).finally((function(){e.meetingEndTime,e.meetingStartTime=0})):e.$broadcast("$destroy"),e.isMeetingStarted=!1,cordova.plugins.phonertc.removeLocalViewAndTracks())}));let _=function(t){let n={};n.fromUser=e.user,n.value=t,l.sendBlurMessage(n)};e.$on("appPaused",(function(t,n){p.info("appPaused on client"),e.stopCapture(),l.callInProgress&&cordova.plugins.phonertc.startOngoingCallNotification(u.instant("ASSISTBOX_RETURN_TO_VIDEO_MEETING"))})),e.$on("appResume",(function(){p.info("appResume on client"),e.startCapture(),cordova.plugins.phonertc.stopOngoingCallNotification()})),e.$on("incomingCall",(function(t,n){e.closeChatModal(),R(n)})),e.$on("destroyLockIsActive",(function(e,t){g.showToastrLongTop(u.instant("ASSISTBOX_CANNOT_OPEN_CAMERA"))}));var R=function(t){e.caller=t,e.answerIncomingCall(!0)};e.answerIncomingCall=function(t){t?l.answerCall(e.caller,!0):l.ignoreCall(e.caller)},e.$on("callAnswered",(function(t,n){e.isMeetingStarted||O(),p.info("ClientController startMeeting")}));let O=function(){e.isMeetingStarted=!0,e.saveMeetingResultWhenMeetingStarted(C.PARTICIPANT),cordova.plugins.phonertc.closeInAppBrowser(),e.closeChatModal(),e.meetingLobbyEnabled&&l.renegotiate(e.audioStatus,e.videoStatus)};e.$on("hideIncomingCallDialog",(function(e,t){P()}));var P=function(){$("#incomingCallModal").css("visibility","hidden"),e.caller=null};e.stopCapture=function(){cordova.plugins.phonertc.stopCapture(),_(!0)},e.startCapture=function(){cordova.plugins.phonertc.startCapture(e.videoStatus),_(!1)}}n.$inject=["$scope","$window","$state","$rootScope","$compile","$stateParams","ConfigurationService","TokenStorage","LocalStorageUtil","SignalService","$translate","$controller","$timeout","LogService","ToastrService","DataFactory","$q","ConfigurationService"],e.exports=n},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u){e.logOut=function(){NativeStorage.remove("username ",(function(){}),(function(){})),NativeStorage.remove("vmeetify_token",(function(){l.clear(),r.go("login",{animate:"side-left-right",reload:!0})}),(function(){}))}}o.$inject=["$scope","$timeout","$http","$stateParams","$state","$compile","$location","$ionicPlatform","$ionicPopup","TokenStorage","LocalStorageUtil"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g){}o.$inject=["$scope","$timeout","$state","$ionicPopup","$compile","$location","$ionicPlatform","$stateParams","$translate","TokenStorage","ConfigurationService","AuthenticationService","StringUtil","SignalService","UserService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l){e.user=n.currentUser?n.currentUser:i.getUser(),e.openActionSelect=!1,e.isLangTr=!1,e.showAssistBoxLegalMsg=!1;let u="";setTimeout((function(){a.removeWaitingPage()}),1e3),e.openInAppBrowser=function(e){null==e||e.length<3||(cordova.plugins.phonertc.openInAppBrowser(e),s.info("openInAppBrowser: "+e))},r("ChatController",{$scope:e}),document.addEventListener("deviceready",(function(){s.info("ReceptionController deviceready"),"android"!=cordova.platformId&&"ios"!=cordova.platformId||screen.orientation.addEventListener("change",(function(){e.adjustLogoDiv(screen.orientation.type)}));var t=navigator.language||navigator.userLanguage;e.isLangTr="en-US"!=t&&"en-UK"!=t&&"en-GB"!=t&&("tr-TR"==t||"tr"==t||"TR"==t),c.getConfigurationsByTypeAndCompanyId("LEGAL",e.user.companyId).then((function(t){t.data.SHOW_ASSISTBOX_LEGAL_INFO&&"T"==t.data.SHOW_ASSISTBOX_LEGAL_INFO&&(e.showAssistBoxLegalMsg=!0),t.data.ASSISTBOX_GDPR_URL&&(e.gdprUrlMsg=l.instant("ASSISTBOX_GDPR_URL_MSG"),u=t.data.ASSISTBOX_GDPR_URL)})).catch((function(e){s.error("Reception page getConfigurationsByTypeAndCompanyId(LEGAL): ",e)}))}),!1),e.openChatModal=function(){e.openChatWithCallback(),s.info("ReceptionController openChatModal")},e.closeChatModal=function(){e.closeChatWithCallback(),o.scrollTop(),s.info("ReceptionController closeChatModal")},e.adjustLogoDiv=function(e){e.startsWith("portrait")?($("#logoDiv").css("margin-top","60%"),$(".main-content-header-span").css("margin-top","4%")):($("#logoDiv").css("margin-top","5%"),$(".main-content-header-span").css("margin-top",""))},"android"!=cordova.platformId&&"ios"!=cordova.platformId||(e.adjustLogoDiv(screen.orientation.type),console.log(e.user)),e.goToVideoMeeting=function(){try{t.go("videoCallMobile",{currentUser:e.user,activateUser:!0},{location:"replace"})}catch(e){s.error("ReceptionController goToVideoMeeting",e)}},e.goToFilePage=function(){i.setUser(e.user),t.go("filePage",{currentUser:e.user},{animation:"slide-in-up"})},e.openGdpr=function(){e.openInAppBroser(u)}}o.$inject=["$scope","$state","$stateParams","$ionicScrollDelegate","$controller","DataFactory","$rootScope","LogService","ConfigurationService","$translate"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d){console.log("on chat controller");var f=e.user.room;e.selectedUserForSendMessage="ALL",u("FileController",{$scope:e}),e.isChatModelOpen=!1,e.chatMessageList=[],e.sendMessageData={},e.chatController={},e.newMessageCount=0,e.filter={},e.downloadedFiles=[];const p=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&\/\/=]*)/gi,g=/\s/;var h=function(n){var r=n.uniqueId,i=n.result,a=n.fileMessageData;I(100,"progressbar"+r),a.binaryId=i.id,a.binaryFileId=i.id,a.binaryFileDto.blobName=i.blobName,a.blobName=i.blobName,a.containerReference=i.containerReference,t((function(){e.signalService?e.signalService.sendChatMessage(a):o.sendChatMessage(a)}),1e3),d.info("ChatController onUploadComplete")},m=function(t){e.chatMessageList.push(t.fileMessageData),r.scrollBottom(),d.info("ChatController onUploadStart")},v=function(t){e.addProgressBar(t.uniqueId),d.info("ChatController onUploadFileCreateStarted")},S=function(e){var t=e.chunkId,n=e.chunkSize,o=Math.ceil(e.fileSize/n);let r=Math.floor(t/o*100);I(r,"progressbar"+e.uniqueId)},y=function(e){d.error("ChatController onUploadError",e)};function C(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}e.setChatUploadCallbacks=function(){e.setOnUploadStartCb(m),e.setOnUploadCompleteCb(h),e.setOnUploadErrorCb(y),e.setOnUploadProgressCb(S),e.setOnUploadFileCreateStartCb(v)},e.setChatUploadCallbacks(),e.triggerChatPhotoCapture=function(t,n){e.setChatUploadCallbacks(),e.captureMediaWithCallBacks(!1,t,n)},e.openChatWithCallback=function(t,n){if(e.chatModal){if(!e.isChatModelOpen){if(e.isChatModelOpen=!0,e.chatModal.show(),e.newMessageCount=0,n&&-1!==n&&0===n.length)$("#fileInputChat").css("visibility","hidden");else document.getElementById("fileInputChat").onclick=function(){cordova.plugins.Keyboard.hideKeyboardAccessoryBar(),cordova.plugins.Keyboard.close(),e.actionSelectFileType(n)};t&&t(),r.scrollBottom(),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(),cordova.plugins.Keyboard.close(),e.openActionSelect&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(),cordova.plugins.Keyboard.close(),e.actionSelectFileType(-1)),d.info("ChatController openChatWithCallback")}}else i.fromTemplateUrl("chat.html",(function(o){e.chatModal=o,e.openChatWithCallback(t,n)}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})},e.closeChatWithCallback=function(t){e.isChatModelOpen=!1,e.chatModal&&(e.chatModal.hide(),e.newMessageCount=0),t&&t(),cordova.plugins.Keyboard.close(),d.info("ChatController closeChatWithCallback")},e.keyPressedOnChatTextBox=function(t){"13"==t&&e.sendMessage()},e.sendChatMessage=function(){null!=e.sendMessageData.message&&0!=e.sendMessageData.message.length&&(e.sendMessageData.messageDateTime=new Date,e.sendMessageData.messageDateString=e.dateAsString(new Date),e.sendMessageData.appointmentId=f,e.sendMessageData.fromUser=e.user,e.sendMessageData.toUser=e.selectedUserForSendMessage,e.sendMessageData.messageType="text",e.sendMessageData.binaryFileId=null,e.sendMessageData.binaryFileDto={},e.sendMessageData.binaryFileDto.blobName=null,e.isExpertUser?e.sendMessageData.senderType="WEB_USER":e.sendMessageData.senderType="MOBILE_USER",e.signalService?e.signalService.sendChatMessage(e.sendMessageData):o.sendChatMessage(e.sendMessageData),e.sendMessageData.messageUrls=e.checkMessageForUrl(e.sendMessageData.message),e.chatMessageList.push(e.sendMessageData),e.sendMessageData={},r.scrollBottom(),t((function(){window.cordova.plugins.Keyboard.isVisible=!0}),500))},e.openFile=function(t){for(var n=0;n<e.chatMessageList.length;n++)if(e.chatMessageList[n].binaryFileId==t){var o=e.chatMessageList[n].fileEntryUrl;cordova.plugins.fileOpener2.open(o,"",{error:function(e){console.log("Error status: "+e.status+" - Error message: "+e.message)},success:function(){console.log("file opened successfully")}});break}d.info("ChatController openFile: "+t)},e.$on("chatMessage",(function(t,n){e.isChatModelOpen||(navigator.notification.beep(1),e.newMessageCount++);var o=n.messageData;e.messageData=o,e.messageData.messageDateString=e.dateAsString(new Date),"text"==e.messageData.messageType&&(e.messageData.messageUrls=e.checkMessageForUrl(e.messageData.message)),e.chatMessageList.push(e.messageData),e.$apply(),$("#chat-message-notifi").css("display","block"),r.scrollBottom(),"file"==e.messageData.messageType&&($("#downloadFileDiv"+e.messageData.binaryFileId).css("display","block"),$("#openFileDiv"+e.messageData.binaryFileId).css("display","none"))})),e.checkMessageForUrl=function(e){let t,n=[];for(;t=p.exec(e);){let o=t.index;if(-1!==o){let t=e.substring(o),r=t.search(g);-1!==r&&(t=t.substring(0,r)),C(t)&&n.push(t)}}return n},e.addProgressBar=function(t){$(".message-bubble"+t+" .message-content-progressbar").append(n("<div class='progress'> <div id='progressbar"+t+"' class='progress-bar' role='progressbar'  aria-valuemin='0' aria-valuemax='100' style='width:0%'></div></div>")(e)),r.scrollBottom()};var I=function(e,t){document.getElementById(t).style.width=e+"%",document.getElementById(t).innerText=e+"%"};e.downloadFile=function(t){e.downloadedFiles.includes(t)||(e.downloadedFiles.push(t),s.getBinaryByIdWithoutDownload(t).then((function(t){if(200==t.status)if(function(e){for(var t=["jpg","jpeg","png","bmp","mpeg","mov","webm","weba","mp3","aif","wav","wma","mp3","wpl","cda","mpa","ogg","7z","zip","rar","xml","ai","ico","ps","psd","svf","tif","tiff","html","js","css","pps","ppt","pptx","odp","key","ods","xlr","xls","xlsx","tmp","doc","docx","txt","3g2","3gp","avi","flv","h264","m4v","mkv","mpg","rm","swf","vob","wmv","odt","pdf","rtf","tex","wks","wps","wpd"],n=e.split(".").pop(),o=0;o<t.length;o++)if(n.toUpperCase()===t[o].toUpperCase())return!0;return!1}(t.data.blobName)){s.downloadFile(t.data.id,t.data.blobName,(function(o){console.log("file download started");var r=".message-bubble"+t.data.id+" .message-content-progressbar";$(r).append(n("<div class='progress'> <div id='progressbar"+t.data.id+"' class='progress-bar' role='progressbar'  aria-valuemin='0' aria-valuemax='100' style='width:0%'></div></div>")(e)),$("#downloadFileDiv"+t.data.id).css("display","none"),d.info("ChatController fileDownloadStart")}),(function(n){console.log("file download failed"),e.showErrorToastr(c.instant("ERROR_OCCURED_IN_PERFORMING_FILE_TRANSFER")),document.querySelector("#progressbar"+t.data.id).remove();for(var o=0;o<e.chatMessageList.length;o++)if("file"==e.chatMessageList[o].messageType&&e.chatMessageList[o].binaryFileId==t.data.id){e.chatMessageList[o].fileEntryUrl="",e.chatMessageList[o].blobFileType="";var r=e.downloadedFiles.index(e.chatMessageList[o].binaryFileId);e.downloadedFiles.splice(r,1),$("#downloadFileDiv"+t.data.id).css("display","block"),$("#openFileDiv"+t.data.id).css("display","none");break}d.error("ChatController fileDownloadFailed")}),(function(e){if(e.lengthComputable){var n=e.loaded/e.total*100,o=(t.data.id,"progressbar"+t.data.id);I(Math.round(n),o)}}),(function(t,n,o){t.createWriter((function(r){r.onwriteend=function(){console.log("file download completed"),I(100,"progressbar"+o);for(var r=0;r<e.chatMessageList.length;r++)"file"==e.chatMessageList[r].messageType&&e.chatMessageList[r].binaryFileId==o&&(e.chatMessageList[r].fileEntryUrl=t.toURL(),e.chatMessageList[r].blobFileType=n.type,$("#downloadFileDiv"+o).css("display","none"),$("#openFileDiv"+o).css("display","block"));d.info("ChatController onwriteend Successful file write...")},r.onerror=function(e){d.error("ChatController Failed file write: ",e)},r.write(n,!0)}))}))}else{var o=c.instant("ASSISTBOX_UNSUPPORTED_FILE_FORMAT_TO_DOWNLOAD");showErrorToastr(o),d.error("ChatController getBinaryByIdWithoutDownload error: ",o)}})).catch((function(e){showErrorToastr(e),d.error("ChatController getBinaryByIdWithoutDownload error: ",e)})))},document.addEventListener("deviceready",(function(){d.info("ChatController deviceReady"),e.filter.startIndex=0,e.filter.noOfRecords=2e3,e.filter.appointmentId=f,f&&a.getChatMessagesOfAppointment(e.filter).then((function(t){200==t.status&&(angular.forEach(t.data,(function(t){t.fromDB=!0,"file"==t.messageType?($("#downloadFileDiv"+t.binaryFileId).css("display","block"),$("#openFileDiv"+t.binaryFileId).css("display","none")):t.messageUrls=e.checkMessageForUrl(t.message)})),e.chatMessageList=t.data)})).catch((function(e){d.error("ChatController getChatMessagesOfAppointment",e)}))})),e.$on("$destroy",(function(){d.info("on chat controller destroy"),e&&e.chatModal&&e.chatModal.remove()}))}o.$inject=["$scope","$timeout","$compile","SignalService","$ionicScrollDelegate","$ionicModal","MessageSenderService","FileService","$translate","LocalStorageUtil","$controller","LogService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c){console.log("on forward queue controller");var l=!1,u=e.user.room,d=null;e.selectedUserToForwardAnotherQueue="ALL",e.permittedQueueIds=[],e.clients={},e.queues=[],e.queuesAvailable=[],e.queuesDisable=[],e.permittedQueueIds=[];var f=function(){i.get("$ionicLoading").hide()};e.forwardToQueue=function(t){c.info("ForwardQueueController forwardToQueue: ",JSON.stringify(t)),r.showToastrShortBottom(o.instant("ASSISTBOX_FORWARDING")),g(t),e.closeForwardQueueModal()};function p(){c.info("ForwardQueueController findQueuesOfLoggedInUsersCompany fired "),i.get("$ionicLoading").show({content:"Loading",animation:"fade-in",showBackdrop:!0}),a.findQueuesByUsersCompany().then((function(n){for(var o of(e.queues=n.data,e.permittedQueueIds=[],e.queues))o.clientLength=0,e.permittedQueueIds.push(o.id);var r,i;r=e.permittedQueueIds,i=s.defer(),c.info("QueuePageController getClientsInQueues fired "),t.getClientsInQueues(r).then((function(t){for(var n of r){t[n]&&t[n].length>0?e.clients[n]=t[n]:e.clients[n]=void 0;var o=e.queues.findIndex((function(e){return e.id==n}));-1!=o&&(e.queues[o].clientLength=e.clients[n]?e.clients[n].length:0)}c.info("QueuePageController getClientsInQueues",t),i.resolve()})).catch((function(e){c.error("QueuePageController getClientsInQueues",e),i.reject()})),i.promise,f(),c.info("ForwardQueueController findQueuesOfLoggedInUsersCompany",e.queues)})).catch((function(e){r.showToastrLongTop(e),f(),c.error("ForwardQueueController findQueuesOfLoggedInUsersCompany",e)}))}e.sendForwardingMessageData={};var g=function(n){if(c.info("forward customer to another queue "),function(t){for(var n=0;n<e.queues.length;++n)if(e.queues[n].id==t){d=e.queues[n].queueCode;break}}(n.id),null==d)return e.sendForwardingMessageData={},void r.showToastrShortBottom(o.instant("ASSISTBOX_UNEXPECTED_ERROR"));e.sendForwardingMessageData.queueId=n.id,e.sendForwardingMessageData.queueCode=d,e.sendForwardingMessageData.room=e.user.room,e.sendForwardingMessageData.appointmentId=u,e.sendForwardingMessageData.fromUser=e.user,e.sendForwardingMessageData.toUser=e.selectedUserToForwardAnotherQueue,e.isExpertUser?e.sendForwardingMessageData.senderType="WEB_USER":e.sendForwardingMessageData.senderType="MOBILE_USER",t.queueForwarding(e.sendForwardingMessageData),e.sendForwardingMessageData={}};e.openForwardQueueWithCallback=function(t,o){c.info("ForwardQueueController openForwardQueueWithCallback"),p(),e.forwardQueueModal?l||(l=!0,e.forwardQueueModal.show(),t&&t()):n.fromTemplateUrl("forward-queue.html",(function(n){e.forwardQueueModal=n,e.openForwardQueueWithCallback(t,o)}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})},e.closeForwardQueueWithCallback=function(t){l=!1,e.forwardQueueModal&&e.forwardQueueModal.hide(),t&&t(),c.info("ForwardQueueController closeForwardQueueWithCallback")},document.addEventListener("deviceReady",(function(){c.info("ForwardQueueController deviceReady "),p()}),!1),e.$on("$destroy",(function(){c.info("on forward queue destroy"),e&&e.forwardQueueModal&&e.forwardQueueModal.remove()}))}o.$inject=["$scope","SignalService","$ionicModal","$translate","ToastrService","$injector","QueueService","$q","LogService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d){var f=e.user.room,p={},g=[{text:"<i class='icon ion-camera'></i> <i class='action-sheet-button-text'>"+a.instant("ASSISTBOX_CAPTURE_PHOTO")+"</i>"},{text:"<i class='icon ion-ios-videocam'></i> <i class='action-sheet-button-text'>"+a.instant("ASSISTBOX_RECORD_VIDEO")+"</i>"},{text:"<i class='icon ion-images'></i> <i class='action-sheet-button-text'>"+a.instant("ASSISTBOX_PHOTO_VIDEO_LIBRARY")+"</i>"},{text:"<i class='icon ion-document'></i> <i class='action-sheet-button-text'>"+a.instant("ASSISTBOX_DOCUMENT")+"</i>"}];e.actionSelectFileType=function(t){var n=-1==t?g:g.filter((function(e,n){return t.includes(n)})),o=i.show({buttons:n,cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){o(),0==t?e.captureMedia(!1):1==t?e.captureMedia(!0):2==t?e.selectMedia():3==t&&e.selectDocument()}})},e.captureMedia=function(t){d.checkStoragePermissions().then(()=>{e.captureMediaWithCallBacks(t,null,null)}).catch(()=>{l.error("FileController captureMedia checkStoragePermissions Failed")})},e.captureMediaWithCallBacks=function(t,o,r){l.info("FileController captureMediaWithCallBacks: "+t);var i=function(n){var r=null;r="ios"==cordova.platformId?"file://"+n[0].fullPath:n[0].fullPath,e.resolveFileSystemURL(r,!0),o&&o(),t||e.startCapture&&e.startCapture(),l.info("FileController captureSuccess")},s=function(n){if(t||e.startCapture&&e.startCapture(),r)if(n&&3==n.code){r("user_cancelled_photo_capturing")}else r(n);l.error("FileController captureError",n)};if(t)if(n.callInProgress){var c=a.instant("UNABLE_TO_RECORD_VIDEO_DURING_CALL");u.showErrorToastr(c),l.error("FileController captureMediaWithCallBacks",c)}else navigator.device.capture.captureVideo(i,s,{limit:1,duration:900});else e.stopCapture&&e.stopCapture(),navigator.device.capture.captureImage(i,s,{limit:1})},e.selectMedia=function(){function t(t){var n=null;n="ios"==cordova.platformId?t:"file:"+t,e.resolveFileSystemURL(n,!1),l.info("FileController selectMedia onSuccess")}function n(){l.error("FileController selectMedia onFail")}d.checkStoragePermissions().then(()=>{navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,mediaType:Camera.MediaType.ALLMEDIA})}).catch(()=>{l.error("FileController selectMedia checkStoragePermissions Failed")})};e.selectDocument=function(){"ios"==cordova.platformId?DocumentPicker.getFile("pdf",(function(t){e.resolveFileSystemURL(t,!1),l.info("FileController selectDocument DocumentPicker")}),(function(e){l.error("FileController selectDocument DocumentPicker",e)})):window.plugins.mfilechooser.open([],(function(t,n){if(function(e){for(var t=["jpg","jpeg","png","bmp","mpeg","mov","webm","weba","mp3","aif","wav","wma","mp3","wpl","cda","mpa","ogg","7z","zip","rar","xml","ai","ico","ps","psd","svf","tif","tiff","html","js","css","pps","ppt","pptx","odp","key","ods","xlr","xls","xlsx","tmp","doc","docx","txt","3g2","3gp","avi","flv","h264","m4v","mkv","mpg","rm","swf","vob","wmv","odt","pdf","rtf","tex","wks","wps","wpd"],n=e.split(".").pop(),o=0;o<t.length;o++)if(n.toUpperCase()===t[o].toUpperCase())return!0;return!1}(n))e.resolveFileSystemURL(t,!1),l.info("FileController selectDocument mfilechooser");else{let e=a.instant("UNSUPPORTED_FILE_FORMAT");u.showStyledToastrLongBottom(e,{backgroundColor:"#4D2338"}),l.error("FileController onFileSelected mfilechooser: "+e)}}),(function(e){u.showErrorToastr(e),l.error("FileController selectDocument mfilechooser",e)}))},e.resolveFileSystemURL=function(t,n){window.resolveLocalFileSystemURL(t,(function(t){t.file((function(t){if(t.size<2097e5){var o=new FileReader;o.onloadend=function(){var o=this.result;r.findMimeTypeFromFileName(t.type).then((function(r){var i=new Blob([new Uint8Array(o)],{type:r});i.realTime=n,i.fileSize=t.size,e.uploadFile(i,t.name)})),m(),l.info("FileController resolveFileSystemURL onloadend")},o.onerror=function(){m(),l.error("FileController resolveFileSystemURL onError")},o.onabort=function(){m(),l.info("FileController resolveFileSystemURL onAbort")},o.readAsArrayBuffer(t),h()}else{var i=a.instant("FILE_CANNOT_BE_LARGER_THAN_200MB");u.showErrorToastr(i),l.error("FileController resolveFileSystemURL: "+i)}}))}),(function(e){var t=a.instant("ASSISTBOX_FILE_UPLOAD_FAILED");u.showErrorToastr(t),l.error("FileController resolveFileSystemURL error: "+e)}))};var h=function(){c.get("$ionicLoading").show({content:"Loading",animation:"fade-in",showBackdrop:!0})},m=function(){c.get("$ionicLoading").hide()},v=["JPG","JPEG","PNG","BMP","ICO","PS","TIF","TIFF"];e.isImageFile=function(e){var t=e.substr(e.lastIndexOf(".")+1);return v.includes(t.toUpperCase())},e.dateAsString=function(t){return e.dateString=s("date")(t,"dd/MM/yyyy HH:mm"),e.dateString},e.setOnUploadStartCb=function(e){p.onUploadStartCb=e},e.setOnUploadCompleteCb=function(e){p.onUploadCompleteCb=e},e.setOnUploadErrorCb=function(e){p.onUploadErrorCb=e},e.setOnUploadProgressCb=function(e){p.onUploadProgressCb=e},e.setOnUploadFileCreateStartCb=function(e){p.onUploadFileCreateStartCb=e},e.uploadFile=function(n,r){n.name=r;var i=new FormData,s=Math.random().toString(36).substr(2,9);i.append("file",n,"chat-"+f+"-"+s),console.log("file upload started");var c={message:"",senderType:"MOBILE_USER"};c.binaryFileId=s,c.messageDateTime=new Date,c.messageDateString=e.dateAsString(new Date),c.fromUser=e.user,c.fromUserFullname=e.user.fullName,c.toUser="ALL",c.messageType="file",c.binaryFileDto={},c.binaryFileDto.blobName=a.instant("ASSISTBOX_UPLOAD_IN_PROGRESS"),p.onUploadStartCb&&p.onUploadStartCb({uniqueId:s,fileMessageData:c}),t((function(){o.getChunkSize().then(i=>{let a=e=>{u.showErrorToastr(e),p.onUploadErrorCb&&p.onUploadErrorCb({error:e}),l.error("FileController createChunkedAppointmentBinaryFile onError",e)},d=e=>{p.onUploadCompleteCb&&p.onUploadCompleteCb({uniqueId:s,fileMessageData:c,appointmentId:f,result:e})},g=e=>{p.onUploadProgressCb&&p.onUploadProgressCb({chunkId:e,chunkSize:i,fileSize:n.fileSize,uniqueId:s})};t((function(){var t;t=e.isImageFile(r)?"IMAGE":"CHAT",p.onUploadFileCreateStartCb&&p.onUploadFileCreateStartCb({uniqueId:s}),o.createChunkedAppointmentBinaryFile(t,f,n,g).then(d).catch(a)}),500)})}),500)}}o.$inject=["$scope","$timeout","SignalService","FileService","MimeTypeService","$ionicActionSheet","$translate","$filter","$injector","LogService","ToastrService","PermissionService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d){e.user=r.currentUser;var f=e.user.room;u.removeWaitingPage(),e.canSwipe=function(){return!1},document.addEventListener("deviceready",(function(){d.info("FilePageController deviceReady")}),!1),e.incomingFiles=[],e.outgoingFiles=[],e.downloadedFiles=[],e.allFiles=[],e.filter={},o.go("filePage.incoming"),e.showIncomingFiles=function(){o.go("filePage.incoming",null,{location:"replace"}),d.info("FilePageController showIncomingFiles")},e.showOutgoingFiles=function(){o.go("filePage.outgoing",null,{location:"replace"}),d.info("FilePageController showOutgoingFiles")},e.goBack=function(){n.history.back()},l("FileController",{$scope:e}),e.getFiles=function(){e.filter.startIndex=0,e.filter.noOfRecords=2e3,e.filter.appointmentId=f,c.getChatMessagesOfAppointment(e.filter).then((function(t){console.log(t),e.incomingFiles=t.data.filter((function(e){return"WEB_USER"==e.senderType&&"file"==e.messageType})),e.outgoingFiles=t.data.filter((function(e){return"MOBILE_USER"==e.senderType&&"file"==e.messageType})),e.allFiles=e.incomingFiles,e.allFiles=e.allFiles.concat(e.outgoingFiles),console.log(e.incomingFiles),console.log(e.outgoingFiles),d.info("FilePageController getChatMessagesOfAppointment")})).catch((function(e){d.error("FilePageController getChatMessagesOfAppointment",e)}))},e.getFiles(),e.openActionSheet=function(){e.actionSelectFileType(-1)};e.downloadOrOpenFile=function(t){e.downloadedFiles.includes(t)?e.openFile(t):e.downloadFile(t)},e.downloadFile=function(t){s.getBinaryByIdWithoutDownload(t).then((function(n){if(200==n.status)if(function(e){for(var t=["jpg","jpeg","png","bmp","mpeg","mov","webm","weba","mp3","aif","wav","wma","mp3","wpl","cda","mpa","ogg","7z","zip","rar","xml","ai","ico","ps","psd","svf","tif","tiff","html","js","css","pps","ppt","pptx","odp","key","ods","xlr","xls","xlsx","tmp","doc","docx","txt","3g2","3gp","avi","flv","h264","m4v","mkv","mpg","rm","swf","vob","wmv","odt","pdf","rtf","tex","wks","wps","wpd"],n=e.split(".").pop(),o=0;o<t.length;o++)if(n.toUpperCase()===t[o].toUpperCase())return!0;return!1}(n.data.blobName)){s.downloadFile(n.data.id,n.data.blobName,(function(e){console.log("file download started"),$("#downloadFileDiv"+t).css("display","none"),$("#loadingFileDiv"+t).css("display","block")}),(function(e){console.log("file download failed"),$("#downloadFileDiv"+t).css("display","block"),$("#loadingFileDiv"+t).css("display","none"),console.log(e)}),(function(e){if(console.log("file download in progress"),e.lengthComputable){var t=e.loaded/e.total*100;$("#progress"+n.data.id).text(Math.round(t)+"%")}}),(function(n,o,r){n.createWriter((function(i){i.onwriteend=function(){console.log("file download completed");for(var i=0;i<e.allFiles.length;i++)e.allFiles[i].binaryFileId==r&&(e.allFiles[i].fileEntryUrl=n.toURL(),e.allFiles[i].blobFileType=o.type,$("#downloadFileDiv"+t).css("display","none"),$("#loadingFileDiv"+r).css("display","none"),e.downloadedFiles.push(t));d.info("FilePageController onwriteend Successful file write..")},i.onerror=function(e){d.error("FilePageController Failed file write",e)},i.write(o,!0)}))}))}else{var o=a.instant("ASSISTBOX_UNSUPPORTED_FILE_FORMAT_TO_DOWNLOAD");e.showErrorToastr(o),d.error("FilePageController getBinaryByIdWithoutDownload",o)}})).catch((function(t){e.showErrorToastr(t),d.error("FilePageController getBinaryByIdWithoutDownload",t)}))},e.openFile=function(t){for(var n=0;n<e.allFiles.length;n++)if(e.allFiles[n].binaryFileId==t){var o=e.allFiles[n].fileEntryUrl;cordova.plugins.fileOpener2.open(o,"",{error:function(e){d.error("FilePageController openFile Successful file write...",e)},success:function(){d.info("FilePageController openFile ile opened successfully")}});break}};e.$on("chatMessage",(function(t,n){var o=n.messageData;e.messageData=o,e.messageData.messageDateString=e.dateAsString(new Date),"file"==e.messageData.messageType&&(e.incomingFiles.push(e.messageData),e.allFiles.push(e.messageData),e.$apply(),$("#downloadFileDiv"+e.messageData.binaryFileId).css("display","block"),$("#loadingFileDiv"+e.messageData.binaryFileId).css("display","none"))}));e.setOnUploadStartCb((function(t){console.log("uploadStarted"),window.plugins.toast.showWithOptions({message:a.instant("ASSISTBOX_UPLOAD_IN_PROGRESS"),duration:"short",position:"bottom",addPixelsY:-40,styling:{backgroundColor:"#4D2338"}},(function(){}),(function(){})),e.outgoingFiles.push(t.fileMessageData),e.allFiles.push(t.fileMessageData),$("#downloadFileDiv"+t.uniqueId).css("display","none"),$("#loadingFileDiv"+t.uniqueId).css("display","block"),console.log(t)})),e.setOnUploadCompleteCb((function(n){console.log(n);n.uniqueId;var o=n.result,r=n.fileMessageData;r.binaryId=o.id,r.binaryFileId=o.id,r.binaryFileDto.blobName=o.blobName,r.blobName=o.blobName,r.containerReference=o.containerReference,e.outgoingFiles=e.outgoingFiles.filter((function(e){return e!=n.fileMessageData})),e.allFiles=e.allFiles.filter((function(e){return e!=n.fileMessageData})),t((function(){i.sendChatMessage(r),e.outgoingFiles.push(r),e.allFiles.push(r),$("#downloadFileDiv"+n.uniqueId).css("display","none"),$("#loadingFileDiv"+n.uniqueId).css("display","none")}),1e3),d.info("FilePageController onUploadComplete")})),e.setOnUploadErrorCb((function(e){console.log(e.error)})),e.setOnUploadProgressCb((function(e){$("#downloadFileDiv"+e.uniqueId).css("display","none"),$("#loadingFileDiv"+e.uniqueId).css("display","block");var t=e.chunkId,n=e.chunkSize,o=Math.ceil(e.fileSize/n);let r=Math.floor(t/o*100);$("#progress"+e.uniqueId).text(r+"%")}))}o.$inject=["$scope","$timeout","$window","$state","$stateParams","SignalService","$translate","FileService","MessageSenderService","$controller","$rootScope","LogService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d,f){let p,g;e.user={},e.userChangePassword={},e.changePassModal;let h=!1;cordova.plugins.phonertc.clearToken();n.retrieve()&&n.clear();e.login=function(){if(function(e){if(p="",r.isEmpty(e.username)){var t=i.instant("ASSISTBOX_REQUIRED_EMAIL");return p+=t,!1}if(r.isEmpty(e.password)){t=i.instant("ASSISTBOX_REQUIRED_PASSWORD");return p+=t,!1}return!0}(e.user)){"assiststore@assistbox.io"===e.user.username||"appgallery@assistbox.io"===e.user.username?(u.setPath("https://stage-1.assistbox.io"),cordova.plugins.phonertc.setMobileEndpoint("https://stage-1.assistbox.io")):"test@assistbox.io"===e.user.username&&(u.setPath("https://test.assistbox.io"),cordova.plugins.phonertc.setMobileEndpoint("https://test.assistbox.io"));let t=r.getRandomId();e.user.sessionId=t,d.remove("session_id"),n.clear(),o.login(e.user).then((function(o){d.store("session_id",t),cordova.plugins.phonertc.storeSessionId(t);let r=o.data;n.store(r.token),f.setCurrentUser(r),l.getAndSetVideoWidthHeight(f.getCurrentUser()),1==o.data.chgpwd?e.openChangePassModal():c.handleUserLogin(!0,n.retrieve())})).catch((function(e){e.data&&e.data.errorMessage?s.showToastrLongTop(e.data.errorMessage):s.showToastrLongTop(i.instant("ASSISTBOX_UNEXPECTED_ERROR"))}))}else console.log(p),s.showToastrLongTop(p)},e.openForgotPassModal=function(){e.forgotPassModal?isForgotPassModalOpen||(isForgotPassModalOpen=!0,e.forgotPassModal.show(),e.user={}):a.fromTemplateUrl("forgotPassword.html",(function(t){e.forgotPassModal=t,e.openForgotPassModal()}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})},e.closeForgotPassModal=function(){isForgotPassModalOpen=!1,e.forgotPassModal.hide(),e.userForgot={}},e.forgotPassword=function(){console.log(e.userForgot)},e.openChangePassModal=function(){e.changePassModal?h||(h=!0,e.changePassModal.show()):a.fromTemplateUrl("changePassword.html",(function(t){e.changePassModal=t,e.openChangePassModal()}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})},e.closeChangePassModal=function(){h=!1,e.changePassModal.hide(),e.userChangePassword={}},e.changePassword=function(){let t=e.userChangePassword.password,n=e.userChangePassword.confirmPassword;!function(e,t){if(g="",r.isEmpty(e)){var n=i.instant("ASSISTBOX_REQUIRED_PASSWORD");return g+=n,!1}if(!e.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{8,64}$/)){n=i.instant("ASSISTBOX_ERROR_PASSWORD_FORMAT");return g+=n,!1}if(t!==e){n=i.instant("ASSISTBOX_ERROR_PASSWORD_MATCH");return g+=n,!1}return!0}(t,n)?s.showToastrLongTop(g):f.changePassword(null,t,n).then((function(t){200==t.status&&(e.user.password="",e.closeChangePassModal(),s.showToastrLongTop(i.instant("ASSISTBOX_CHANGE_EXPIRED_PASSWORD_SUCCESS")))})).catch((function(e){console.log(e),e.data?s.showToastrLongTop(e.data.errorMessage):s.showToastrLongTop(i.instant("ASSISTBOX_UNEXPECTED_ERROR"))}))};e.showOrHidePassword=function(e){var t;t=$(e.target),"0"===$(t).attr("show-password")?($(t).prev("input").attr("type","text"),$(t).find("i").removeClass("ion-eye"),$(t).find("i").addClass("ion-eye-disabled"),$(t).attr("show-password",1)):($(t).prev("input").attr("type","password"),$(t).find("i").addClass("ion-eye"),$(t).find("i").removeClass("ion-eye-disabled"),$(t).attr("show-password",0))},document.addEventListener("deviceready",(function(){l.removeWaitingPage()}),!1),e.$on("$destroy",(function(){}))}o.$inject=["$scope","$state","TokenStorage","AuthenticationService","StringUtil","$translate","$ionicModal","ToastrService","LoginHandlerService","$rootScope","ServicePath","LocalStorageUtil","UserService"],e.exports=o},function(e,t){function n(e,t,n,o,r,i,a,s,c,l){e.surveyResult={},e.meetingSatisfactionStars=[],e.audioVideoQualityStars=[],e.agentSatisfactionStars=[];var u=function(){let e=document.getElementById("meetingComments");e&&e.clientHeight<e.scrollHeight&&(e.style.height=e.scrollHeight+10+"px")};e.saveSurveyResult=function(){r.info("saveSurveyResult",e.surveyResult),0!=e.surveyResult.audioVideoQualityRating&&(!e.isCustomer||0!=e.surveyResult.meetingSatisfactionRating&&0!=e.surveyResult.agentSatisfactionRating)?n.createSurveyResult(e.surveyResult).then(e=>{200===e.status?a.showToastrShortBottom(o.instant("ASSISTBOX_MSG_MEETING_RESULT_SAVED")):r.error("saveSurveyResult result status: "+e.status)}).catch(e=>{r.error("Survey not send: ",e),a.showErrorToastr(o.instant("ASSISTBOX_MSG_MEETING_RESULT_NOT_SAVED"))}).finally(()=>{e.closeSurveyResultModal()}):a.showErrorToastr(o.instant("ASSISTBOX_MSG_PLEASE_RATE_MEETING"))};var d=function(e){let t=[];for(let n=0;n<5;n++)t.push({selected:n<=e});return t};e.updateMeetingSatisfaction=function(t){e.surveyResult.meetingSatisfactionRating=t+1,e.meetingSatisfactionStars=d(t)},e.updateAudioVideoQuality=function(t){e.surveyResult.audioVideoQualityRating=t+1,e.audioVideoQualityStars=d(t)},e.updateAgentSatisfaction=function(t){e.surveyResult.agentSatisfactionRating=t+1,e.agentSatisfactionStars=d(t)},e.onCommentChange=function(){e.curCommentLength=e.surveyResult.comment.length,e.curCommentLength==e.maxCommentLength?$("#commentLengthText").css("color","red"):$("#commentLengthText").css("color","inherit"),u()},e.openSurveyResultModal=function(o,a){s.getAppStatus()!=c.PAUSE?e.surveyResultModal?(!function(o){r.info("SurveyResultController initialize",e.user);let i=l.getCurrentUser();e.isCustomer=o,e.appointmentId=e.user.room,e.participantId=e.user.participantId,e.surveyResult.ownerName=e.user.fullName,i.userRole&&(e.surveyResult.userRole=i.userRole),e.surveyResult.meetingResultId=e.meetingResult.id,e.updateMeetingSatisfaction(-1),e.updateAudioVideoQuality(-1),e.updateAgentSatisfaction(-1),e.curCommentLength=e.surveyResult.comment?e.surveyResult.comment.length:0,e.maxCommentLength=n.maxCommentLength,t(u,200)}(o),e.surveyResultModal.show(),e.surveyResultCloseCallback=a,r.info("SurveyResultController openSurveyResultModal")):i.fromTemplateUrl("survey-result.html",(function(t){e.surveyResultModal=t,e.openSurveyResultModal(o,a)}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1}):e.$on("appResume",(function(){e.openSurveyResultModal(o,a)}))},e.closeSurveyResultModal=function(){r.info("SurveyResultController closeSurveyResultModal"),e.surveyResultModal&&e.surveyResultModal.hide(),e.surveyResultCloseCallback()},e.$on("$destroy",(function(){r.info("SurveyResultController destroy"),e&&e.surveyResultModal&&e.surveyResultModal.remove()}))}n.$inject=["$scope","$timeout","SurveyResultService","$translate","LogService","$ionicModal","ToastrService","DataFactory","DeviceState","UserService"],e.exports=n},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d,f,p){var g;e.user={},e.register={};e.goToLogin=function(){n.go("login",{location:"replace"})},e.signUp=function(){e.register={username:e.user.username,password:e.user.password,email:e.user.username,firstname:e.user.firstname,lastname:e.user.lastname,confirmPassword:e.user.confirmpassword,userRole:"CUSTOMER",isActivated:!0,companyId:0},console.log(e.register),!function(e){if(g="",l.isEmpty(e.email)){var t=f.instant("ASSISTBOX_REQUIRED_EMAIL");return g+=t,!1}if(!e.email.match(/([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{1,6}(?:\.[a-z]{2})?)\S+/)){t=f.instant("ASSISTBOX_ERROR_EMAIL_FORMAT");return g+=t,!1}var n=e.email.length;if(n<4){t=f.instant("ASSISTBOX_ERROR_EMAIL_FORMAT_4_CHARACTERS");return g+=t,!1}if(n>200){t=f.instant("ASSISTBOX_ERROR_EMAIL_FORMAT_200_CHARACTERS");return g+=t,!1}if(l.isEmpty(e.password)){t=f.instant("ASSISTBOX_REQUIRED_PASSWORD");return g+=t,!1}if(!e.password.match(/^.{4,20}$/)){t=f.instant("ASSISTBOX_ERROR_PASSWORD_FORMAT");return g+=t,!1}if(e.confirmPassword!==e.password){t=f.instant("ASSISTBOX_ERROR_PASSWORD_MATCH");return g+=t,!1}return!0}(e.register)?(console.log(g),p.showToastrLongBottom(g)):console.log(e.register)},document.addEventListener("deviceready",(function(){}),!1)}o.$inject=["$scope","$timeout","$state","$ionicPopup","$compile","$location","$ionicPlatform","TokenStorage","AuthenticationService","StringUtil","SignalService","UserService","$translate","ToastrService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l){c("NewAppointmentController",{$scope:e}),e.myAppointments=[];var u={};e.userInfo={},e.listAppointments=function(){var t=n.retrieve();l.getDataFromJwtToken(t).then((function(t){e.userInfo=t.data,u={fullName:e.userInfo.userFullName,socket:"",companyId:e.userInfo.companyId},r.getUsersAppointments().then((function(t){console.log(t),e.myAppointments=t.data})).catch((function(e){console.log(e),i.showToastrLongBottom(e.data.errorMessage)}))}))},e.listAppointments(),e.selectAppointment=function(r){var i=r.id;u.room=i,u.uuid=d();var c=n.retrieve(),l=e.userInfo.companyId;a.getConfigurationsByTypeAndCompanyId("SIGNAL_SERVER",l).then((function(e){o.connect(e.data.SIGNAL_SERVER_URL,c,u).then((function(e){a.getConfigurationsByTypeAndCompanyId("MOBILE",l).then((function(n){!function(e,t,n,r){o.online(e),o.setCompanyId(t),o.joinRoom(n),s.createAppointmentDeviceInfo(n)}(e,l,i),function(e,n){e.data.SHOW_RECEPTION_PAGE&&"T"==e.data.SHOW_RECEPTION_PAGE?t.go("reception",{currentUser:n}):t.go("videoCallMobile",{currentUser:n,activateUser:!0})}(n,e)})).catch((function(e){console.log(e)}))}))})).catch((function(e){console.log(e)}))};var d=function(){return"mobile"+Math.random().toString(36).substr(2,9)};e.newAppointment=function(){e.openDepartmentSelectModal()},document.addEventListener("deviceready",(function(){}),!1)}o.$inject=["$scope","$state","TokenStorage","SignalService","UserService","ToastrService","ConfigurationService","AppointmentDeviceInfoService","$controller","TokenService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d){e.days=[],e.departments=[],e.handlers=[],e.disabledIndexes=[],e.times=[];var f;e.openDepartmentSelectModal=function(){e.selectDepartmentModal?(e.selectDepartmentModal.show(),!0):c.fromTemplateUrl("newappointmentpages/selectDepartment.html",(function(t){e.selectDepartmentModal=t,e.selectDepartmentModal.show(),!0}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})},e.listDepartments=function(){var t=o.retrieve();d.getDataFromJwtToken(t).then((function(t){f=t.data,e.companyId=f.companyId,e.createTimeList(),a.getDepartmentsByCompanyId(e.companyId).then((function(t){e.departments=t.data,console.log(t)})).catch((function(e){console.log(e),s.showToastrLongBottom(e)}))}))},e.listDepartments(),e.closeNewAppointment=function(){e.selectDepartmentModal.hide(),!1},e.departmentSelected=function(t){e.department=t,e.selectDepartmentModal.hide(),!1,a.findUsersInDepartment(t.id).then((function(t){console.log(t),e.handlers=t.data,e.selectHandlerModal?(e.selectHandlerModal.show(),!0):c.fromTemplateUrl("newappointmentpages/selectHandler.html",(function(t){e.selectHandlerModal=t,e.selectHandlerModal.show(),!0}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})})).catch((function(e){s.showToastrLongBottom(e)}))},e.inactivateOccupiedTimes=function(){if(e.selectedDate,e.disabledIndexes.length>0)for(var t in e.disabledIndexes){var n=e.disabledIndexes[t];e.times[n].active=!0}for(var t in e.disabledIndexes=[],e.selectedHandlersAppointments){var o=new Date(e.selectedHandlersAppointments[t].appointmentDate);if(e.selectedDate.date.getFullYear()==o.getFullYear()&&e.selectedDate.date.getMonth()==o.getMonth()&&e.selectedDate.date.getDate()==o.getDate()){n=e.times.findIndex(e=>e.hour==o.getHours()&&e.minute==o.getMinutes());e.times[n].active=!1,e.disabledIndexes.push(n)}}},e.getHandlersAppointmentDates=function(){r.getHandlersAppointments(e.selectedHandler.id).then((function(t){e.selectedHandlersAppointments=t.data,console.log(t)})).catch((function(e){console.log(e),s.showToastrLongBottom(e.data.errorMessage)}))},e.handlerSelected=function(t){e.selectedHandler=t,e.getHandlersAppointmentDates(),e.selectTimeModal?(e.selectTimeModal.show(),!0):c.fromTemplateUrl("newappointmentpages/selectTime.html",(function(t){e.selectTimeModal=t,e.selectTimeModal.show(),!0}),{scope:e,animation:"slide-in-up",hardwareBackButtonClose:!1})};const p=[i.instant("ASSISTBOX_JANUARY"),i.instant("ASSISTBOX_FEBRUARY"),i.instant("ASSISTBOX_MARCH"),i.instant("ASSISTBOX_APRIL"),i.instant("ASSISTBOX_MAY"),i.instant("ASSISTBOX_JUNE"),i.instant("ASSISTBOX_JULY"),i.instant("ASSISTBOX_AUGUST"),i.instant("ASSISTBOX_SEPTEMBER"),i.instant("ASSISTBOX_OCTOBER"),i.instant("ASSISTBOX_NOVEMBER"),i.instant("ASSISTBOX_DECEMBER")],g=[i.instant("ASSISTBOX_MONDAY"),i.instant("ASSISTBOX_TUESDAY"),i.instant("ASSISTBOX_WEDNESDAY"),i.instant("ASSISTBOX_THURSDAY"),i.instant("ASSISTBOX_FRIDAY"),i.instant("ASSISTBOX_SATURDAY"),i.instant("ASSISTBOX_SUNDAY")];e.createTimeList=function(){u.getConfigurationsByTypeAndCompanyId("APPOINTMENT",e.companyId).then((function(t){for(var n=t.data.WORK_DAYS.replace(/\[|\]/gi,"").split(",").map(e=>7==e?0:Number(e)),o=new Date,r=0;r<30;r++){var i={},a=new Date;a.setDate(o.getDate()+r),n.includes(a.getDay())&&(i.date=a,i.day=a.getDate(),i.dayName=g[a.getDay()-1],i.monthName=p[a.getMonth()],i.year=a.getFullYear(),i.value=a.valueOf(),e.days.push(i))}var s=t.data.DURATION?Number(t.data.DURATION):30,c=t.data.WORK_HOUR_START?Number(t.data.WORK_HOUR_START.split(":")[0]):0,l=t.data.WORK_HOUR_START?Number(t.data.WORK_HOUR_START.split(":")[1]):0,u=t.data.WORK_HOUR_END?Number(t.data.WORK_HOUR_END.split(":")[0]):24,d=t.data.WORK_HOUR_END?Number(t.data.WORK_HOUR_END.split(":")[1]):24,f=new Date,h=new Date(f);for(f.setHours(c),f.setMinutes(l),h.setHours(u),h.setMinutes(d);h>f;)e.times.push({hour:1==f.getHours().toString().length?"0"+f.getHours():f.getHours(),minute:1==f.getMinutes().toString().length?"0"+f.getMinutes():f.getMinutes(),active:!0}),f.setMinutes(f.getMinutes()+s)})).catch((function(e){s.showToastrLongBottom(e.data.errorMessage),console.log(e)}))},e.selectDay=function(t){$("#title").text(p[t.date.getMonth()]),e.selectedDate&&$("#day-number"+e.selectedDate.value).removeClass("active"),$("#day-number"+t.value).addClass("active"),e.selectedDate=t,e.inactivateOccupiedTimes()},e.closeSelectHandlerModal=function(){e.selectDepartmentModal.show(),!0,e.selectHandlerModal.hide(),!1},e.closeSelectTimeModal=function(){e.selectTimeModal.hide(),$("#title").text(i.instant("ASSISTBOX_DATE")),$("#day-number"+e.selectedDate.value).removeClass("active"),!1,e.selectedDate=null},e.createAppointment=function(o){if(e.selectedDate)if(o.active){var a=e.selectedDate.date;a.setHours(Number(o.hour)),a.setMinutes(Number(o.minute)),a.setSeconds(0);var c=i.instant("ASSISTBOX_NEW_APPOINTMENT"),u=i.instant("ASSISTBOX_DATE")+": "+e.selectedDate.day+" "+e.selectedDate.monthName+" "+e.selectedDate.year+" "+e.selectedDate.dayName+" "+o.hour+":"+o.minute,d=i.instant("ASSISTBOX_YES"),p=i.instant("ASSISTBOX_NO");navigator.notification.confirm(u,(function(o){1==o&&r.getUserInfo(f.userId).then((function(o){e.appointment={companyId:e.companyId,firstName:o.data.firstname,lastName:o.data.lastname,expertUserId:e.selectedHandler.id,appointmentDate:a,customerEmail:o.data.email,customerPhone:o.data.phone},l.createCustomerAppointment(e.appointment).then((function(o){console.log(o),e.selectDepartmentModal&&e.selectDepartmentModal.hide(),e.selectHandlerModal&&e.selectHandlerModal.hide(),e.selectTimeModal&&e.selectTimeModal.hide(),!1,!1,!1,s.showToastrLongBottom(i.instant("ASSISTBOX_APPOINTMENT_CREATED")),t((function(){n.reload()}),250)})).catch((function(e){console.log(e),s.showToastrLongBottom(e.data.errorMessage)}))}))}),c,[d,p])}else s.showToastrLongBottom("bl bende bl bl bende");else s.showToastrLongBottom(i.instant("ASSISTBOX_REQUIRED_SELECT_DAY"))},document.addEventListener("deviceready",(function(){}),!1),e.$on("$destroy",(function(){console.log("on new appointment destroy"),e.selectHandlerModal&&e.selectHandlerModal.remove(),e.selectTimeModal&&e.selectTimeModal.remove()}))}o.$inject=["$scope","$timeout","$state","TokenStorage","UserService","$translate","DepartmentService","ToastrService","$ionicModal","AppointmentService","ConfigurationService","TokenService"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h,m,v,S,y,C,I,b,T,w){e.user=i.currentUser,e.clientUser=i.clientUser,e.user.queueId=i.queueId,e.callAnsweredTime=i.callAnsweredTime,e.companyId=e.user.companyId,e.isDestroyed=!1,o.removeWaitingPage();var A=e.user.room;let E;e.isExpertUser=!0,e.participants=[],e.callInProgress=!1,e.textViewVisible=!1,e.isMeetingStarted=!1;let _=ParticipationType();e.meetingLobbyEnabled=!1;let R=document.getElementById("iconsScroller");p("VideoCallCommonController",{$scope:e}),p("ChatController",{$scope:e}),p("ForwardQueueController",{$scope:e}),e.getHiddenComponents("mobileC2cVideoCall"),e.callClient=function(t){if(d.info("C2cVideoCallController callClient fired"),!e.callInProgress&&!a.callInProgress){e.callInProgress=!0,a.joinRoom(A),a.setParticipantIdToCurrentUser(e.user.participantId);let t=e.clientUser.clientToken;if(w.isEmpty(t))return c.error(s.instant("ASSISTBOX_UNEXPECTED_ERROR")),void d.error("No token in the C2C guest user info");b.updateGuestTokenForAppointment(t,A).then((function(t){if(200===t.status&&!w.isEmpty(t.data)){const n=t.data;e.clientUser.clientToken=n,a.sendRoomAndParticipantInfo(e.clientUser,e.user.queueId,A,n)}})).catch((function(e){c.error(s.instant("ASSISTBOX_UNEXPECTED_ERROR")),d.error("updateGuestTokenForAppointment",e)})),cordova.plugins.phonertc.showVideoView(e.videoStatus),d.info("callClient",e.clientUser)}},document.addEventListener("deviceready",e.callClient,!1),e.showOrHideTextView=function(){if(f.cancel(E),e.textViewVisible)e.textViewVisible=!1,cordova.plugins.phonertc.hideTextView(),d.info("hideTextView");else{e.textViewVisible=!0;var t=e.clientUser.firstName+" "+e.clientUser.lastName;e.clientUser.productName=e.clientUser.productName?e.clientUser.productName:"",e.clientUser.deviceType=e.clientUser.deviceType?e.clientUser.deviceType:"",cordova.plugins.phonertc.showTextView(t,30,"\n\n"+e.clientUser.productName,15,e.clientUser.deviceType),d.info("showTextView: "+t+", "+e.clientUser.productName)}},e.triggerContactForm=function(){a.triggerContactForm(e.clientUser),c.showToastrLongTop(s.instant("ASSISTBOX_TRIGGERED_CONTACT_FORM")),d.info("triggerContactForm")},e.openForwardQueueModal=function(){e.openForwardQueueWithCallback((function(){cordova.plugins.phonertc.hideVideoView(),e.textViewVisible&&e.showOrHideTextView()}),[]),d.info("openForwardQueueModal")},e.closeForwardQueueModal=function(){e.closeForwardQueueWithCallback((function(){f((function(){cordova.plugins.phonertc.showVideoView(e.videoStatus)}),250)})),d.info("closeForwardQueueModal")},e.openChatModal=function(){e.openChatWithCallback((function(){cordova.plugins.phonertc.hideVideoView(),e.textViewVisible&&e.showOrHideTextView()}),[]),d.info("openChatModal")},e.closeChatModal=function(){e.closeChatWithCallback((function(){f((function(){cordova.plugins.phonertc.showVideoView(e.videoStatus)}),250)})),d.info("closeChatModal")},e.$on("permissionDenied",(function(){d.info("C2cVideoCallController permissionDenied fired"),c.showToastrShortTop(s.instant("ASSISTBOX_CLIENT_DENIED_PERMISSON")),f((function(){e.stopMeeting()}),1500)})),e.$on("answerNotReceived",(function(){if(d.info("C2cVideoCallController answerNotReceived fired"),!a.callInProgress){var t=s.instant("ASSISTBOX_CONFIRMATION"),n=s.instant("ASSISTBOX_CLIENT_NOT_RESPONDING"),o=s.instant("ASSISTBOX_STOP_CALL"),r=s.instant("ASSISTBOX_WAIT");navigator.notification.confirm(n,(function(t){d.info("C2cVideoCallController answerNotReceived buttonIndex: "+t),1==t&&e.stopMeeting()}),t,[o,r])}})),e.$on("offlineUser",(function(t,n){var o=e.participants.indexOf(n.fullName);o>-1&&e.participants.splice(o,1),d.info("C2cVideoCallController onOfflineUser: "+n.fullName)})),e.stopMeeting=function(t){d.info("C2cVideoCallController stopMeeting fired, didClickStopButton: "+t),c.showToastrLongTop(s.instant("ASSISTBOX_END_MEETING_WAIT")),cordova.plugins.phonertc.hideVideoView(),a.endCall(),e.callInProgress=!1};var O=function(){d.info("C2cVideoCallController updateAppointment fired"),e.appointment&&l.updateAppointment(e.appointment).then((function(t){e.appointment=t.data,d.info("C2cVideoCallController updateAppointment success")})).catch((function(e){c.showErrorToastr(e),d.error("C2cVideoCallController updateAppointment: ",e)}))},P=function(){d.info("C2cVideoCallController updateClaim fired"),e.appointment&&u.updateClaim(e.appointment.claim).then((function(t){e.appointment.claim=t.data,d.info("C2cVideoCallController updateClaim success")})).catch((function(e){console.log(e),c.showErrorToastr(e),d.error("C2cVideoCallController updateClaim: ",e)}))};e.$on("$destroy",(function(){e.isDestroyed||(e.isDestroyed=!0,d.info("C2cVideoCallController destroy.."),e.isMeetingStarted||(d.setAppointmentId(0),d.setParticipantId(0),n.go("queuePage",{currentUser:e.user,callQueueId:null},{location:"replace"})))})),e.updateVideoPosition=function(){o.$broadcast("updateVideoPosition")},document.addEventListener("deviceready",(function(){cordova.plugins.phonertc.setLogParameters(g.retrieve(),h.getPath(),parseInt(e.user.room),0),d.info("C2cVideoCallController deviceready"),"browser"!=cordova.platformId&&chrome.power.requestKeepAwake("display"),"android"==cordova.platformId||"ios"==cordova.platformId?(window.screen.orientation.type.includes("landscape")?(f((function(){$("#iconsScroller > li").each((function(){$(this).prependTo(this.parentNode)}))}),100),f((function(){R.scrollTop=-99999}),1e3)):f((function(){R.scrollLeft=99999}),1e3),e.initOrientationChangeListener()):window.screen.orientation.lock("landscape"),$("#agentIonContent").append(r("<video-view></video-view>")(o)),$("#videoDiv").append(r("<div class='loading'>Loading&#8230;</div>")(e)),$("#videoDiv").append(r(" <div  class='loadingSpinner'><span class='loadingSpan'> "+s.instant("ASSISTBOX_CALLING_CLIENT")+"</span></div>")(e)),e.showOrHideTextView(),E=f((function(){e.textViewVisible&&e.showOrHideTextView()}),5e3)}),!1);let k=function(){e.isMeetingStarted||(e.isMeetingStarted=!0,e.saveMeetingResultWhenMeetingStarted(_.HOST),cordova.plugins.phonertc.closeInAppBrowser(),e.closeChatModal(),d.info("C2cVideoCallController startMeeting")),c.showToastrShortBottom(s.instant("ASSISTBOX_PEER_CONNECTION_ESTABLISHED")),f((function(){e.clientUser.deviceType&&"desktop"==e.clientUser.deviceType?c.showToastrShortBottom(s.instant("ASSISTBOX_PARTICIPANT_DEVICE_DESKTOP")):e.clientUser.deviceType&&c.showToastrShortBottom(s.instant("ASSISTBOX_PARTICIPANT_DEVICE_MOBILE"))}),2e3)};e.$on("callAnswered",(function(e,t){let n=t.user;k(),d.info("C2cVideoCallController callAnswered",n)})),e.$on("changeTrackType",(function(e,t){var n=t.trackType;cordova.plugins.phonertc.changeTrackType(n),d.info("C2cVideoCallController switchStreams",t)}));let L=function(){e.isMeetingStarted&&(e.isMeetingStarted=!1,e.appointment&&(e.appointment.status="COM",e.appointment.claim.status="CLOSED",O(),P(),e.saveMeetingResult(_.HOST).then((function(t){d.info("saveMeetingResult when meeting ended. id: "+t.id+" meetingStartTime: "+e.meetingStartTime+", meetingEndTime: "+e.meetingEndTime)})).finally((function(){e.meetingEndTime,e.meetingStartTime=0})))),e.$broadcast("$destroy")};e.$on("endMeeting",(function(){d.info("C2cVideoCallController endMeeting"),a.setAgentState("AVAILABLE"),a.leaveRoom(A),cordova.plugins.Keyboard.close(),cordova.plugins.phonertc.hideVideoView(),sessionStorage.setItem("camera","Front"),cordova.plugins.phonertc.hideTextView(),cordova.plugins.phonertc.closeInAppBrowser(),cordova.plugins.phonertc.removeViews(),e.meetingEndTime=new Date,clearInterval(e.saveMeetingIntervalId),e.appointment?L():l.getAppointmentById(A).then((function(t){e.appointment=t.data})).catch((function(e){d.error("getAppointmentById",e),c.showErrorToastr(e)})).finally((function(){L()}))})),e.$on("appPaused",(function(t,n){d.info("appPaused on c2c_videocall"),e.stopCapture(),a.callInProgress&&cordova.plugins.phonertc.startOngoingCallNotification(s.instant("ASSISTBOX_RETURN_TO_VIDEO_MEETING"))})),e.$on("appResume",(function(){d.info("appResume on c2c_videocall"),e.startCapture(),cordova.plugins.phonertc.stopOngoingCallNotification()})),e.$on("customerCloseContactForm",(function(e,t){c.showToastrLongTop(s.instant("ASSISTBOX_CUSTOMER_CLOSED_CONTACT_FORM")),d.info("customerCloseContactForm")})),e.$on("customerSubmitContactForm",(function(t,n){c.showToastrLongTop(s.instant("ASSISTBOX_CUSTOMER_SUBMIT_CONTACT_FORM")),d.info("customerSubmitContactForm",n),e.appointment?(n.contactInfo.firstName&&(e.clientUser.firstName=n.contactInfo.firstName,e.appointment.claim.firstName=e.appointment.customerName=n.contactInfo.firstName),n.contactInfo.lastName&&(e.clientUser.lastName=n.contactInfo.lastName,e.appointment.claim.lastName=e.appointment.customerSurname=n.contactInfo.lastName),n.contactInfo.phone&&(e.appointment.customerPhone=n.contactInfo.phone),n.contactInfo.email&&(e.appointment.customerEmail=n.contactInfo.email),O(),P()):l.getAppointmentById(e.user.room).then((function(t){e.appointment=t.data,n.contactInfo.firstName&&(e.clientUser.firstName=n.contactInfo.firstName,e.appointment.claim.firstName=e.appointment.customerName=n.contactInfo.firstName),n.contactInfo.lastName&&(e.clientUser.lastName=n.contactInfo.lastName,e.appointment.claim.lastName=e.appointment.customerSurname=n.contactInfo.lastName),n.contactInfo.phone&&(e.appointment.customerPhone=n.contactInfo.phone),n.contactInfo.email&&(e.appointment.customerEmail=n.contactInfo.email),O(),P()})).catch((function(e){d.error("getAppointmentById",e),c.showErrorToastr(e)}))})),document.getElementById("right-button").addEventListener("click",(function(e){e.preventDefault(),window.screen.orientation.type.includes("landscape")?R.scrollTop+=50:R.scrollLeft-=50})),document.getElementById("left-button").addEventListener("click",(function(e){e.preventDefault(),window.screen.orientation.type.includes("landscape")?R.scrollTop-=50:R.scrollLeft+=50})),e.stopCapture=function(){cordova.plugins.phonertc.stopCapture()},e.startCapture=function(){cordova.plugins.phonertc.startCapture(e.videoStatus)}}o.$inject=["$scope","$window","$state","$rootScope","$compile","$stateParams","SignalService","$translate","ToastrService","AppointmentService","ClaimService","LogService","$timeout","$controller","TokenStorage","ServicePath","HiddenComponentService","FileService","AppointmentBinaryService","MediaProcessingService","ConfigurationService","MeetingResultService","TokenService","$q","StringUtil"],e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h,m,v,S,y,C){e.isQueueSelected=!1,e.queues=[],e.clients={},e.clientsOfSelectedQueue=[],e.user=n.currentUser,e.user.participationType=ParticipationType().HOST,e.user.room=0,e.permittedQueueIds=[],e.availability,e.callQueueId=n.callQueueId,e.isFromNotification=e.callQueueId&&e.callQueueId>0,e.signalServerUrl,e.fromInfo,e.availabilityToggle=!1,e.occupyInProgress=!1,e.callAnsweredTime,e.incomingCallQueueId=0;var I=!0,b=function(){u.get("$ionicLoading").show({content:"Loading",animation:"fade-in",showBackdrop:!0})},T=function(){u.get("$ionicLoading").hide()};let w={};function A(){if(a.isConnected())return h.info("QueuePageController getSignalServiceUrl fired already connected"),void e.getAgentState();h.info("QueuePageController getSignalServiceUrl fired will try to connect"),h.info("QueuePageController getSignalServiceUrl "),l.showWaitingPage(o.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE")),e.signalServerUrl?E():i.getConfigurationsByTypeAndCompanyId("SIGNAL_SERVER",e.user.companyId).then((function(t){e.signalServerUrl=t.data.SIGNAL_SERVER_URL,p.setSignalServerUrl(e.signalServerUrl),E()})).catch((function(e){-1==e.status&&R(),h.error("QueuePageController getConfigurationsByTypeAndCompanyId",e)}))}function E(){h.info("QueuePageController connectSignalService fired "),a.connect(e.signalServerUrl,r.retrieve(),e.user,w).then((function(e){h.info("QueuePageController connect",e),a.checkAgentOnline()})).catch((function(e){R(),h.error("QueuePageController connectSignalService",e)}))}function _(){h.info("QueuePageController agentOnline"),a.agentOnline().then((function(){e.getAgentState().then((function(t){a.createStateLog(t),null!=e.callQueueId&&0!=e.callQueueId&&(e.selectQueue({id:e.callQueueId},"fromNotification"),e.callQueueId=0),l.removeWaitingPage()}))})).catch((function(e){c.showErrorToastr(o.instant(e)),l.removeWaitingPage(),a.disconnectCurrentUserSocket(),h.error("QueuePageController agentOnline",e)}))}function R(){h.info("QueuePageController connectionError fired ");var e=o.instant("ASSISTBOX_CONNECTION_ERROR_TITLE"),t=o.instant("ASSISTBOX_CONNECTION_ERROR_MESSAGE"),n=o.instant("ASSISTBOX_CLOSE");navigator.notification.alert(t,null,e,n)}w.occupySuccessful=function(n,r){c.showToastrLongBottom(o.instant("ASSISTBOX_CALLING_CLIENT")),h.info("QueuePageController occupySuccessful queueId: "+r+", user",n);var i={claimDto:{noticeDate:new Date,firstName:n.firstName,lastName:n.lastName,createAppointment:!0},appointmentDto:{companyId:e.user.companyId,customerName:n.firstName,customerSurname:n.lastName,customerEmail:n.email,customerPhone:n.phoneNo,expertUser:{companyId:e.user.companyId,id:e.user.userId},expertUserId:e.user.userId,appointmentDate:new Date}};g.createClaim(i).then((function(o){e.user.room=o.data.appointmentId,e.user.participantId=o.data.hostParticipantId,n.participantId=o.data.participantId,h.setAppointmentId(e.user.room),h.setParticipantId(e.user.participantId),f.createAppointmentDeviceInfo(o.data.appointmentId).then((function(e){200===e.status&&(l.deviceInfoId=e.data.id,h.info("QueuePageController device info: ",e.data))})).catch((function(e){h.error("QueuePageController createAppointmentDeviceInfo",e)})),a.setAgentState("INCALL"),e.$destroy(),k(),t.go("c2cVideoCall",{currentUser:e.user,queueId:r,clientUser:n,callAnsweredTime:e.callAnsweredTime},{location:"replace"})})).catch((function(e){"android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera(),c.showErrorToastr(e),h.error("QueuePageController createClaim",e)}))},w.occupyUserError=function(t){"android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera(),c.showErrorToastr(o.instant(t)),e.occupyInProgress=!1,h.error("QueuePageController occupyUserError",t),0!=e.incomingCallQueueId&&k()},w.userNotResponding=function(t,n){h.info("QueuePageController userNotResponding fired ");var r=o.instant("ASSISTBOX_CONFIRMATION"),i=o.instant("ASSISTBOX_CLIENT_NOT_RESPONDING"),s=o.instant("ASSISTBOX_STOP_CALL"),l=o.instant("ASSISTBOX_TRY_AGAIN");navigator.notification.confirm(i,(function(r){h.info("QueuePageController userNotResponding buttonIndex: "+r),1==r?("android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera(),c.showToastrShortTop(o.instant("ASSISTBOX_REMOVING_CLIENT_FROM_QUEUE")),a.removeClientFromQueue(t,n),e.occupyInProgress=!1,0!=e.incomingCallQueueId&&P()):e.occupyClient(t,n)}),r,[s,l])},e.$on("checkExistingUser",(function(t,n){if(h.info("QueuePageController checkExistingUser: ",n),n){k();var r=o.instant("ASSISTBOX_CONFIRMATION"),i=o.instant("ASSISTBOX_REPLACE_SOCKET_CONFIRM_MESSAGE"),s=o.instant("ASSISTBOX_YES"),c=o.instant("ASSISTBOX_NO");navigator.notification.confirm(i,(function(t){h.info("QueuePageController replaceExistingUser buttonIndex: "+t),1==t?a.replaceExistingUser(n):e.disconnect()}),r,[s,c])}else _()})),w.onSocketReplaced=function(e){h.info("QueuePageController onSocketReplaced: ",e),_()},w.onReplaceSocket=function(t){h.info("QueuePageController onReplaceSocket: ",t),e.incomingCallQueue=void 0,e.incomingCallQueueId=0,k(),I=!1;var n=o.instant("ASSISTBOX_CONFIRMATION"),r=o.instant("ASSISTBOX_LOGGED_IN_ANOTHER_TAB_OR_DEVICE"),i=o.instant("ASSISTBOX_LOG_OUT");navigator.notification.confirm(r,(function(t){S.logout(!0).then(t=>{e.disconnect()})}),n,[i])};var O=function(t){var n=v.defer();if(h.info("QueuePageController getClientsInQueues fired "),"AVAILABLE"===e.availability&&!e.clientOccupied)return a.getClientsInQueues(t).then((function(o){for(var r of t){o[r]&&o[r].length>0?e.clients[r]=o[r]:e.clients[r]=void 0;var i=e.queues.findIndex((function(e){return e.id==r}));-1!=i&&(e.queues[i].clientLength=e.clients[r]?e.clients[r].length:0,0==e.incomingCallQueueId&&e.queues[i].clientLength>0?(e.incomingCallQueueId=r,e.showIncomingCallComponent(e.queues[i])):e.incomingCallQueueId==r&&e.queues[i].clientLength<=0&&(e.incomingCallQueueId=0,k()))}h.info("QueuePageController getClientsInQueues",o),n.resolve()})).catch((function(e){h.error("QueuePageController getClientsInQueues",e),n.reject()})),n.promise};function P(){cordova.plugins.phonertc.startBeepBoop()}function k(){cordova.plugins.phonertc.stopBeepBoop()}e.$on("applicationResume",(function(t,n){h.info("QueuePageController applicationResume fired "),0!=e.incomingCallQueueId&&P(),n&&0!=n&&(e.callQueueId=n),l.checkForUpdates().then((function(){A()})).catch((function(e){h.warn("QueuePageController checkForUpdates: ",e)}))})),e.changeAvailability=function(){var t;(h.info("QueuePageController changeAvailability fired "),I)&&(I=!1,e.availabilityToggle?(e.availabilityToggle=!1,t="UNAVAILABLE"):(e.availabilityToggle=!0,t="AVAILABLE"),e.setAgentState(t))},e.setAgentState=function(t){var n=v.defer();return function(){if(h.info("QueuePageController isDeviceDetailRegistered fired "),localStorage.getItem("deviceDetailRegistered"))return!0;var e=o.instant("ASSISTBOX_DEVICE_DETAIL_ERROR");return alert(e),h.error("QueuePageController isDeviceDetailRegistered: "+e),!1}()&&t||(t="UNAVAILABLE"),t=t.toUpperCase(),b(),a.setAgentState(t).then(t=>{if(e.availability=t,"AVAILABLE"===e.availability)e.permittedQueueIds&&0!=e.permittedQueueIds.length?n.resolve(t):n.resolve();else if("UNAVAILABLE"===e.availability){for(var r of(e.rejectIncomingCall(),e.clients={},e.queues))r.clientLength=0;n.resolve(t)}c.showToastrShortTop(o.instant("ASSISTBOX_CURRENT_AVAILABILITY")+o.instant("ASSISTBOX_"+t))}).catch(t=>{document.getElementById("availability-checkbox").checked=e.availabilityToggle,c.showErrorToastr(o.instant(t)),h.error("QueuePageController setAgentState: ",t),n.reject()}).finally(()=>{T(),"AVAILABLE"==e.availability?(e.availabilityToggle=!0,O(e.permittedQueueIds)):e.availabilityToggle=!1,I=!0,document.getElementById("availability-checkbox").checked=e.availabilityToggle}),n.promise},e.getAgentState=function(){var t=v.defer();return a.getAgentState().then(n=>{"INCALL"===n?e.setAgentState("AVAILABLE").then(e=>{t.resolve(e)}).catch(e=>{t.reject(e)}):(e.availability=n,"AVAILABLE"==e.availability?(e.availabilityToggle=!0,O(e.permittedQueueIds).finally(()=>{t.resolve(n)})):(e.availabilityToggle=!1,t.resolve(n)))}).catch(e=>{t.reject(e)}).finally(()=>{I=!0,document.getElementById("availability-checkbox").checked=e.availabilityToggle}),t.promise},document.addEventListener("deviceReady",(function(){h.info("QueuePageController deviceReady "),cordova.plugins.phonertc.setLogParameters(r.retrieve(),m.getPath(),0,0),e.incomingCallQueueId=0,e.signalServerUrl=p.getSignalServerUrl(),h.info("QueuePageController findQueuesOfLoggedInUser fired "),b(),d.findQueuesOfLoggedInUser().then((function(t){for(var n of(e.queues=t.data,e.permittedQueueIds=[],e.queues))n.clientLength=0,e.permittedQueueIds.push(n.id);O(e.permittedQueueIds),T(),h.info("QueuePageController findQueuesOfLoggedInUser",e.queues)})).catch((function(e){c.showToastrLongTop(error),T(),h.error("QueuePageController findQueuesOfLoggedInUser",error)})),h.info("QueuePageController checkVirtualBackground fired "),s.getVirtualBackgroundImage(e.user.companyId).then((function(e){200===e.status&&e.data&&(cordova.plugins.phonertc.setVirtualBackgroundStatus(!0),cordova.plugins.phonertc.setVirtualBackgroundImageBinary(e.data.binaryFile))})).catch((function(e){h.error("getVirtualBackgroundImage",e)})),async function(){let t=v.defer();const n=function(){h.info("QueuePageController createUserDeviceInfo success"),localStorage.setItem("deviceDetailRegistered",!0),t.resolve()},i=function(){c.showErrorToastr(o.instant(i)),l.removeWaitingPage(),a.disconnectCurrentUserSocket(),h.error("QueuePageController agentOnline",i),t.reject()},s=e.user.userId,u=r.retrieve(),d=m.getPath();if("android"===cordova.platformId){const e=await l.getAssistboxLaunchParameter("oneSignalPushId"),t=await l.getAssistboxLaunchParameter("fcmToken");cordova.plugins.phonertc.createDeviceDetail(n,i,s,u,e,t,d)}else if("ios"===cordova.platformId){const e=await l.getAssistboxLaunchParameter("voipNotificationToken");cordova.plugins.phonertc.createDeviceDetail(n,i,s,u,void 0,e,d)}return t.promise}().then((function(){l.checkForUpdates().then((function(){A()})).catch((function(e){h.warn("QueuePageController checkForUpdates: ",e)}))})).catch((function(){})),function(){const e=r.retrieve(),t=m.getPath();cordova.plugins.phonertc.createNotificationDeviceToken(e,t)}()}),!1),e.selectQueue=function(t,n){h.info("QueuePageController selectQueue: "+JSON.stringify(t)+", isAnswerBtnPressed: "+n),e.callAnsweredTime=new Date,k(),function(){h.info("QueuePageController checkCameraAvailability fired ");let e=sessionStorage.getItem("camera");null!=e&&null!=e||(e="front");var t=v.defer();return"android"==cordova.platformId?(l.showWaitingPage(o.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE")),cordova.plugins.phonertc.checkCameraAvailability((function(){h.info("QueuePageController checkCameraAvailability success "),l.removeWaitingPage(),t.resolve()}),(function(){h.error("QueuePageController checkCameraAvailability error "),l.removeWaitingPage(),t.reject()}),e)):t.resolve(),t.promise}().then((function(){if(e.occupyInProgress)c.showToastrLongTop(o.instant("ASSISTBOX_CALLING_CLIENT_PLEASE_WAIT"));else if(e.occupyInProgress=!0,"AVAILABLE"===e.availability){var n=t.id;e.clients[n]&&0!==e.clients[n].length?e.occupyClient(void 0,n):(e.occupyInProgress=!1,"android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera())}})).catch((function(){"android"==cordova.platformId&&cordova.plugins.phonertc.disposeCamera(),c.showToastrLongTop(o.instant("ASSISTBOX_CANNOT_OPEN_CAMERA")),P()}))},e.occupyClient=function(e,t){c.showToastrLongTop(o.instant("ASSISTBOX_CALLING_CLIENT_PLEASE_WAIT")),a.occupyClient(e,t,w),h.info("QueuePageController occupyClient: "+t)},e.goBack=function(){if(h.info("QueuePageController goBack fired "),e.isQueueSelected)e.isQueueSelected=!1,e.selectedQueue={},e.clientsOfSelectedQueue=[];else{var t=o.instant("ASSISTBOX_LOG_OUT"),n=o.instant("ASSISTBOX_LOG_OUT_CONFIRMATION"),r=o.instant("ASSISTBOX_YES"),i=o.instant("ASSISTBOX_NO");navigator.notification.confirm(n,(function(t){1==t&&a.setAgentState("UNAVAILABLE",!0).then((function(t){e.availability=t,S.logout().then(()=>{e.disconnect(),h.info("QueuePageController LogOut")}).catch((function(e){h.error("QueuePageController AuthenticationService.logout error",e)})),k()})).catch((function(t){h.error("QueuePageController LogOut setAgentState error",t),S.logout().then(()=>{e.disconnect()}).catch((function(e){h.error("QueuePageController AuthenticationService.logout error",e)})),k()}))}),t,[r,i])}},e.rejectIncomingCall=function(){k();let t=new Date;e.incomingCallQueueId&&0!=e.incomingCallQueueId&&a.rejectCallFromQueue(e.incomingCallQueueId,t),e.incomingCallQueueId=0,h.info("QueuePageController rejectIncomingCall: "+e.incomingCallQueueId)},e.endIncomingCall=function(){e.callAnsweredTime||a.canceledCallFromQueue(e.incomingCallQueueId),h.info("QueuePageController endIncomingCall: "+e.incomingCallQueueId),e.incomingCallQueueId=0,k()},e.showIncomingCallComponent=function(t){if(0!=e.incomingCallQueueId){if(e.incomingCallQueue=t,P(),e.isFromNotification)cordova.plugins.phonertc.retrieveCallId(e=>{y.store("call_id",e)});else{let t=new Date,n=C.getRandomId();y.store("call_id",n),a.sendCallReceivedInfo(e.user.userId,t,e.incomingCallQueueId)}e.isFromNotification=!1,h.info("QueuePageController showIncomingCallComponent: ",e.incomingCallQueue)}else e.incomingCallQueue=void 0},e.$on("clientsInQueue",(function(t,n,o,r){if("AVAILABLE"===e.availability){h.info("QueuePageController clientQueueChanged queueId: "+n+", clients: ",o),e.clients[n]=o,e.isQueueSelected&&e.selectedQueue.id==n&&(e.clientsOfSelectedQueue=o);var i=e.queues.findIndex((function(e){return e.id==n}));-1!==i?(e.queues[i].clientLength=o?o.length:0,1===r&&0==e.incomingCallQueueId&&(e.incomingCallQueueId=n,e.showIncomingCallComponent(e.queues[i]))):h.error("QueuePageController.clientsInQueue cannot find queue"),e.$apply()}})),e.$on("closeCallScreen",(function(t,n){h.info("QueuePageController closeCallScreen queueId: "+n),n==e.incomingCallQueueId&&e.endIncomingCall(),O(e.permittedQueueIds)})),e.$on("appPaused",(function(t,n){h.info("QueuePageController appPaused fired "),e.availabilityToggle=!1,k(),a.disconnectCurrentUserSocket(),l.showWaitingPage(o.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE"))})),e.disconnect=function(){h.info("QueuePageController disconnect.."),a.disconnectCurrentUserSocket(),r.clear(),h.clearLogLevelAndCurrentUser(),cordova.plugins.Keyboard.close(),"true"===y.getAndRemove("redirectToMainApplication")?(y.remove("redirectToMainApplication"),AssistBoxRedirection.goBackToMainApplication(null,null,null)):t.go("login",null,{location:"replace"})},e.$on("$destroy",(function(){h.info("QueuePageController destroy"),e.incomingCallQueueId=0}))}o.$inject=["$scope","$state","$stateParams","$translate","TokenStorage","ConfigurationService","SignalService","CompanyService","ToastrService","$rootScope","$injector","QueueService","AppointmentDeviceInfoService","DataFactory","ClaimService","LogService","ServicePath","$q","AuthenticationService","LocalStorageUtil","RandomUtil"],e.exports=o},function(e,t){function n(e,t,n,o,r,i,a,s,c,l){e.videoStatus=!0,e.audioStatus=!0;var u=$("#icons"),d="Front",f=e.user.room;let p=!0,g=ParticipationType();e.toggleMicrophone=function(){let i="";(e.meetingLobbyEnabled||e.isMeetingStarted)&&(e.audioStatus?(e.audioStatus=!1,i=n.instant("ASSISTBOX_YOUR_MIC_OFF")):(e.audioStatus=!0,i=n.instant("ASSISTBOX_YOUR_MIC_ON")),o.info("toggleMicrophone: "+i),r.showToastrShortTop(i),t.changeStreamConstraints(e.audioStatus,e.videoStatus),t.renegotiate(e.audioStatus,e.videoStatus))},e.toggleCamera=function(){let i="";(e.meetingLobbyEnabled||e.isMeetingStarted)&&(e.videoStatus?(e.videoStatus=!1,i=n.instant("ASSISTBOX_YOUR_CAM_IS_OFF"),e.isMeetingStarted||cordova.plugins.phonertc.hideLocalVideoView()):(e.videoStatus=!0,i=n.instant("ASSISTBOX_YOUR_CAM_IS_ON"),e.isMeetingStarted||cordova.plugins.phonertc.showLocalVideoView()),o.info("toggleCamera: "+i),r.showToastrShortTop(i),t.changeStreamConstraints(e.audioStatus,e.videoStatus),t.renegotiate(e.audioStatus,e.videoStatus))},e.changeCameraDirection=function(t){if(o.info("changeCameraDirection start"),!e.meetingLobbyEnabled&&!e.isMeetingStarted)return;if(!e.videoStatus){var i=n.instant("LOCAL_CAMERA_IS_CLOSE");return r.showErrorToastr(i),void o.warning("changeCameraDirection error: ",i)}var a=$(".clientContent"),s=$(".video-container"),c=Math.floor(.9*window.innerWidth);a.width(c),a.height(Math.floor(window.innerHeight-2*$(".video-container")[0].offsetLeft)),s.width(a.width()),s.height(a.height()),localPositionW=s.width()-110,localPositionH=s.height()-250,u.css("height",60),"Front"==d?sessionStorage.setItem("camera","Back"):sessionStorage.setItem("camera","Front"),d=null==d||null==d?"Front":sessionStorage.getItem("camera");cordova.plugins.phonertc.changeCameraDirection((function(){console.log("Switching camera operation is successful."),o.info("changeCameraDirection success: "+d)}),(function(){console.log("Switching camera operation is not successful.");let e=n.instant("ASSISTBOX_CHANGE_CAMERA_DIRECTION_ERROR");o.error("changeCameraDirection error: "+d),r.showErrorToastr(e),"Front"==d?(sessionStorage.setItem("camera","Back"),d="Back"):(sessionStorage.setItem("camera","Front"),d="Front")}),{container:s[0],local:{position:[localPositionW,localPositionH],size:[200,200]},camera:d}),o.info("changeCameraDirection end. Camera: "+d)},e.initOrientationChangeListener=function(){o.info("initOrientationChangeListener");cordova.plugins.phonertc.initOrientationChangeListener((function(e){switch(o.info("orientationChangeSuccess: "+e),e){case"landscape":$("#container").addClass("landscape-icons");break;case"portrait":$("#container").removeClass("landscape-icons")}}))},e.openInAppBrowser=function(e){null==e||e.length<3||(cordova.plugins.phonertc.openInAppBrowser(e),o.info("openInAppBrowser: "+e))};e.saveMeetingResultWhenMeetingStarted=function(n){e.meetingResult={},f=e.user.room,e.meetingStartTime=e.meetingEndTime=new Date,e.saveMeetingResult(n).then((function(r){n===g.HOST&&p&&(p=!1,t.sendMeetingResultInfo(e.clientUser,e.user.queueId,{meetingResultId:e.meetingResult.id,userId:e.user.userId,appointmentId:e.meetingResult.appointmentId,participationType:e.meetingResult.participationType,callAnsweredTime:e.callAnsweredTime}),l.remove("call_id"),cordova.plugins.phonertc.clearCallId()),o.info("saveMeetingResult when meeting started. id: "+r.id+" meetingStartDate: "+r.meetingStartedDate)})).finally(()=>{clearInterval(e.saveMeetingIntervalId),e.saveMeetingIntervalId=setInterval((function(){e.meetingEndTime=new Date,e.saveMeetingResult()}),1e4)})},e.saveMeetingResult=function(t){let n=a.defer();return null==f?(n.reject(),n.promise):(e.meetingResult.id||(e.meetingResult.meetingStartedDate=e.meetingStartTime,e.meetingResult.appointmentId=f,e.meetingResult.participantId=e.user.participantId,e.meetingResult.participationType=t,e.meetingResult.clientDeviceId=c.deviceInfoId),e.meetingResult.meetingCompletedDate=e.meetingEndTime,s.saveMeetingResult(e.meetingResult).then((function(t){200===t.status?(e.meetingResult=t.data,n.resolve(t.data)):n.reject("saveMeetingResult result status code: "+t.status)})).catch((function(e){o.error("saveMeetingResult",e),n.reject(e)})),n.promise)},e.getHiddenComponents=function(t){i.getHiddenComponentList(t).then(t=>{console.log(t),e.hiddenComponents=t.data,e.hiddenComponentsChecked=!0,e.initOrientationChangeListener()}).catch(e=>{o.error("getHiddenComponentList",e)})}}n.$inject=["$scope","SignalService","$translate","LogService","ToastrService","HiddenComponentService","$q","MeetingResultService","$rootScope","LocalStorageUtil"],e.exports=n},function(e,t){function n(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h){e.user=t.getCurrentUser();let m,v=0,S=!0,y=ParticipationType(),C=!1;i("VideoCallCommonController",{$scope:e}),e.getHiddenComponents("mobileC2cClient");async function I(){e.user.firstName=await u.getAssistboxLaunchParameter("firstName"),e.user.lastName=await u.getAssistboxLaunchParameter("lastName"),e.user.email=await u.getAssistboxLaunchParameter("email"),e.user.phoneNo=await u.getAssistboxLaunchParameter("phone"),e.user.uuid="mobile"+Math.random().toString(36).substr(2,9),e.user.deviceType="mobile",e.user.firstName=null!=e.user.firstName?e.user.firstName:"",e.user.lastName=null!=e.user.lastName?e.user.lastName:"",e.user.fullName=e.user.firstName+" "+e.user.lastName,n.getConfigurationsByTypeAndCompanyId("SIGNAL_SERVER",e.user.companyId).then((function(t){d.connect(t.data.SIGNAL_SERVER_URL,s.retrieve(),e.user).then((function(t){!async function(){e.queueCode=await u.getAssistboxLaunchParameter("queueCode"),o.getQueueInfo(e.queueCode).then((function(t){e.queueId=t.data.id,e.queueId||(g.showErrorToastr(p.instant("ASSISTBOX_QUEUE_NOT_FOUND")),l.error("queue not found",e.queueCode),u.handleLogout()),$("#clientIonContent").append(f("<video-view></video-view>")(u)),$("#videoDiv").append(f("<div class='loading'>Loading&#8230;</div>")(e)),$("#videoDiv").append(f(" <div  class='loadingSpinner'><span class='loadingSpan'> "+p.instant("ASSISTBOX_WAITING_QUEUE")+"</span></div>")(e)),d.joinClientQueue(e.queueId,s.retrieve())})).catch((function(t){g.showErrorToastr(p.instant("ASSISTBOX_QUEUE_NOT_FOUND")),l.error("getQueueInfo error: ",t,"queueCode: ",e.queueCode),u.handleLogout()}))}()})).catch((function(e){}))}))}document.addEventListener("deviceready",(async function(){if(await u.getAssistboxLaunchParameter("showContactForm")){I()}else I()}),!1),e.closeChatModal=function(){e.closeChatWithCallback((function(){h((function(){cordova.plugins.phonertc.showVideoView(e.videoStatus)}),250)})),l.info("closeChatModal")},e.stopMeeting=function(e){l.info("C2ClientController stopMeeting fired, didClickStopButton: "+e),g.showToastrLongTop(p.instant("ASSISTBOX_END_MEETING_WAIT")),T(),cordova.plugins.phonertc.hideVideoView(),d.endCall()};e.openChatModal=function(){e.openChatWithCallback((function(){cordova.plugins.phonertc.hideVideoView()}),[]),l.info("C2CClientController openChatModal")};let b=function(){e.isMeetingStarted||(e.isMeetingStarted=!0,e.saveMeetingResultWhenMeetingStarted(y.PARTICIPANT),cordova.plugins.phonertc.closeInAppBrowser(),e.closeChatModal(),n.getConfigurationsByTypeAndCompanyId("MEETING",e.user.companyId).then((function(t){t.data.SHOW_RESULT_MODAL&&"T"==t.data.SHOW_RESULT_MODAL&&(C=!0,i("SurveyResultController",{$scope:e})),l.info("C2CClientController getRecordType")})).catch((function(e){l.error("C2CClientController getRecordType error",e)})),l.info("C2CClientController startMeeting")),g.showToastrShortBottom(p.instant("ASSISTBOX_PEER_CONNECTION_ESTABLISHED"))};e.$on("incomingCall",(function(e,t){let n=t;d.answerCall(n,!1)})),e.$on("callAnswered",(function(e,t){let n=t.user;b(),l.info("C2ClientController callAnswered",n)}));var T=function(){e.meetingEndTime=new Date,clearInterval(e.saveMeetingIntervalId)};e.$on("endMeeting",(function(t,n){l.info("C2ClientController endMeeting"),e.user.room?(n.endCallInitiatior||T(),e.isMeetingStarted?e.saveMeetingResult(y.PARTICIPANT).then((function(t){l.info("saveMeetingResult when meeting ended. id: "+t.id+" duration: "+t.duration),C&&e.meetingResult&&e.meetingResult.id?(e.closeChatModal(),cordova.plugins.phonertc.closeInAppBrowser(),e.openSurveyResultModal(!e.isExpertUser,(function(){e.$destroy()}))):e.$destroy()})).catch((function(t){e.$destroy()})).finally((function(){e.meetingEndTime,e.meetingStartTime=0})):e.$destroy(),e.isMeetingStarted=!1):e.$destroy()})),e.$on("appPaused",(function(t,n){l.info("appPaused on c2c_client"),e.stopCapture(),d.callInProgress&&cordova.plugins.phonertc.startOngoingCallNotification(p.instant("ASSISTBOX_RETURN_TO_VIDEO_MEETING"))})),e.$on("appResume",(function(){l.info("appResume on c2c_client"),e.startCapture(),cordova.plugins.phonertc.stopOngoingCallNotification()})),e.stopCapture=function(){cordova.plugins.phonertc.stopCapture()},e.startCapture=function(){cordova.plugins.phonertc.startCapture(e.videoStatus)},e.$on("$destroy",(function(){if(S=!1,l.info("C2ClientController destroy"),d.leaveRoom(e.user.room),d.disconnectCurrentUserSocket(),null!=m){let e=function(e){g.showToastrShortBottom(p.instant("ASSISTBOX_UNEXPECTED_ERROR")),l.info("C2ClientController queue forwarding error: ",e),u.handleLogout()};return l.info("C2ClientController forwarding to queue: "+m),void cordova.plugins.phonertc.forwardToQueue(e,m)}u.handleLogout()})),e.$on("triggerContactForm",(function(){})),e.$on("queueOrder",(function(t,n){console.log("queueOrder : "+n),S&&(n>0?$(".loadingSpan").html(p.instant("ASSISTBOX_WAITING_QUEUE")):o.getAvailableAgentCountInQueue().then(t=>{!function t(n){if(!S)return;0===n?(e.loadingTextTimeout&&clearTimeout(e.loadingTextTimeout),$(".loadingSpan").html(p.instant("ASSISTBOX_WAITING_QUEUE"))):$(".loadingSpan").html(p.instant("ASSISTBOX_WILL_CONNECT_CALL"));clearTimeout(e.loadingTextTimeout),e.loadingTextTimeout=setTimeout((function(){o.getAvailableAgentCountInQueue().then(e=>{t(e.data)}).catch(e=>{l.error("Get available agent count in queue error: ",e)})}),5e3),l.info("Available Agent Count: "+n)}(t.data)}),d.changeStreamConstraints(e.audioStatus,e.videoStatus),l.info("queueOrderListener: "+n))})),e.$on("forwardToQueue",(async function(t,n){l.info("C2CClientController forwardToQueue: "+n),m=n,e.stopMeeting()})),e.$on("occupied",(function(){S=!1,$(".loadingSpan").html(p.instant("ASSISTBOX_CALL_STARTING"))})),e.$on("destroyLockIsActive",(function(e,t){g.showToastrLongTop(p.instant("ASSISTBOX_CANNOT_OPEN_CAMERA"))})),e.$on("roomAndParticipantInfoReceived",(async function(n,o,a,f,h){!function(){i("ChatController",{$scope:e});if(e.hiddenComponents.includes("chat-btn"))return;$("#chat-btn").show()}(),v=o,e.user.room=o,e.user.participantId=a,l.setAppointmentId(e.user.room),l.setParticipantId(e.user.participantId),r.isEmpty(f)||(s.store(f),await t.fetchCurrentUser(f)),d.joinRoom(v).then((function(e){d.sendRoomInfoReceivedMessage(h)})).catch(e=>{l.error("C2CClientController joinRoom: ",e),g.showToastrShortBottom(p.instant("ASSISTBOX_UNEXPECTED_ERROR")),d.endCall()}),c.createAppointmentDeviceInfo(v).then((function(e){200===e.status&&(u.deviceInfoId=e.data.id,l.info("C2CClientController createAppointmentDeviceInfo: ",e.data))})).catch(e=>{l.error("C2CClientController createAppointmentDeviceInfo: ",e)}),l.info("C2CClientController joinRoom: ",v)}))}n.$inject=["$scope","UserService","ConfigurationService","QueueService","StringUtil","$controller","TokenService","TokenStorage","AppointmentDeviceInfoService","LogService","$rootScope","SignalService","$compile","$translate","ToastrService","$timeout"],e.exports=n},function(e,t,n){n(19);var o=angular.module("AssistBoxMobile",["ionic","ui.router","pascalprecht.translate"]);n(0),n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),o.controller("MainPageController",n(0)),o.controller("ClientController",n(1)),o.controller("AppController",n(2)),o.controller("RatingPageController",n(3)),o.controller("ReceptionController",n(4)),o.controller("ChatController",n(5)),o.controller("ForwardQueueController",n(6)),o.controller("FileController",n(7)),o.controller("FilePageController",n(8)),o.controller("LoginController",n(9)),o.controller("SurveyResultController",n(10)),o.controller("SignupController",n(11)),o.controller("MyAppointmentsController",n(12)),o.controller("NewAppointmentController",n(13)),o.controller("C2cVideoCallController",n(14)),o.controller("QueuePageController",n(15)),o.controller("VideoCallCommonController",n(16)),o.controller("C2CClientController",n(17)),o.factory("TokenStorage",n(28)),o.factory("DeviceState",n(29)),o.factory("UsageModule",n(30)),o.factory("LocalStorageUtil",n(31)),o.factory("DataFactory",n(32)),o.factory("TokenAuthInterceptor",n(33)),o.factory("ServicePath",n(34)),o.service("AppointmentService",n(35)),o.service("AppointmentDeviceInfoService",n(36)),o.service("FileService",n(37)),o.service("UserService",n(38)),o.service("ConfigurationService",n(39)),o.service("SignalService",n(40)),o.service("AuthenticationService",n(41)),o.service("StringUtil",n(42)),o.service("RandomUtil",n(43)),o.service("SfuVideoRoomService",n(44)),o.service("P2PVideoCallService",n(50)),o.factory("BusyService",n(51)),o.service("MimeTypeService",n(52)),o.service("MessageSenderService",n(53)),o.service("DepartmentService",n(54)),o.service("ToastrService",n(55)),o.service("QueueService",n(56)),o.service("ConfigurationUtil",n(57)),o.service("LoginHandlerService",n(58)),o.service("ClaimService",n(59)),o.service("HiddenComponentService",n(60)),o.service("AppointmentBinaryService",n(61)),o.service("MediaProcessingService",n(62)),o.service("CompanyService",n(63)),o.service("ContactService",n(64)),o.factory("LogService",n(65)),o.service("RedisSignalService",n(66)),o.service("TokenService",n(67)),o.service("MeetingResultService",n(68)),o.service("SurveyResultService",n(69)),o.service("InternalTokenService",n(70)),o.service("PermissionService",n(71)),o.service("LoadBalancerService",n(72)),o.config(["$stateProvider","$httpProvider","$ionicConfigProvider","$translateProvider",function(e,t,n,o){n.tabs.position("bottom"),n.navBar.alignTitle("center"),t.interceptors.push("TokenAuthInterceptor"),t.interceptors.push("BusyService"),n.views.maxCache(0),n.scrolling.jsScrolling(!0),n.views.swipeBackEnabled(!1),e.state("app",{url:"/app",abstract:!0,templateUrl:"menu.html",controller:"AppController",headers:{HideLoadingBar:!0}}).state("mainPage",{url:"/main-page",templateUrl:"main-page.html",controller:"MainPageController"}).state("videoCallMobile",{url:"/videoCallMobile",params:{currentUser:null,activateUser:null},templateUrl:"client.html",controller:"ClientController"}).state("ratingpage",{url:"/rating-page",templateUrl:"rating-page.html",controller:"RatingPageController"}).state("reception",{url:"/reception",params:{currentUser:null},templateUrl:"reception.html",controller:"ReceptionController"}).state("filePage",{url:"/file-page",params:{currentUser:null},templateUrl:"file-page.html",controller:"FilePageController"}).state("filePage.incoming",{url:"/incoming",views:{"tab-incoming-file":{templateUrl:"incoming-files.html"}}}).state("filePage.outgoing",{url:"/outgoing",views:{"tab-outgoing-file":{templateUrl:"outgoing-files.html"}}}).state("login",{url:"/login",templateUrl:"login.html",controller:"LoginController"}).state("signup",{url:"/signup",templateUrl:"signup.html",controller:"SignupController"}).state("tabs",{url:"/tabs",templateUrl:"tabs.html",abstract:!0}).state("tabs.home",{url:"/home",views:{"tab-home":{templateUrl:"main-page.html",controller:"MainPageController"}}}).state("tabs.myAppointments",{url:"/my-appointments",params:{companyId:null},views:{"tab-appointments":{templateUrl:"myappointments.html",controller:"MyAppointmentsController"}}}).state("c2cVideoCall",{url:"/c2cVideoCall",params:{currentUser:null,clientUser:null,queueId:null,callAnsweredTime:null},templateUrl:"c2cpages/c2c-video-call.html",controller:"C2cVideoCallController"}).state("queuePage",{url:"/queue-page",params:{currentUser:null,callQueueId:null},templateUrl:"c2cpages/queue-page.html",controller:"QueuePageController"}).state("c2cClient",{url:"/c2cClient",params:{queueCode:null},templateUrl:"c2cpages/c2c-client.html",controller:"C2CClientController"}),o.useStaticFilesLoader({prefix:"./translate/locale-",suffix:".json"}),o.useSanitizeValueStrategy("escaped"),o.useLoaderCache(!0)}]),o.run(["$ionicPlatform","$rootScope","$ionicHistory","SignalService","UserService","$state","TokenStorage","ConfigurationService","$translate","ServicePath","LocalStorageUtil","AppointmentDeviceInfoService","DataFactory","ToastrService","FileService","LoginHandlerService","ConfigurationUtil","$q","LogService","StringUtil","CompanyService","TokenService","DeviceState","$timeout","PermissionService",function(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h,m,v,S,y,C,I,b,T,w){e.ready((function(){function g(e){var t=y.isEmpty(e)?navigator.language||navigator.userLanguage:e;return t="en-US"==t||"en-UK"==t||"en-GB"==t||t.toLowerCase().includes("en")?"en":"tr-TR"==t||"tr"==t||"TR"==t||"tr-tr"==t||t.toLowerCase().includes("tr")?"tr":"es-ES"==t||t.toLowerCase().includes("es")?"es":"ro"==t||"ro_MD"==t||"ro_RO"==t||"ro-MD"==t||"ro-RO"==t||t.toLowerCase().includes("ro")?"ro":"en"}async function T(e){var t=g(e),n="INSURANCE";let o=r.getCurrentUser();o&&(n=o.companyType);var i=n+"-"+t;await c.use(i.toLowerCase())}(async function(){await r.fetchCurrentUser(),await T()})().then((function(){let A={},E={},_=!1;async function R(e){console.log("handle login state: "+e),w.checkVideoCallPermissions().then(async()=>{const n=await P("useModule");a.setUseModule(n);const o="true"===await P("redirectToMainApplication");switch(u.store("redirectToMainApplication",o),n){case"VIDEO_CALL":!async function(e){console.log("handleLoginForVideoCall state: "+e);try{cordova.plugins.phonertc.setVirtualBackgroundStatus(!1);const n=await P("accessToken"),o=await P("mobileServiceEndpoint");(y.isEmpty(n)||y.isEmpty(o))&&M(),l.setPath(o),S.connectToSocket(o);const s=await P("isNotificationBased");f.setIsNotificationBased(s),a.store(n),await r.fetchCurrentUser(n),A=r.getCurrentUser(),O(A),S.setAppointmentId(A.appointmentId),S.setParticipantId(A.participantId),S.error("Version 4.3.0"),e==b.DEVICE_READY?(S.info("handleLoginForVideoCall DeviceState.DEVICE_READY"),cordova.plugins.phonertc.createNotificationDeviceToken(n,o),await t.checkForUpdates(),T(),k(A.participantId)):e==b.RESUME?(console.log("user continues to use app"),S.info("handleLoginForVideoCall DeviceState.RESUME"),t.removeWaitingPage()):(console.log("handleLoginForVideoCall else state: "+e),i.go("mainPage"),t.removeWaitingPage())}catch(e){S.error("Encountered exception in handleLoginForVideoCall",e),M()}}(e);break;case"C2C_CLIENT":!async function(e){console.log("handleLoginForC2CClientModule state: "+e);try{cordova.plugins.phonertc.setVirtualBackgroundStatus(!1);const n=await P("mobileServiceEndpoint"),o=await P("accessToken"),i=await P("language");l.setPath(n),S.connectToSocket(n),e==b.DEVICE_READY?(a.store(o),await r.fetchCurrentUser(o),await t.checkForUpdates(),A=r.getCurrentUser(),O(A),T(i),k()):e==b.RESUME&&(A=r.getCurrentUser())}catch(e){S.error("Encountered exception in handleLoginForC2CClientModule",e),M()}}(e);break;case"C2C_AGENT":default:!async function(e){console.log("handleLoginForC2CAgentModule state: "+e);try{const t=await P("mobileServiceEndpoint");let n=await P("accessToken");y.isEmpty(n)&&(n=a.retrieve()),l.setPath(t),S.connectToSocket(t),e==b.DEVICE_READY&&T(),y.isEmpty(n)?(T(),i.go("login",null,{location:"replace"})):(a.store(n),await r.fetchCurrentUser(n),O(r.getCurrentUser()),function(e){cordova.plugins.phonertc.retrieveIncomingCallQueueId((function(t){cordova.plugins.phonertc.clearIncomingCallQueueId();var n=a.retrieve();h.handleUserLogin(!1,n,t,e),S.info("mobileAppEntry didAnswerVoipCall: "+t)}))}(e))}catch(e){S.error("Encountered exception in handleLoginForC2CAgentModule",e),M()}}(e)}}).catch(()=>{S.error("mobileAppEntry checkVideoCallPermissions Failed")})}function O(e){e&&e.companyId&&s.getConfigurationsByTypeAndCompanyId("VIDEO",e.companyId).then((function(e){if(200==e.status){let t=e.data.MOBILE_VIDEO_WIDTH,n=e.data.MOBILE_VIDEO_HEIGHT;cordova.plugins.phonertc.setCameraResolutions(t,n),S.info("Video Width And Height set successfully width: "+t+", height: "+n)}})).catch((function(e){S.error("getAndSetVideoWidthHeight failed",e)}))}function P(e){let t=v.defer();return cordova.plugins.phonertc.getAssistboxLaunchParameter((function(e){t.resolve(e)}),e),t.promise}function k(e){s.getConfigurationsByTypeAndCompanyId("LEGAL",A.companyId).then((function(t){var n;t.data.SHOW_CUSTOMER_LEGAL_INFO&&"T"==t.data.SHOW_CUSTOMER_LEGAL_INFO?(n=v.defer(),C.getCompany(A.companyId).then((function(e){200==e.status&&(companyInfo=e.data,C.getCompanyLegalDetails(A.companyId).then((function(e){if(200==e.status){let t,o,r=c.instant("ASSISTBOX_USAGE_POLICY_TITLE");E=e.data,angular.forEach(E,(function(e){c.use().toLowerCase().includes(e.languageValue)&&(o=e.id,t=e.text,e.title&&(r=e.title))}));let i={usagePolicyInfo:t,legalDetailId:o,title:r};n.resolve(i)}})).catch((function(e){S.error("getCompanyLegalDetails",e),n.reject()})))})).catch((function(e){S.error("getCompany",e),n.reject()})),n.promise).then((function(t){cordova.plugins.phonertc.checkPolicyApproval((function(){N().then((function(){U()})).catch((function(e){M()}))}),(function(){if(t.usagePolicyInfo){!function(e){let t=c.instant("ASSISTBOX_OK"),n=c.instant("ASSISTBOX_EXIT_NOUN"),o=c.instant("ASSISTBOX_EXIT_NOUN"),r=c.instant("ASSISTBOX_RECONNECT"),i=c.instant("ASSISTBOX_USAGE_POLICY_INFO_REJECT_MESSAGE"),s={usagePolicyInfo:e.usagePolicyInfo,title:e.title,approveButtonLabel:t,denyButtonLabel:n,closeButtonLabel:o,reconnectButtonLabel:r,legalDetailId:e.legalDetailId,policyInfoRejectMessage:i},u=e.participantId?e.participantId:0;cordova.plugins.phonertc.showPolicyPopup((function(e){1==e?N().then((function(){U()})).catch((function(e){M()})):M()}),s,u,a.retrieve(),l.getPath())}({usagePolicyInfo:t.usagePolicyInfo,title:t.title,participantId:e,legalDetailId:t.legalDetailId})}else N().then((function(){U()})).catch((function(e){M()}))}),l.getPath(),a.retrieve(),t.legalDetailId)})).catch((function(e){S.error("handlePolicyOperations getCompanyLegalDetails: ",e),D(e)})):N().then((function(){U()})).catch((function(e){M()}))})).catch((function(e){S.error("handlePolicyOperations getConfigurationsByTypeAndCompanyId(LEGAL): ",e),D(e)}))}function L(e,n,r,c){var l=a.retrieve();s.getConfigurationsByTypeAndCompanyId("SIGNAL_SERVER",r).then((function(a){_=!1,o.connect(a.data.SIGNAL_SERVER_URL,l,e).then((function(e){(function(e,n,r,i){var a=v.defer();return o.online(e).then((function(){o.setCompanyId(n),o.joinRoom(r),d.createAppointmentDeviceInfo(r).then((function(e){200===e.status&&(t.deviceInfoId=e.data.id,S.info("mobileAppEntry device info: ",e.data))})).catch(e=>{S.error("mobileAppEntry createAppointmentDeviceInfo: ",e)}),S.info("mobileAppEntry onlineUser: ",e),a.resolve()})).catch(e=>{a.reject(e),S.error("mobileAppEntry onlineUser: ",e)}),a.promise})(e,r,n).then((function(){!function(e,n){m.checkBooleanConfiguration(e,"SHOW_RECEPTION_PAGE")?(f.setUser(n),i.go("reception",{currentUser:n},{location:"replace"})):i.go("videoCallMobile",{currentUser:n,activateUser:!0},{location:"replace"});setTimeout((function(){t.removeWaitingPage()}),1e3)}(c,e),S.info("mobileAppEntry handleToken connect")})).catch(e=>{S.error("getConfigurationsByTypeAndCompanyId onlineUser",e)})})).catch((function(e){S.error("mobileAppEntry handleToken connect : ",e),j(),M()}))})).catch((function(e){S.error("mobileAppEntry handleToken getConfigurationsByTypeAndCompanyId(SIGNAL_SERVER): ",e),D(e)}))}function U(){let e=l.getPath();S.info("mobileAppEntry initializeHandleToken permissionCheckSuccess");var t=a.retrieve();cordova.plugins.phonertc.setLogParameters(t,e,A.appointmentId,A.participantId),S.info("mobileAppEntry handleToken clicked link approved"),t&&I.getDataFromJwtToken(t).then((function(e){var t=e.data.appointmentId,n=e.data.companyId,o="mobile"+Math.random().toString(36).substr(2,9),r={fullName:e.data.fullName,socket:"",room:t,uuid:o,companyId:n,participantId:e.data.participantId};s.getConfigurationsByTypeAndCompanyId("MOBILE",n).then((async function(e){if(!(!e.data.CAN_MAKE_APPOINTMENT||"T"!=e.data.CAN_MAKE_APPOINTMENT))i.go("tabs.home",null,{location:"replace"});else{switch(await P("useModule")){case"C2C_CLIENT":!async function(){const e=await P("queueCode");i.go("c2cClient",e,{location:"replace"})}();break;case"VIDEO_CALL":default:L(r,t,n,e)}}})).catch((function(e){S.error("mobileAppEntry handleToken getConfigurationsByTypeAndCompanyId(MOBILE): ",e),D(e)}))})).catch((function(e){S.error("mobileAppEntry handleToken getDataFromJwtToken: ",e),D(e)}))}window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),n.nextViewOptions({disableAnimate:!1}),e.on("pause",(function(){let e=b.PAUSE;f.setAppStatus(e),t.$broadcast("appPaused"),S.info("mobileAppEntry appPaused")})),e.on("deviceready",(function(){"android"==cordova.platformId&&e.registerBackButtonAction((function(e){console.log("back button pressed")}),100),console.log("on app.run deviceready");let t=b.DEVICE_READY;cordova.plugins.phonertc.removeViews(),R(t)})),e.on("resume",(async function(){let e=b.RESUME;console.log("on app.run resume: "+JSON.stringify(A)),f.setAppStatus(e),t.$broadcast("appResume"),R(e),S.info("mobileAppEntry appResume")})),t.getAndSetVideoWidthHeight=O,t.getAssistboxLaunchParameter=P;var N=function(){var e=v.defer();return C.getLinkNotificationSettings().then((function(n){if(200==n.status)if(S.info("getLinkNotificationSettings activated: "+n.data.activated),n.data.activated){for(var o,r=g(),i=null,s=0;s<n.data.linkNotificationDetailConfigurations.length;s++){if(r==n.data.linkNotificationDetailConfigurations[s].languageValue){i=n.data.linkNotificationDetailConfigurations[s].labelText;break}"en"==n.data.linkNotificationDetailConfigurations[s].languageValue&&(o=n.data.linkNotificationDetailConfigurations[s].labelText)}i||(i=o);let u={appointmentId:A.appointmentId.toString(),labelText:i,saveButtonText:c.instant("ASSISTBOX_SEND"),token:a.retrieve(),serviceEndpoint:l.getPath(),emptyMessage:c.instant("ASSISTBOX_INPUT_REQUIRED_MESSAGE_LABEL_TEXT",{labelText:i})};cordova.plugins.phonertc.checkLinkAndSendNotification((function(){S.info("checkLinkSuccess"),B(c.instant("ASSISTBOX_PLEASE_WAIT_FOR_A_WHILE")),e.resolve()}),(function(t){p.showErrorToastr(c.instant("ASSISTBOX_LINK_NOTIFICATION_ERROR",{labelText:i})),S.error("checkLinkError: ",t),e.reject()}),u),t.removeWaitingPage(),$("ion-nav-view")&&$("ion-nav-view").css("visibility","hidden")}else e.resolve()})).catch((function(t){S.error("getLinkNotificationSettings: ",t),e.reject()})),e.promise};function M(){console.log("handle logout"),"true"===u.retrieve("redirectToMainApplication")?(console.log("external system"),AssistBoxRedirection.goBackToMainApplication(null,null,null)):(console.log("internal system"),i.go("mainPage"),t.removeWaitingPage())}function D(e){t.removeWaitingPage(),-1==e.status?F().then((function(){M()})):M()}function B(e){$("#waiting-content").remove(),$("ion-nav-view")&&$("ion-nav-view").css("visibility","hidden"),$("body").append(" <ion-content id='waiting-content' scroll='false'><div class='spacer ic-selected' id='waiting-content-spacer' style='width: 300px;'></div><div class='main-content-header-span'><span style='font-weight: 600;'>"+e+"</span></div><div class='spacer ic-selected' style='width: 300px;height: 20px;'></div><main role='main'><div aria-busy='true' aria-label='Loading' role='progressbar'></div></main></ion-content>")}function F(){var e=v.defer();t.removeWaitingPage(),S.error("mobileAppEntry connectionError");var n=c.instant("ASSISTBOX_CONNECTION_ERROR_TITLE"),o=c.instant("ASSISTBOX_CONNECTION_ERROR_MESSAGE"),r=c.instant("ASSISTBOX_CLOSE");return navigator.notification.alert(o,(function(){e.resolve()}),n,r),e.promise}function j(){t.removeWaitingPage(),_=!0,S.error("mobileAppEntry signalServiceConnectionError");var e=c.instant("ASSISTBOX_CONNECTION_ERROR_TITLE"),n=c.instant("ASSISTBOX_SIGNAL_SERVICE_CONNECT_ERROR"),o=c.instant("ASSISTBOX_CLOSE");navigator.notification.alert(n,null,e,o)}t.handleLogout=M,t.showWaitingPage=function(e){B(e)},t.removeWaitingPage=function(){$("#waiting-content").remove(),$("ion-nav-view")&&$("ion-nav-view").css("visibility","visible")},t.checkForUpdates=function(){var e=v.defer();return cordova.plugins.phonertc.checkForUpdates((function(n){"NO_UPDATE"==n||"DENIED_RECOMMENDED_UPDATE"==n?e.resolve():"CLICKED_REQUIRED_UPDATE"!=n&&"CLICKED_RECOMMENDED_UPDATE"!=n&&"DENIED_REQUIRED_UPDATE"!=n||t.checkForUpdates().then(()=>{e.resolve()}).catch(t=>{e.reject(t)})}),a.retrieve(),l.getPath()),e.promise},t.$on("connectionError",(function(){F()})),t.$on("onSignalServiceConnectError",(function(e,t){_||j()}))}))}))}]),o.directive("videoView",["$rootScope","$timeout",function(e,t){return{restrict:"E",template:'<div class="video-container"></div>',replace:!0,link:function(t,n,o){e.$on("updateVideoPosition",(function(e,t){!function(){var e=sessionStorage.getItem("camera");if(null!=e&&null!=e||(e="Front"),null!=$(".video-container")[0]){var t=$(".clientContent"),o=$(".video-container"),r=Math.floor(.9*window.innerWidth);t.width(r),t.height(Math.floor(window.innerHeight-2*$(".video-container")[0].offsetLeft)),o.width(t.width()),o.height(t.height()),localPositionW=o.width()-110,localPositionH=o.height()-250,cordova.plugins.phonertc.setVideoView({container:n[0],local:{position:[localPositionW,localPositionH],size:[200,200]},camera:e})}}()}))}}}]),o.directive("keyboardResize",["$ionicScrollDelegate",function(e){return{restrict:"A",link:function(t,n,o){function r(t){"android"==cordova.platformId?n.css("bottom",t.keyboardHeight+30+"px"):n.css("bottom","15px"),e.$getByHandle(o.delegateHandle).resize()}function i(t){n.css("bottom",""),e.$getByHandle(o.delegateHandle).resize()}ionic.on("native.keyboardshow",r,window),ionic.on("native.keyboardhide",i,window),t.$on("$destroy",(function(){ionic.off("native.keyboardshow",r,window),ionic.off("native.keyboardhide",i,window)}))}}}]),o.directive("checkToHide",(function(){return{restrict:"A",link:function(e,t,n){e.hiddenComponents.includes(n.id)&&t.hide()}}}))},function(e,t,n){var o;
/*!
 * angular-translate - v2.18.1 - 2018-05-19
 * 
 * Copyright (c) 2018 The angular-translate team, Pascal Precht; Licensed MIT
 */void 0===(o=function(){return function(){function e(e){"use strict";var t=e.storageKey(),n=e.storage(),o=function(){var o=e.preferredLanguage();angular.isString(o)?e.use(o):n.put(t,e.use())};o.displayName="fallbackFromIncorrectStorageValue",n?n.get(t)?e.use(n.get(t)).catch(o):o():angular.isString(e.preferredLanguage())&&e.use(e.preferredLanguage())}function t(e,t,n,o){"use strict";var r,i,a,s,c,l,u,d,f,p,g,h,m,v,S,y,C={},I=[],b=e,T=[],w="translate-cloak",A=!1,E=!1,_=".",R=!1,O=!1,P=0,k=!0,L="default",U={default:function(e){return(e||"").split("-").join("_")},java:function(e){var t=(e||"").split("-").join("_"),n=t.split("_");return n.length>1?n[0].toLowerCase()+"_"+n[1].toUpperCase():t},bcp47:function(e){var t=(e||"").split("_").join("-"),n=t.split("-");switch(n.length){case 1:n[0]=n[0].toLowerCase();break;case 2:n[0]=n[0].toLowerCase(),4===n[1].length?n[1]=n[1].charAt(0).toUpperCase()+n[1].slice(1).toLowerCase():n[1]=n[1].toUpperCase();break;case 3:n[0]=n[0].toLowerCase(),n[1]=n[1].charAt(0).toUpperCase()+n[1].slice(1).toLowerCase(),n[2]=n[2].toUpperCase();break;default:return t}return n.join("-")},"iso639-1":function(e){return(e||"").split("_").join("-").split("-")[0].toLowerCase()}},N=function(){if(angular.isFunction(o.getLocale))return o.getLocale();var e,n,r=t.$get().navigator,i=["language","browserLanguage","systemLanguage","userLanguage"];if(angular.isArray(r.languages))for(e=0;e<r.languages.length;e++)if((n=r.languages[e])&&n.length)return n;for(e=0;e<i.length;e++)if((n=r[i[e]])&&n.length)return n;return null};N.displayName="angular-translate/service: getFirstBrowserLanguage";var M=function(){var e=N()||"";return U[L]&&(e=U[L](e)),e};M.displayName="angular-translate/service: getLocale";var $=function(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},D=function(){return this.toString().replace(/^\s+|\s+$/g,"")},B=function(e){return angular.isString(e)?e.toLowerCase():e},F=function(e){if(e){for(var t,n=[],o=B(e),r=0,a=I.length;r<a;r++)n.push(B(I[r]));if((r=$(n,o))>-1)return I[r];if(i)for(var s in i)if(i.hasOwnProperty(s)){var c=!1,l=Object.prototype.hasOwnProperty.call(i,s)&&B(s)===B(e);if("*"===s.slice(-1)&&(c=B(s.slice(0,-1))===B(e.slice(0,s.length-1))),(l||c)&&(t=i[s],$(n,B(t))>-1))return t}var u=e.split("_");return u.length>1&&$(n,B(u[0]))>-1?u[0]:void 0}},j=function(e,t){if(!e&&!t)return C;if(e&&!t){if(angular.isString(e))return C[e]}else angular.isObject(C[e])||(C[e]={}),angular.extend(C[e],x(t));return this};this.translations=j,this.cloakClassName=function(e){return e?(w=e,this):w},this.nestedObjectDelimeter=function(e){return e?(_=e,this):_};var x=function(e,t,n,o){var r,i,a;for(r in t||(t=[]),n||(n={}),e)Object.prototype.hasOwnProperty.call(e,r)&&(a=e[r],angular.isObject(a)?x(a,t.concat(r),n,r):(i=t.length?""+t.join(_)+_+r:r,t.length&&r===o&&(n[""+t.join(_)]="@:"+i),n[i]=a));return n};x.displayName="flatObject",this.addInterpolation=function(e){return T.push(e),this},this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")},this.useInterpolation=function(e){return p=e,this},this.useSanitizeValueStrategy=function(e){return n.useStrategy(e),this},this.preferredLanguage=function(e){return e?(V(e),this):r};var V=function(e){return e&&(r=e),r};this.translationNotFoundIndicator=function(e){return this.translationNotFoundIndicatorLeft(e),this.translationNotFoundIndicatorRight(e),this},this.translationNotFoundIndicatorLeft=function(e){return e?(m=e,this):m},this.translationNotFoundIndicatorRight=function(e){return e?(v=e,this):v},this.fallbackLanguage=function(e){return J(e),this};var J=function(e){return e?(angular.isString(e)?(s=!0,a=[e]):angular.isArray(e)&&(s=!1,a=e),angular.isString(r)&&$(a,r)<0&&a.push(r),this):s?a[0]:a};this.use=function(e){if(e){if(!C[e]&&!g)throw new Error("$translateProvider couldn't find translationTable for langKey: '"+e+"'");return c=e,this}return c},this.resolveClientLocale=function(){return M()};var Q=function(e){return e?(b=e,this):d?d+b:b};this.storageKey=Q,this.useUrlLoader=function(e,t){return this.useLoader("$translateUrlLoader",angular.extend({url:e},t))},this.useStaticFilesLoader=function(e){return this.useLoader("$translateStaticFilesLoader",e)},this.useLoader=function(e,t){return g=e,h=t||{},this},this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")},this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")},this.useStorage=function(e){return u=e,this},this.storagePrefix=function(e){return e?(d=e,this):e},this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")},this.useMissingTranslationHandler=function(e){return f=e,this},this.usePostCompiling=function(e){return A=!!e,this},this.forceAsyncReload=function(e){return E=!!e,this},this.uniformLanguageTag=function(e){return e?angular.isString(e)&&(e={standard:e}):e={},L=e.standard,this},this.determinePreferredLanguage=function(e){var t=e&&angular.isFunction(e)?e():M();return r=I.length&&F(t)||t,this},this.registerAvailableLanguageKeys=function(e,t){return e?(I=e,t&&(i=t),this):I},this.useLoaderCache=function(e){return!1===e?S=void 0:!0===e?S=!0:void 0===e?S="$translationCache":e&&(S=e),this},this.directivePriority=function(e){return void 0===e?P:(P=e,this)},this.statefulFilter=function(e){return void 0===e?k:(k=e,this)},this.postProcess=function(e){return y=e||void 0,this},this.keepContent=function(e){return O=!!e,this},this.$get=["$log","$injector","$rootScope","$q",function(e,t,n,o){var i,d,L,U=t.get(p||"$translateDefaultInterpolation"),N=!1,B={},H={},q=function(e,t,n,s,l,f){!c&&r&&(c=r);var p=l&&l!==c?F(l)||l:c;if(l&&ie(l),angular.isArray(e))return function(e){for(var r={},i=[],a=function(e){var i=o.defer(),a=function(t){r[e]=t,i.resolve([e,t])};return q(e,t,n,s,l,f).then(a,a),i.promise},c=0,u=e.length;c<u;c++)i.push(a(e[c]));return o.all(i).then((function(){return r}))}(e);var g=o.defer();e&&(e=D.apply(e));var h=function(){var e=H[p]||H[r];if(d=0,u&&!e){var t=i.get(b);if(e=H[t],a&&a.length){var n=$(a,t);d=0===n?1:0,$(a,r)<0&&a.push(r)}}return e}();if(h){var m=function(){l||(p=c),ne(e,t,n,s,p,f).then(g.resolve,g.reject)};m.displayName="promiseResolved",h.finally(m).catch(angular.noop)}else ne(e,t,n,s,p,f).then(g.resolve,g.reject);return g.promise},X=function(e){return m&&(e=[m,e].join(" ")),v&&(e=[e,v].join(" ")),e},G=function(e){c=e,u&&i.put(q.storageKey(),c),n.$emit("$translateChangeSuccess",{language:e}),U.setLocale(c);var t=function(e,t){B[t].setLocale(c)};t.displayName="eachInterpolatorLocaleSetter",angular.forEach(B,t),n.$emit("$translateChangeEnd",{language:e})},W=function(e){if(!e)throw"No language key specified for loading.";var r=o.defer();n.$emit("$translateLoadingStart",{language:e}),N=!0;var i=S;"string"==typeof i&&(i=t.get(i));var a=angular.extend({},h,{key:e,$http:angular.extend({},{cache:i},h.$http)}),s=function(t){var o={};n.$emit("$translateLoadingSuccess",{language:e}),angular.isArray(t)?angular.forEach(t,(function(e){angular.extend(o,x(e))})):angular.extend(o,x(t)),N=!1,r.resolve({key:e,table:o}),n.$emit("$translateLoadingEnd",{language:e})};s.displayName="onLoaderSuccess";var c=function(e){n.$emit("$translateLoadingError",{language:e}),r.reject(e),n.$emit("$translateLoadingEnd",{language:e})};return c.displayName="onLoaderError",t.get(g)(a).then(s,c),r.promise};if(u&&(!(i=t.get(u)).get||!i.put))throw new Error("Couldn't use storage '"+u+"', missing get() or put() method!");if(T.length){var Y=function(e){var n=t.get(e);n.setLocale(r||c),B[n.getInterpolationIdentifier()]=n};Y.displayName="interpolationFactoryAdder",angular.forEach(T,Y)}var z=function(e,t,n,r,i){var a=o.defer(),s=function(o){if(Object.prototype.hasOwnProperty.call(o,t)&&null!==o[t]){r.setLocale(e);var s=o[t];if("@:"===s.substr(0,2))z(e,s.substr(2),n,r,i).then(a.resolve,a.reject);else{var l=r.interpolate(o[t],n,"service",i,t);l=re(t,o[t],l,n,e),a.resolve(l)}r.setLocale(c)}else a.reject()};return s.displayName="fallbackTranslationResolver",function(e){var t=o.defer();if(Object.prototype.hasOwnProperty.call(C,e))t.resolve(C[e]);else if(H[e]){var n=function(e){j(e.key,e.table),t.resolve(e.table)};n.displayName="translationTableResolver",H[e].then(n,t.reject)}else t.reject();return t.promise}(e).then(s,a.reject),a.promise},K=function(e,t,n,o,r){var i,a=C[e];if(a&&Object.prototype.hasOwnProperty.call(a,t)&&null!==a[t]){if(o.setLocale(e),i=o.interpolate(a[t],n,"filter",r,t),i=re(t,a[t],i,n,e,r),!angular.isString(i)&&angular.isFunction(i.$$unwrapTrustedValue)){var s=i.$$unwrapTrustedValue();if("@:"===s.substr(0,2))return K(e,s.substr(2),n,o,r)}else if("@:"===i.substr(0,2))return K(e,i.substr(2),n,o,r);o.setLocale(c)}return i},Z=function(e,n,o,r){return f?t.get(f)(e,c,n,o,r):e},ee=function(e,t,n,r,i,s){var c=o.defer();if(e<a.length){var l=a[e];z(l,t,n,r,s).then((function(e){c.resolve(e)}),(function(){return ee(e+1,t,n,r,i,s).then(c.resolve,c.reject)}))}else if(i)c.resolve(i);else{var u=Z(t,n,i);f&&u?c.resolve(u):c.reject(X(t))}return c.promise},te=function(e,t,n,o,r){var i;if(e<a.length){var s=a[e];(i=K(s,t,n,o,r))||""===i||(i=te(e+1,t,n,o))}return i},ne=function(e,t,n,r,i,s){var c=o.defer(),l=i?C[i]:C,u=n?B[n]:U;if(l&&Object.prototype.hasOwnProperty.call(l,e)&&null!==l[e]){var p=l[e];if("@:"===p.substr(0,2))q(p.substr(2),t,n,r,i,s).then(c.resolve,c.reject);else{var g=u.interpolate(p,t,"service",s,e);g=re(e,p,g,t,i),c.resolve(g)}}else{var h;f&&!N&&(h=Z(e,t,r)),i&&a&&a.length?function(e,t,n,o,r){return ee(L>0?L:d,e,t,n,o,r)}(e,t,u,r,s).then((function(e){c.resolve(e)}),(function(e){c.reject(X(e))})):f&&!N&&h?r?c.resolve(r):c.resolve(h):r?c.resolve(r):c.reject(X(e))}return c.promise},oe=function(e,t,n,o,r){var i,s=o?C[o]:C,c=U;if(B&&Object.prototype.hasOwnProperty.call(B,n)&&(c=B[n]),s&&Object.prototype.hasOwnProperty.call(s,e)&&null!==s[e]){var l=s[e];"@:"===l.substr(0,2)?i=oe(l.substr(2),t,n,o,r):(i=c.interpolate(l,t,"filter",r,e),i=re(e,l,i,t,o,r))}else{var u;f&&!N&&(u=Z(e,t,r)),o&&a&&a.length?(d=0,i=function(e,t,n,o){return te(L>0?L:d,e,t,n,o)}(e,t,c,r)):i=f&&!N&&u?u:X(e)}return i},re=function(e,n,o,r,i,a){var s=y;return s&&("string"==typeof s&&(s=t.get(s)),s)?s(e,n,o,r,i,a):o},ie=function(e){C[e]||!g||H[e]||(H[e]=W(e).then((function(e){return j(e.key,e.table),e})))};q.preferredLanguage=function(e){return e&&V(e),r},q.cloakClassName=function(){return w},q.nestedObjectDelimeter=function(){return _},q.fallbackLanguage=function(e){if(null!=e){if(J(e),g&&a&&a.length)for(var t=0,n=a.length;t<n;t++)H[a[t]]||(H[a[t]]=W(a[t]));q.use(q.use())}return s?a[0]:a},q.useFallbackLanguage=function(e){if(null!=e)if(e){var t=$(a,e);t>-1&&(L=t)}else L=0},q.proposedLanguage=function(){return l},q.storage=function(){return i},q.negotiateLocale=F,q.use=function(e){if(!e)return c;var t=o.defer();t.promise.then(null,angular.noop),n.$emit("$translateChangeStart",{language:e});var r=F(e);return I.length>0&&!r?o.reject(e):(r&&(e=r),l=e,!E&&C[e]||!g||H[e]?H[e]?H[e].then((function(e){return l===e.key&&G(e.key),t.resolve(e.key),e}),(function(e){return!c&&a&&a.length>0&&a[0]!==e?q.use(a[0]).then(t.resolve,t.reject):t.reject(e)})):(t.resolve(e),G(e)):(H[e]=W(e).then((function(n){return j(n.key,n.table),t.resolve(n.key),l===e&&G(n.key),n}),(function(e){return n.$emit("$translateChangeError",{language:e}),t.reject(e),n.$emit("$translateChangeEnd",{language:e}),o.reject(e)})),H[e].finally((function(){!function(e){l===e&&(l=void 0),H[e]=void 0}(e)})).catch(angular.noop)),t.promise)},q.resolveClientLocale=function(){return M()},q.storageKey=function(){return Q()},q.isPostCompilingEnabled=function(){return A},q.isForceAsyncReloadEnabled=function(){return E},q.isKeepContent=function(){return O},q.refresh=function(e){if(!g)throw new Error("Couldn't refresh translation table, no loader registered!");n.$emit("$translateRefreshStart",{language:e});var t=o.defer(),r={};function i(e){var t=W(e);return H[e]=t,t.then((function(t){C[e]={},j(e,t.table),r[e]=!0}),angular.noop),t}if(t.promise.then((function(){for(var e in C)C.hasOwnProperty(e)&&(e in r||delete C[e]);c&&G(c)}),angular.noop).finally((function(){n.$emit("$translateRefreshEnd",{language:e})})),e)C[e]?i(e).then(t.resolve,t.reject):t.reject();else{var s=a&&a.slice()||[];c&&-1===s.indexOf(c)&&s.push(c),o.all(s.map(i)).then(t.resolve,t.reject)}return t.promise},q.instant=function(e,t,n,o,i){var s=o&&o!==c?F(o)||o:c;if(null===e||angular.isUndefined(e))return e;if(o&&ie(o),angular.isArray(e)){for(var l={},u=0,d=e.length;u<d;u++)l[e[u]]=q.instant(e[u],t,n,o,i);return l}if(angular.isString(e)&&e.length<1)return e;e&&(e=D.apply(e));var p,g,h=[];r&&h.push(r),s&&h.push(s),a&&a.length&&(h=h.concat(a));for(var S=0,y=h.length;S<y;S++){var I=h[S];if(C[I]&&void 0!==C[I][e]&&(p=oe(e,t,n,s,i)),void 0!==p)break}return p||""===p||(m||v?p=X(e):(p=U.interpolate(e,t,"filter",i),f&&!N&&(g=Z(e,t,i)),f&&!N&&g&&(p=g))),p},q.versionInfo=function(){return"2.18.1"},q.loaderCache=function(){return S},q.directivePriority=function(){return P},q.statefulFilter=function(){return k},q.isReady=function(){return R};var ae=o.defer();ae.promise.then((function(){R=!0})),q.onReady=function(e){var t=o.defer();return angular.isFunction(e)&&t.promise.then(e),R?t.resolve():ae.promise.then(t.resolve),t.promise},q.getAvailableLanguageKeys=function(){return I.length>0?I:null},q.getTranslationTable=function(e){return(e=e||q.use())&&C[e]?angular.copy(C[e]):null};var se=n.$on("$translateReady",(function(){ae.resolve(),se(),se=null})),ce=n.$on("$translateChangeEnd",(function(){ae.resolve(),ce(),ce=null}));if(g){if(angular.equals(C,{})&&q.use()&&q.use(q.use()),a&&a.length)for(var le=function(e){return j(e.key,e.table),n.$emit("$translateChangeEnd",{language:e.key}),e},ue=0,de=a.length;ue<de;ue++){var fe=a[ue];!E&&C[fe]||(H[fe]=W(fe).then(le))}}else n.$emit("$translateReady",{language:q.use()});return q}]}function n(e,t){"use strict";var n={setLocale:function(e){},getInterpolationIdentifier:function(){return"default"},useSanitizeValueStrategy:function(e){return t.useStrategy(e),this},interpolate:function(n,o,r,i,a){var s;return o=o||{},o=t.sanitize(o,"params",i,r),angular.isNumber(n)?s=""+n:angular.isString(n)?(s=e(n)(o),s=t.sanitize(s,"text",i,r)):s="",s}};return n}function o(e,t,n,o,r){"use strict";var i=function(){return this.toString().replace(/^\s+|\s+$/g,"")},a=function(e){return angular.isString(e)?e.toLowerCase():e};return{restrict:"AE",scope:!0,priority:e.directivePriority(),compile:function(s,c){var l=c.translateValues?c.translateValues:void 0,u=c.translateInterpolation?c.translateInterpolation:void 0,d=c.translateSanitizeStrategy?c.translateSanitizeStrategy:void 0,f=s[0].outerHTML.match(/translate-value-+/i),p="^(.*)("+t.startSymbol()+".*"+t.endSymbol()+")(.*)",g="^(.*)"+t.startSymbol()+"(.*)"+t.endSymbol()+"(.*)";return function(s,h,m){s.interpolateParams={},s.preText="",s.postText="",s.translateNamespace=function e(t){return t.translateNamespace?t.translateNamespace:t.$parent?e(t.$parent):void 0}(s);var v={},S=function(e){if(angular.isFunction(S._unwatchOld)&&(S._unwatchOld(),S._unwatchOld=void 0),angular.equals(e,"")||!angular.isDefined(e)){var n=i.apply(h.text()),o=n.match(p);if(angular.isArray(o)){s.preText=o[1],s.postText=o[3],v.translate=t(o[2])(s.$parent);var r=n.match(g);angular.isArray(r)&&r[2]&&r[2].length&&(S._unwatchOld=s.$watch(r[2],(function(e){v.translate=e,w()})))}else v.translate=n||void 0}else v.translate=e;w()},y=function(e){m.$observe(e,(function(t){v[e]=t,w()}))};!function(e,t,n){if(t.translateValues&&angular.extend(e,o(t.translateValues)(s.$parent)),f)for(var r in n)Object.prototype.hasOwnProperty.call(t,r)&&"translateValue"===r.substr(0,14)&&"translateValues"!==r&&(e[a(r.substr(14,1))+r.substr(15)]=n[r])}(s.interpolateParams,m,c);var C=!0;for(var I in m.$observe("translate",(function(e){void 0===e?S(""):""===e&&C||(v.translate=e,w()),C=!1})),m)m.hasOwnProperty(I)&&"translateAttr"===I.substr(0,13)&&I.length>13&&y(I);if(m.$observe("translateDefault",(function(e){s.defaultText=e,w()})),d&&m.$observe("translateSanitizeStrategy",(function(e){s.sanitizeStrategy=o(e)(s.$parent),w()})),l&&m.$observe("translateValues",(function(e){e&&s.$parent.$watch((function(){angular.extend(s.interpolateParams,o(e)(s.$parent))}))})),f){var b=function(e){m.$observe(e,(function(t){var n=a(e.substr(14,1))+e.substr(15);s.interpolateParams[n]=t}))};for(var T in m)Object.prototype.hasOwnProperty.call(m,T)&&"translateValue"===T.substr(0,14)&&"translateValues"!==T&&b(T)}var w=function(){for(var e in v)v.hasOwnProperty(e)&&void 0!==v[e]&&A(e,v[e],s,s.interpolateParams,s.defaultText,s.translateNamespace)},A=function(t,n,o,r,i,a){n?(a&&"."===n.charAt(0)&&(n=a+n),e(n,r,u,i,o.translateLanguage,o.sanitizeStrategy).then((function(e){E(e,o,!0,t)}),(function(e){E(e,o,!1,t)}))):E(n,o,!1,t)},E=function(t,o,r,i){if(r||void 0!==o.defaultText&&(t=o.defaultText),"translate"===i){(r||!r&&!e.isKeepContent()&&void 0===m.translateKeepContent)&&h.empty().append(o.preText+t+o.postText);var a=e.isPostCompilingEnabled(),s=void 0!==c.translateCompile,l=s&&"false"!==c.translateCompile;(a&&!s||l)&&n(h.contents())(o)}else{var u=m.$attr[i];"data-"===u.substr(0,5)&&(u=u.substr(5)),u=u.substr(15),h.attr(u,t)}};(l||f||m.translateDefault)&&s.$watch("interpolateParams",w,!0),s.$on("translateLanguageChanged",w);var _=r.$on("$translateChangeSuccess",w);h.text().length?m.translate?S(m.translate):S(""):m.translate&&S(m.translate),w(),s.$on("$destroy",_)}}}}function r(e,t){"use strict";return{restrict:"A",priority:e.directivePriority(),link:function(n,o,r){var a,s,c,l={},u=function(){angular.forEach(a,(function(t,i){t&&(l[i]=!0,n.translateNamespace&&"."===t.charAt(0)&&(t=n.translateNamespace+t),e(t,s,r.translateInterpolation,void 0,n.translateLanguage,c).then((function(e){o.attr(i,e)}),(function(e){o.attr(i,e)})))})),angular.forEach(l,(function(e,t){a[t]||(o.removeAttr(t),delete l[t])}))};i(n,r.translateAttr,(function(e){a=e}),u),i(n,r.translateValues,(function(e){s=e}),u),i(n,r.translateSanitizeStrategy,(function(e){c=e}),u),r.translateValues&&n.$watch(r.translateValues,u,!0),n.$on("translateLanguageChanged",u);var d=t.$on("$translateChangeSuccess",u);u(),n.$on("$destroy",d)}}}function i(e,t,n,o){"use strict";t&&("::"===t.substr(0,2)?t=t.substr(2):e.$watch(t,(function(e){n(e),o()}),!0),n(e.$eval(t)))}function a(e,t){"use strict";return{compile:function(n){var o=function(t){t.addClass(e.cloakClassName())},r=function(t){t.removeClass(e.cloakClassName())};return o(n),function(n,i,a){var s=r.bind(this,i),c=o.bind(this,i);a.translateCloak&&a.translateCloak.length?(a.$observe("translateCloak",(function(t){e(t).then(s,c)})),t.$on("$translateChangeSuccess",(function(){e(a.translateCloak).then(s,c)}))):e.onReady(s)}}}}function s(){"use strict";return{restrict:"A",scope:!0,compile:function(){return{pre:function(e,t,n){e.translateNamespace=function e(t){return t.translateNamespace?t.translateNamespace:t.$parent?e(t.$parent):void 0}(e),e.translateNamespace&&"."===n.translateNamespace.charAt(0)?e.translateNamespace+=n.translateNamespace:e.translateNamespace=n.translateNamespace}}}}}function c(){"use strict";return{restrict:"A",scope:!0,compile:function(){return function(e,t,n){n.$observe("translateLanguage",(function(t){e.translateLanguage=t})),e.$watch("translateLanguage",(function(){e.$broadcast("translateLanguageChanged")}))}}}}function l(e,t){"use strict";var n=function(n,o,r,i){if(!angular.isObject(o)){var a=this||{__SCOPE_IS_NOT_AVAILABLE:"More info at https://github.com/angular/angular.js/commit/8863b9d04c722b278fa93c5d66ad1e578ad6eb1f"};o=e(o)(a)}return t.instant(n,o,r,i)};return t.statefulFilter()&&(n.$stateful=!0),n}function u(e){"use strict";return e("translations")}return e.$inject=["$translate"],t.$inject=["$STORAGE_KEY","$windowProvider","$translateSanitizationProvider","pascalprechtTranslateOverrider"],n.$inject=["$interpolate","$translateSanitization"],o.$inject=["$translate","$interpolate","$compile","$parse","$rootScope"],r.$inject=["$translate","$rootScope"],a.$inject=["$translate","$rootScope"],l.$inject=["$parse","$translate"],u.$inject=["$cacheFactory"],angular.module("pascalprecht.translate",["ng"]).run(e),e.displayName="runTranslate",angular.module("pascalprecht.translate").provider("$translateSanitization",(function(){"use strict";var e,t,n,o=null,r=!1,i=!1;(n={sanitize:function(e,t){return"text"===t&&(e=s(e)),e},escape:function(e,t){return"text"===t&&(e=a(e)),e},sanitizeParameters:function(e,t){return"params"===t&&(e=l(e,s)),e},escapeParameters:function(e,t){return"params"===t&&(e=l(e,a)),e},sce:function(e,t,n){return"text"===t?e=c(e):"params"===t&&"filter"!==n&&(e=l(e,a)),e},sceParameters:function(e,t){return"params"===t&&(e=l(e,c)),e}}).escaped=n.escapeParameters,this.addStrategy=function(e,t){return n[e]=t,this},this.removeStrategy=function(e){return delete n[e],this},this.useStrategy=function(e){return r=!0,o=e,this},this.$get=["$injector","$log",function(a,s){var c={};return a.has("$sanitize")&&(e=a.get("$sanitize")),a.has("$sce")&&(t=a.get("$sce")),{useStrategy:function(e){return function(t){e.useStrategy(t)}}(this),sanitize:function(e,t,l,u){return o||r||i||(s.warn("pascalprecht.translate.$translateSanitization: No sanitization strategy has been configured. This can have serious security implications. See http://angular-translate.github.io/docs/#/guide/19_security for details."),i=!0),l||null===l||(l=o),l?(u||(u="service"),function(e,t,o,r){return angular.forEach(r,(function(r){if(angular.isFunction(r))e=r(e,t,o);else if(angular.isFunction(n[r]))e=n[r](e,t,o);else{if(!angular.isString(n[r]))throw new Error("pascalprecht.translate.$translateSanitization: Unknown sanitization strategy: '"+r+"'");if(!c[n[r]])try{c[n[r]]=a.get(n[r])}catch(e){throw c[n[r]]=function(){},new Error("pascalprecht.translate.$translateSanitization: Unknown sanitization strategy: '"+r+"'")}e=c[n[r]](e,t,o)}})),e}(e,t,u,angular.isArray(l)?l:[l])):e}}}];var a=function(e){var t=angular.element("<div></div>");return t.text(e),t.html()},s=function(t){if(!e)throw new Error("pascalprecht.translate.$translateSanitization: Error cannot find $sanitize service. Either include the ngSanitize module (https://docs.angularjs.org/api/ngSanitize) or use a sanitization strategy which does not depend on $sanitize, such as 'escape'.");return e(t)},c=function(e){if(!t)throw new Error("pascalprecht.translate.$translateSanitization: Error cannot find $sce service.");return t.trustAsHtml(e)},l=function(e,t,n){if(angular.isDate(e))return e;if(angular.isObject(e)){var o=angular.isArray(e)?[]:{};if(n){if(n.indexOf(e)>-1)throw new Error("pascalprecht.translate.$translateSanitization: Error cannot interpolate parameter due recursive object")}else n=[];return n.push(e),angular.forEach(e,(function(e,r){angular.isFunction(e)||(o[r]=l(e,t,n))})),n.splice(-1,1),o}return angular.isNumber(e)||!0===e||!1===e||angular.isUndefined(e)||null===e?e:t(e)}})),angular.module("pascalprecht.translate").constant("pascalprechtTranslateOverrider",{}).provider("$translate",t),t.displayName="displayName",angular.module("pascalprecht.translate").factory("$translateDefaultInterpolation",n),n.displayName="$translateDefaultInterpolation",angular.module("pascalprecht.translate").constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY"),angular.module("pascalprecht.translate").directive("translate",o),o.displayName="translateDirective",angular.module("pascalprecht.translate").directive("translateAttr",r),r.displayName="translateAttrDirective",angular.module("pascalprecht.translate").directive("translateCloak",a),a.displayName="translateCloakDirective",angular.module("pascalprecht.translate").directive("translateNamespace",s),s.displayName="translateNamespaceDirective",angular.module("pascalprecht.translate").directive("translateLanguage",c),c.displayName="translateLanguageDirective",angular.module("pascalprecht.translate").filter("translate",l),l.displayName="translateFilterFactory",angular.module("pascalprecht.translate").factory("$translationCache",u),u.displayName="$translationCache","pascalprecht.translate"}()}.apply(t,[]))||(e.exports=o)},function(e,t){function n(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,!n.initDone)return e.error("Janus: Library not initialized"),{};if(n.log("Janus: Library initialized: "+n.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,o=null,r={},i=null,a=null,s=0,c=e.server;n.isArray(c)?(n.log("Janus: Multiple servers provided ("+c.length+"), will use the first that works"),c=null,a=e.server,n.debug(a)):0===c.indexOf("ws")?(t=!0,n.log("Janus: Using WebSockets to contact Janus: "+c)):(t=!1,n.log("Janus: Using REST API to contact Janus: "+c));e.iceServers,e.iceTransportPolicy,e.bundlePolicy,e.ipv6;var l=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(l=!0===e.withCredentials);var u=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(u=e.max_poll_events),u<1&&(u=1);var d=null;void 0!==e.token&&null!==e.token&&(d=e.token);var f=null;void 0!==e.apisecret&&null!==e.apisecret&&(f=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var p=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(p=e.keepAlivePeriod),isNaN(p)&&(p=25e3);var g=6e4;void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var h=!1,m=null,v={},S=this,y=0,C={};function I(){if(null!=m)if(n.debug("Janus: Long poll..."),h){var t=c+"/"+m+"?rid="+(new Date).getTime();u&&(t=t+"&maxev="+u),d&&(t=t+"&token="+encodeURIComponent(d)),f&&(t=t+"&apisecret="+encodeURIComponent(f)),n.httpAPICall(t,{verb:"GET",withCredentials:l,success:b,timeout:g,error:function(t,o){if(n.error(t+":",o),++y>3)return h=!1,void e.error("Janus: Lost connection to the server (is it down?)");I()}})}else n.warn("Janus: Is the server down? (connected=false)")}function b(e,r){if(y=0,t||null==m||!0===r||I(),t||!n.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus)return n.debug("Janus: Got a webrtcup event on session "+m),n.debug("Janus: "+JSON.stringify(e)),(i=e.sender)?(s=v[i])?void s.webrtcState(!0):void n.debug("Janus: This handle is not attached to this session"):void n.warn("Janus: Missing sender...");if("hangup"===e.janus){if(n.debug("Janus: Got a hangup event on session "+m),n.debug("Janus: "+JSON.stringify(e)),!(i=e.sender))return void n.warn("Janus: Missing sender...");if(!(s=v[i]))return void n.debug("Janus: This handle is not attached to this session");s.webrtcState(!1,e.reason),s.hangup()}else if("detached"===e.janus){if(n.debug("Janus: Got a detached event on session "+m),n.debug("Janus: "+JSON.stringify(e)),!(i=e.sender))return void n.warn("Janus: Missing sender...");if(!(s=v[i]))return;s.detached=!0,s.ondetached(),s.detach()}else if("media"===e.janus){if(n.debug("Janus: Got a media event on session "+m),n.debug("Janus: "+JSON.stringify(e)),!(i=e.sender))return void n.warn("Janus: Missing sender...");if(!(s=v[i]))return void n.debug("Janus: This handle is not attached to this session");s.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(n.debug("Janus: Got a slowlink event on session "+m),n.debug("Janus: "+JSON.stringify(e)),!(i=e.sender))return void n.warn("Janus: Missing sender...");if(!(s=v[i]))return void n.debug("Janus: This handle is not attached to this session");s.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){if(n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug("Janus: "+JSON.stringify(e)),d=e.transaction)(f=C[d])&&f(e),delete C[d];return}if("event"===e.janus){var i;if(n.debug("Janus: Got a plugin event on session "+m),n.debug("Janus: "+JSON.stringify(e)),!(i=e.sender))return void n.warn("Janus: Missing sender...");var a=e.plugindata;if(!a)return void n.warn("Janus: Missing plugindata...");n.debug("Janus:  -- Event is coming from "+i+" ("+a.plugin+")");var s,c=a.data;if(n.debug("Janus: "+JSON.stringify(e)),!(s=v[i]))return void n.warn("Janus: This handle is not attached to this session");var l=e.jsep;l&&(n.debug("Janus: Handling SDP as well..."),n.debug("Janus: "+JSON.stringify(l)));var u=s.onmessage;u?(n.debug("Janus: Notifying application..."),u(c,l)):n.debug("Janus: No provided notification callback")}else{if("timeout"===e.janus)return n.error("Janus: Timeout on session "+m),n.debug("Janus: "+JSON.stringify(e)),void(t&&o.close(3504,"Gateway timeout"));n.warn("Janus: Unknown message/event  '"+e.janus+"' on session "+m),n.debug("Janus: "+JSON.stringify(e))}}}else{var d,f;n.debug("Janus: Got a success on session "+m),n.debug("Janus: "+JSON.stringify(e)),(d=e.transaction)&&((f=C[d])&&f(e),delete C[d])}else n.debug("Janus: Got an ack on session "+m),n.debug("Janus: "+JSON.stringify(e)),(d=e.transaction)&&((f=C[d])&&f(e),delete C[d]);else n.vdebug("Janus: Got a keepalive on session "+m);else for(var p=0;p<e.length;p++)b(e[p],!0)}function T(){if(c&&t&&h){i=setTimeout(T,p);var e={janus:"keepalive",session_id:m,transaction:n.randomString(12)};d&&(e.token=d),f&&(e.apisecret=f),o.send(JSON.stringify(e))}}function w(u){var g=n.randomString(12),v={janus:"create",transaction:g};if(u.reconnect&&(h=!1,v.janus="claim",v.session_id=m,o&&(o.onopen=null,o.onerror=null,o.onclose=null,i&&(clearTimeout(i),i=null))),d&&(v.token=d),f&&(v.apisecret=f),!c&&n.isArray(a)&&(0===(c=a[s]).indexOf("ws")?(t=!0,n.log("Janus: Server #"+(s+1)+": trying WebSockets to contact Janus ("+c+")")):(t=!1,n.log("Janus: Server #"+(s+1)+": trying REST API to contact Janus ("+c+")"))),t){let t=c;for(var y in n.serverName&&(t=c+"?serverName="+encodeURIComponent(n.serverName)),o=n.newWebSocket(t,"janus-protocol"),r={error:function(){if(n.error("Janus: Error connecting to the Janus WebSockets server... "+c),n.isArray(a)&&!u.reconnect)return++s===a.length?void u.error("Janus: Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout((function(){w(u)}),200));u.error("Janus: Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){C[g]=function(e){if(n.debug("Janus: "+JSON.stringify(e)),"success"!==e.janus)return n.error("Janus: Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);i=setTimeout(T,p),h=!0,m=e.session_id?e.session_id:e.data.id,u.reconnect?n.log("Janus: Claimed session: "+m):n.log("Janus: Created session: "+m),n.sessions[m]=S,u.success()},o.send(JSON.stringify(v))},message:function(e){b(JSON.parse(e.data))},close:function(){c&&h&&(h=!1,e.error("Janus: Lost connection to the server (is it down?)"))}})o.addEventListener(y,r[y])}else n.httpAPICall(c,{verb:"POST",withCredentials:l,body:v,success:function(e){if(n.debug("Janus: "+JSON.stringify(e)),"success"!==e.janus)return n.error("Janus: Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);h=!0,m=e.session_id?e.session_id:e.data.id,u.reconnect?n.log("Janus: Claimed session: "+m):n.log("Created session: "+m),n.sessions[m]=S,I(),u.success()},error:function(e,t){if(n.error("Janus: "+e+":",t),n.isArray(a)&&!u.reconnect)return++s===a.length?void u.error("Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout((function(){w(u)}),200));""===t?u.error(e+": Is the server down?"):u.error(e+": "+t)}})}function A(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop,!h)return n.warn("Janus: Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var i=v[e];if(!i||!i.webrtcStuff)return n.warn("Janus: Invalid handle"),void r.error("Invalid handle");var a=r.message,s=r.jsep,u=n.randomString(12),d={janus:"message",body:a,transaction:u};if(i.token&&(d.token=i.token),f&&(d.apisecret=f),s&&(d.jsep={type:s.type,sdp:s.sdp},s.e2ee&&(d.jsep.e2ee=!0)),n.debug("Janus: Sending message to plugin (handle="+e+"):"),n.debug("Janus: "+JSON.stringify(d)),t)return d.session_id=m,d.handle_id=e,C[u]=function(e){if(n.debug("Janus: Message sent!"),n.debug("Janus: "+JSON.stringify(e)),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Janus: Request succeeded, but missing plugindata..."),void r.success();n.log("Janus: Synchronous transaction successful ("+t.plugin+")");var o=t.data;return n.debug("Janus: "+JSON.stringify(o)),void r.success(o)}"ack"===e.janus?r.success():e.error?(n.error("Janus: Oooops: "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Janus: Unknown error"),r.error("Unknown error"))},void o.send(JSON.stringify(d));n.httpAPICall(c+"/"+m+"/"+e,{verb:"POST",withCredentials:l,body:d,success:function(e){if(n.debug("Janus: Message sent!"),n.debug("Janus: "+JSON.stringify(e)),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Janus: Request succeeded, but missing plugindata..."),void r.success();n.log("Janus: Synchronous transaction successful ("+t.plugin+")");var o=t.data;return n.debug(o),void r.success(o)}"ack"===e.janus?r.success():e.error?(n.error("Janus: Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Janus: Unknown error"),r.error("Unknown error"))},error:function(e,t){n.error("Janus: "+e+":",t),r.error(e+": "+t)}})}function E(e,r){if(h){var i=v[e];if(i&&i.webrtcStuff){var a={janus:"trickle",candidate:r,transaction:n.randomString(12)};if(i.token&&(a.token=i.token),f&&(a.apisecret=f),n.vdebug("Janus: Sending trickle candidate (handle="+e+"):"),n.vdebug("Janus: "+JSON.stringify(a)),t)return a.session_id=m,a.handle_id=e,void o.send(JSON.stringify(a));n.httpAPICall(c+"/"+m+"/"+e,{verb:"POST",withCredentials:l,body:a,success:function(e){n.vdebug("Janus: Candidate sent!"),n.vdebug("Janus: "+JSON.stringify(e)),"ack"===e.janus||n.error("Janus: Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){n.error("Janus: "+e+":",t)}})}else n.warn("Janus: Invalid handle")}else n.warn("Janus: Is the server down? (connected=false)")}function _(e,r){(r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop;var i=!0===r.noRequest;n.log("Janus: Destroying handle "+e+" (only-locally="+i+")"),R(e);var a=v[e];if(!a||a.detached)return delete v[e],void r.success();if(i)return delete v[e],void r.success();if(!h)return n.warn("Janus: Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var s={janus:"detach",transaction:n.randomString(12)};if(a.token&&(s.token=a.token),f&&(s.apisecret=f),t)return s.session_id=m,s.handle_id=e,o.send(JSON.stringify(s)),delete v[e],void r.success();n.httpAPICall(c+"/"+m+"/"+e,{verb:"POST",withCredentials:l,body:s,success:function(t){n.log("Janus: Destroyed handle:"),n.debug("Janus: "+JSON.stringify(t)),"success"!==t.janus&&n.error("Janus: Ooops: "+t.error.code+" "+t.error.reason),delete v[e],r.success()},error:function(t,o){n.error(t+":",o),delete v[e],r.success()}})}function R(e,r){n.log("Janus: Cleaning WebRTC stuff");var i=v[e];if(i){if(i.webrtcStuff&&!0===r){var a={janus:"hangup",transaction:n.randomString(12)};i.token&&(a.token=i.token),f&&(a.apisecret=f),n.debug("Janus: Sending hangup request (handle="+e+"):"),n.debug("Janus: "+JSON.stringify(a)),t?(a.session_id=m,a.handle_id=e,o.send(JSON.stringify(a))):n.httpAPICall(c+"/"+m+"/"+e,{verb:"POST",withCredentials:l,body:a})}i.oncleanup()}}w(e),this.getServer=function(){return c},this.isConnected=function(){return h},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.reconnect=!0,w(e)},this.getSessionId=function(){return m},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=!0===a.unload,u=!0;void 0!==a.notifyDestroyed&&null!==a.notifyDestroyed&&(u=!0===a.notifyDestroyed);var p=!0===a.cleanupHandles;if(n.log("Janus: Destroying session "+m+" (unload="+s+")"),!m)return n.warn("Janus: No session to destroy"),a.success(),void(u&&e.destroyed());if(p)for(var g in v)_(g,{noRequest:!0});if(!h)return n.warn("Janus: Is the server down? (connected=false)"),m=null,void a.success();var S={janus:"destroy",transaction:n.randomString(12)};d&&(S.token=d);f&&(S.apisecret=f);if(s)return t?(o.onclose=null,o.close(),o=null):navigator.sendBeacon(c+"/"+m,JSON.stringify(S)),n.log("Janus: Destroyed session:"),m=null,h=!1,a.success(),void(u&&e.destroyed());if(t){S.session_id=m;var y=function(){for(var e in r)o.removeEventListener(e,r[e]);o.removeEventListener("message",C),o.removeEventListener("error",I),i&&clearTimeout(i),o.close()},C=function(t){var n=JSON.parse(t.data);n.session_id==S.session_id&&n.transaction==S.transaction&&(y(),a.success(),u&&e.destroyed())},I=function(t){y(),a.error("Failed to destroy the server: Is the server down?"),u&&e.destroyed()};return o.addEventListener("message",C),o.addEventListener("error",I),void o.send(JSON.stringify(S))}n.httpAPICall(c+"/"+m,{verb:"POST",withCredentials:l,body:S,success:function(t){n.log("Janus: Destroyed session:"),n.debug("Janus: "+JSON.stringify(t)),m=null,h=!1,"success"!==t.janus&&n.error("Janus: Ooops: "+t.error.code+" "+t.error.reason),a.success(),u&&e.destroyed()},error:function(t,o){n.error("Janus:"+t+":",o),m=null,h=!1,a.success(),u&&e.destroyed()}})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.iceState="function"==typeof e.iceState?e.iceState:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!h)return n.warn("Janus: Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(!r)return n.error("Janus: Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,a=e.token?e.token:d,s=n.randomString(12),u={janus:"attach",plugin:r,opaque_id:i,transaction:s};a&&(u.token=a);f&&(u.apisecret=f);if(t)return C[s]=function(t){if(n.debug("Janus: "+JSON.stringify(t)),"success"!==t.janus)return n.error("Janus: Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var o=t.data.id;n.log("Janus: Created handle: "+o);var i={session:S,plugin:r,id:o,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return r},getVolume:function(){},getRemoteVolume:function(){},getLocalVolume:function(){},isAudioMuted:function(){},muteAudio:function(){},unmuteAudio:function(){},isVideoMuted:function(){},muteVideo:function(){},unmuteVideo:function(){},getBitrate:function(){},send:function(e){A(o,e)},data:function(e){},dtmf:function(e){},sendTrickleCandidate:function(e){E(o,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){},createAnswer:function(e){},handleRemoteJsep:function(e){},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){R(o,!0===e)},detach:function(e){_(o,e)}};v[o]=i,e.success(i)},u.session_id=m,void o.send(JSON.stringify(u));n.httpAPICall(c+"/"+m,{verb:"POST",withCredentials:l,body:u,success:function(t){if(n.debug("Janus: "+JSON.stringify(t)),"success"!==t.janus)return n.error("Janus: Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var o=t.data.id;n.log("Janus: Created handle: "+o);var i={session:S,plugin:r,id:o,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return o},getPlugin:function(){return r},getVolume:function(){},getRemoteVolume:function(){},getLocalVolume:function(){},isAudioMuted:function(){},muteAudio:function(){},unmuteAudio:function(){},isVideoMuted:function(){},muteVideo:function(){},unmuteVideo:function(){},getBitrate:function(){},send:function(e){A(o,e)},data:function(e){},dtmf:function(e){},sendTrickleCandidate:function(e){E(o,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){},createAnswer:function(e){},handleRemoteJsep:function(e){},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){R(o,!0===e)},detach:function(e){_(o,e)}};v[o]=i,e.success(i)},error:function(t,o){n.error("Janus: "+t+":",o),""===o?e.error(t+": Is the server down?"):e.error(t+": "+o)}})}(e)}}n.sessions={},n.appointmentId=null,n.authToken=null,n.logger=null,n.serverName=null,n.logHttpResponse=function(e,t,o){const r="Response Url: "+e.url,i="Response HTTP Status: "+e.status+" "+e.statusText,a="Response Type: "+e.type,s=Object.fromEntries(e.headers.entries());let c=["Janus: -- Got a response from Janus HTTP API:",r,i,a,"Response Headers: "+JSON.stringify(s)];if(t){const e="Response Body: "+t;c.push(e)}if(o){const e="Unable to print response body! Error: "+o;c.push(e)}let l=c.join("\n");e.ok?n.log(l):n.error(l)},n.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,o=e&&e.Promise||Promise,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return Array.isArray(e)},httpAPICall:function(e,r){var i={method:r.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===r.verb&&(i.headers["Content-Type"]="application/json"),void 0!==r.withCredentials&&(i.credentials=!0===r.withCredentials?"include":r.withCredentials?r.withCredentials:"omit"),r.body&&(i.body=JSON.stringify(r.body)),i.headers.appointment=n.appointmentId,i.headers.Auth=n.authToken;let a=new URL(e);a.searchParams.append("serverName",n.serverName);var s=t(a,i).catch((function(e){return n.error("Janus: Got an error from the fetch operation! There may be a network error or something that prevented the request from being completed. Error: "+e),o.reject({message:"Probably a network error, is the server down? error: "+JsonUtil().jsonStringify(e),error:e})}));if(r.timeout){var c=new o((function(e,t){var n=setTimeout((function(){return clearTimeout(n),t({message:"Janus: Request timed out. timeout: "+c,timeout:r.timeout})}),r.timeout)}));s=o.race([s,c])}return s.then((function(e){let t=e.clone();return t.text().then(e=>{n.logHttpResponse(t,e)}).catch(e=>{n.logHttpResponse(t,void 0,e)}),e.ok?typeof r.success==typeof n.noop?e.json().then((function(e){r.success(e)})).catch((function(t){let n=JsonUtil().jsonStringify(t),r=JsonUtil().jsonStringify(e);return o.reject({message:"Janus: Failed to parse response body. error: "+n+" response: "+r,error:t,response:e})})):void 0:(n.logHttpResponse(t),o.reject({message:"Janus: API call failed. response: "+JsonUtil().jsonStringify(e),response:e}))})).catch((function(e){n.error("Janus: Got an error from the fetch operation! Error: "+JSON.stringify(e)),typeof r.error==typeof n.noop&&r.error(e.message||"Janus: << internal error >>",e)})),s}}},n.noop=function(){},n.dataChanDefaultLabel="JanusDataChannel",n.endOfCandidates=null,n.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:n.noop,n.appointmentId=e.appointmentId,n.authToken=e.authToken,n.logger=e.logger,n.serverName=e.serverName,n.initDone)e.callback();else{n.trace=n.logger.trace,n.debug=n.logger.debug,n.vdebug=n.logger.debug,n.log=n.logger.info,n.warn=n.logger.warn,n.error=n.logger.error,n.log("Janus: Initializing library");var t=e.dependencies||n.useDefaultDependencies();n.isArray=t.isArray,n.httpAPICall=t.httpAPICall,n.newWebSocket=t.newWebSocket,n.initDone=!0,e.callback()}},n.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",o=0;o<e;o++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n},window.Janus=n},function(e,t){window.LogSeverity=function(){return{Critical:1,Error:2,Warn:3,Info:4,Debug:5,Trace:6}}},function(e,t){window.CallState=function(){return{CALLING:"CALLING",INCOMING:"INCOMING",CONNECTING:"CONNECTING",ANSWERED:"ANSWERED",CALLINPROGRESS:"CALLINPROGRESS",HANGUP:"HANGUP"}}},function(e,t){window.ParticipationType=function(){return{HOST:"HOST",PARTICIPANT:"PARTICIPANT"}}},function(e,t){
/*!
 * angular-translate - v2.5.0 - 2014-12-07
 * http://github.com/angular-translate/angular-translate
 * Copyright (c) 2014 ; Licensed MIT
 */
angular.module("pascalprecht.translate",["ng"]).run(["$translate",function(e){var t=e.storageKey(),n=e.storage(),o=function(){var o=e.preferredLanguage();angular.isString(o)?e.use(o):n.put(t,e.use())};n?n.get(t)?e.use(n.get(t)).catch(o):o():angular.isString(e.preferredLanguage())&&e.use(e.preferredLanguage())}]),angular.module("pascalprecht.translate").provider("$translate",["$STORAGE_KEY",function(e){var t,n,o,r,i,a,s,c,l,u,d,f,p,g,h,m={},v=[],S=e,y=[],C=!1,I="translate-cloak",b=!1,T=function(){var e,t,n=window.navigator,o=["language","browserLanguage","systemLanguage","userLanguage"];if(angular.isArray(n.languages))for(e=0;e<n.languages.length;e++)if((t=n.languages[e])&&t.length)return t;for(e=0;e<o.length;e++)if((t=n[o[e]])&&t.length)return t;return null};T.displayName="angular-translate/service: getFirstBrowserLanguage";var w=function(){return(T()||"").split("-").join("_")};w.displayName="angular-translate/service: getLocale";var A=function(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},E=function(){return this.replace(/^\s+|\s+$/g,"")},_=function(e){for(var t,o=[],r=angular.lowercase(e),i=0,a=v.length;i<a;i++)o.push(angular.lowercase(v[i]));if(A(o,r)>-1)return e;if(n)for(var s in n){var c=!1,l=Object.prototype.hasOwnProperty.call(n,s)&&angular.lowercase(s)===angular.lowercase(e);if("*"===s.slice(-1)&&(c=s.slice(0,-1)===e.slice(0,s.length-1)),(l||c)&&(t=n[s],A(o,angular.lowercase(t))>-1))return t}var u=e.split("_");return u.length>1&&A(o,angular.lowercase(u[0]))>-1?u[0]:e},R=function(e,t){if(!e&&!t)return m;if(e&&!t){if(angular.isString(e))return m[e]}else angular.isObject(m[e])||(m[e]={}),angular.extend(m[e],O(t));return this};this.translations=R,this.cloakClassName=function(e){return e?(I=e,this):I};var O=function(e,t,n,o){var r,i,a;for(r in t||(t=[]),n||(n={}),e)Object.prototype.hasOwnProperty.call(e,r)&&(a=e[r],angular.isObject(a)?O(a,t.concat(r),n,r):(i=t.length?t.join(".")+"."+r:r,t.length&&r===o&&(n[""+t.join(".")]="@:"+i),n[i]=a));return n};this.addInterpolation=function(e){return y.push(e),this},this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")},this.useInterpolation=function(e){return u=e,this},this.useSanitizeValueStrategy=function(e){return C=e,this},this.preferredLanguage=function(e){return P(e),this};var P=function(e){return e&&(t=e),t};this.translationNotFoundIndicator=function(e){return this.translationNotFoundIndicatorLeft(e),this.translationNotFoundIndicatorRight(e),this},this.translationNotFoundIndicatorLeft=function(e){return e?(p=e,this):p},this.translationNotFoundIndicatorRight=function(e){return e?(g=e,this):g},this.fallbackLanguage=function(e){return k(e),this};var k=function(e){return e?(angular.isString(e)?(r=!0,o=[e]):angular.isArray(e)&&(r=!1,o=e),angular.isString(t)&&A(o,t)<0&&o.push(t),this):r?o[0]:o};this.use=function(e){if(e){if(!m[e]&&!d)throw new Error("$translateProvider couldn't find translationTable for langKey: '"+e+"'");return i=e,this}return i};var L=function(e){if(!e)return c?c+S:S;S=e};this.storageKey=L,this.useUrlLoader=function(e,t){return this.useLoader("$translateUrlLoader",angular.extend({url:e},t))},this.useStaticFilesLoader=function(e){return this.useLoader("$translateStaticFilesLoader",e)},this.useLoader=function(e,t){return d=e,f=t||{},this},this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")},this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")},this.useStorage=function(e){return s=e,this},this.storagePrefix=function(e){return e?(c=e,this):e},this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")},this.useMissingTranslationHandler=function(e){return l=e,this},this.usePostCompiling=function(e){return b=!!e,this},this.determinePreferredLanguage=function(e){var n=e&&angular.isFunction(e)?e():w();return t=v.length?_(n):n,this},this.registerAvailableLanguageKeys=function(e,t){return e?(v=e,t&&(n=t),this):v},this.useLoaderCache=function(e){return!1===e?h=void 0:!0===e?h=!0:void 0===e?h="$translationCache":e&&(h=e),this},this.$get=["$log","$injector","$rootScope","$q",function(e,n,c,v){var T,w,U,N=n.get(u||"$translateDefaultInterpolation"),M=!1,$={},D={},B=function(e,n,r){if(angular.isArray(e)){return function(e){for(var t={},o=[],i=function(e){var o=v.defer(),i=function(n){t[e]=n,o.resolve([e,n])};return B(e,n,r).then(i,i),o.promise},a=0,s=e.length;a<s;a++)o.push(i(e[a]));return v.all(o).then((function(){return t}))}(e)}var a=v.defer();e&&(e=E.apply(e));var c=function(){var e=t?D[t]:D[i];if(w=0,s&&!e){var n=T.get(S);if(e=D[n],o&&o.length){var r=A(o,n);w=0===r?1:0,A(o,t)<0&&o.push(t)}}return e}();return c?c.then((function(){q(e,n,r).then(a.resolve,a.reject)}),a.reject):q(e,n,r).then(a.resolve,a.reject),a.promise},F=function(e){return p&&(e=[p,e].join(" ")),g&&(e=[e,g].join(" ")),e},j=function(e){i=e,c.$emit("$translateChangeSuccess",{language:e}),s&&T.put(B.storageKey(),i),N.setLocale(i),angular.forEach($,(function(e,t){$[t].setLocale(i)})),c.$emit("$translateChangeEnd",{language:e})},x=function(e){if(!e)throw"No language key specified for loading.";var t=v.defer();c.$emit("$translateLoadingStart",{language:e}),M=!0;var o=h;"string"==typeof o&&(o=n.get(o));var r=angular.extend({},f,{key:e,$http:angular.extend({},{cache:o},f.$http)});return n.get(d)(r).then((function(n){var o={};c.$emit("$translateLoadingSuccess",{language:e}),angular.isArray(n)?angular.forEach(n,(function(e){angular.extend(o,O(e))})):angular.extend(o,O(n)),M=!1,t.resolve({key:e,table:o}),c.$emit("$translateLoadingEnd",{language:e})}),(function(e){c.$emit("$translateLoadingError",{language:e}),t.reject(e),c.$emit("$translateLoadingEnd",{language:e})})),t.promise};if(s&&(!(T=n.get(s)).get||!T.put))throw new Error("Couldn't use storage '"+s+"', missing get() or put() method!");angular.isFunction(N.useSanitizeValueStrategy)&&N.useSanitizeValueStrategy(C),y.length&&angular.forEach(y,(function(e){var o=n.get(e);o.setLocale(t||i),angular.isFunction(o.useSanitizeValueStrategy)&&o.useSanitizeValueStrategy(C),$[o.getInterpolationIdentifier()]=o}));var V=function(e,t,n,o){var r=v.defer();return function(e){var t=v.defer();return Object.prototype.hasOwnProperty.call(m,e)?t.resolve(m[e]):D[e]?D[e].then((function(e){R(e.key,e.table),t.resolve(e.table)}),t.reject):t.reject(),t.promise}(e).then((function(a){Object.prototype.hasOwnProperty.call(a,t)?(o.setLocale(e),r.resolve(o.interpolate(a[t],n)),o.setLocale(i)):r.reject()}),r.reject),r.promise},J=function(e){if(l){var t=n.get(l)(e,i);return void 0!==t?t:e}return e},Q=function(e,t,n,r){var i=v.defer();if(e<o.length){var a=o[e];V(a,t,n,r).then(i.resolve,(function(){Q(e+1,t,n,r).then(i.resolve)}))}else i.resolve(J(t));return i.promise},H=function(e,t,n,r){var a;e<o.length&&((a=function(e,t,n,o){var r,a=m[e];return a&&Object.prototype.hasOwnProperty.call(a,t)&&(o.setLocale(e),r=o.interpolate(a[t],n),o.setLocale(i)),r}(o[e],t,n,r))||(a=H(e+1,t,n,r)));return a},q=function(e,t,n){var r=v.defer(),a=i?m[i]:m,s=n?$[n]:N;if(a&&Object.prototype.hasOwnProperty.call(a,e)){var c=a[e];"@:"===c.substr(0,2)?B(c.substr(2),t,n).then(r.resolve,r.reject):r.resolve(s.interpolate(c,t))}else{var u;l&&!M&&(u=J(e)),i&&o&&o.length?function(e,t,n){return Q(U>0?U:w,e,t,n)}(e,t,s).then((function(e){r.resolve(e)}),(function(e){r.reject(F(e))})):l&&!M&&u?r.resolve(u):r.reject(F(e))}return r.promise},X=function(e,t,n){var r,a=i?m[i]:m,s=n?$[n]:N;if(a&&Object.prototype.hasOwnProperty.call(a,e)){var c=a[e];r="@:"===c.substr(0,2)?X(c.substr(2),t,n):s.interpolate(c,t)}else{var u;l&&!M&&(u=J(e)),i&&o&&o.length?(w=0,r=function(e,t,n){return H(U>0?U:w,e,t,n)}(e,t,s)):r=l&&!M&&u?u:F(e)}return r};if(B.preferredLanguage=function(e){return e&&P(e),t},B.cloakClassName=function(){return I},B.fallbackLanguage=function(e){if(null!=e){if(k(e),d&&o&&o.length)for(var t=0,n=o.length;t<n;t++)D[o[t]]||(D[o[t]]=x(o[t]));B.use(B.use())}return r?o[0]:o},B.useFallbackLanguage=function(e){if(null!=e)if(e){var t=A(o,e);t>-1&&(U=t)}else U=0},B.proposedLanguage=function(){return a},B.storage=function(){return T},B.use=function(e){if(!e)return i;var t=v.defer();c.$emit("$translateChangeStart",{language:e});var n=_(e);return n&&(e=n),m[e]||!d||D[e]?(t.resolve(e),j(e)):(a=e,D[e]=x(e).then((function(n){return R(n.key,n.table),t.resolve(n.key),j(n.key),a===e&&(a=void 0),n}),(function(e){a===e&&(a=void 0),c.$emit("$translateChangeError",{language:e}),t.reject(e),c.$emit("$translateChangeEnd",{language:e})}))),t.promise},B.storageKey=function(){return L()},B.isPostCompilingEnabled=function(){return b},B.refresh=function(e){if(!d)throw new Error("Couldn't refresh translation table, no loader registered!");var t=v.defer();function n(){t.resolve(),c.$emit("$translateRefreshEnd",{language:e})}function r(){t.reject(),c.$emit("$translateRefreshEnd",{language:e})}if(c.$emit("$translateRefreshStart",{language:e}),e)m[e]?x(e).then((function(t){R(t.key,t.table),e===i&&j(i),n()}),r):r();else{var a=[],s={};if(o&&o.length)for(var l=0,u=o.length;l<u;l++)a.push(x(o[l])),s[o[l]]=!0;i&&!s[i]&&a.push(x(i)),v.all(a).then((function(e){angular.forEach(e,(function(e){m[e.key]&&delete m[e.key],R(e.key,e.table)})),i&&j(i),n()}))}return t.promise},B.instant=function(e,n,r){if(null===e||angular.isUndefined(e))return e;if(angular.isArray(e)){for(var a={},s=0,c=e.length;s<c;s++)a[e[s]]=B.instant(e[s],n,r);return a}if(angular.isString(e)&&e.length<1)return e;e&&(e=E.apply(e));var u,d=[];t&&d.push(t),i&&d.push(i),o&&o.length&&(d=d.concat(o));for(var f=0,p=d.length;f<p;f++){var g=d[f];if(m[g]&&void 0!==m[g][e]&&(u=X(e,n,r)),void 0!==u)break}return u||""===u||(u=N.interpolate(e,n),l&&!M&&(u=J(e))),u},B.versionInfo=function(){return"2.5.0"},B.loaderCache=function(){return h},d&&(angular.equals(m,{})&&B.use(B.use()),o&&o.length))for(var G=function(e){return R(e.key,e.table),c.$emit("$translateChangeEnd",{language:e.key}),e},W=0,Y=o.length;W<Y;W++)D[o[W]]=x(o[W]).then(G);return B}]}]),angular.module("pascalprecht.translate").factory("$translateDefaultInterpolation",["$interpolate",function(e){var t={},n=null,o={escaped:function(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=angular.element("<div></div>").text(e[n]).html());return t}};return t.setLocale=function(e){e},t.getInterpolationIdentifier=function(){return"default"},t.useSanitizeValueStrategy=function(e){return n=e,this},t.interpolate=function(t,r){var i;return n&&(i=r,r=angular.isFunction(o[n])?o[n](i):i),e(t)(r||{})},t}]),angular.module("pascalprecht.translate").constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY"),angular.module("pascalprecht.translate").directive("translate",["$translate","$q","$interpolate","$compile","$parse","$rootScope",function(e,t,n,o,r,i){return{restrict:"AE",scope:!0,compile:function(t,a){var s=a.translateValues?a.translateValues:void 0,c=a.translateInterpolation?a.translateInterpolation:void 0,l=t[0].outerHTML.match(/translate-value-+/i),u="^(.*)("+n.startSymbol()+".*"+n.endSymbol()+")(.*)";return function(t,d,f){t.interpolateParams={},t.preText="",t.postText="";var p={},g=function(e){if(angular.equals(e,"")||!angular.isDefined(e)){var o=d.text().match(u);angular.isArray(o)?(t.preText=o[1],t.postText=o[3],p.translate=n(o[2])(t.$parent)):p.translate=d.text().replace(/^\s+|\s+$/g,"")}else p.translate=e;y()},h=function(e){f.$observe(e,(function(t){p[e]=t,y()}))};for(var m in f.$observe("translate",(function(e){g(e)})),f)f.hasOwnProperty(m)&&"translateAttr"===m.substr(0,13)&&h(m);if(f.$observe("translateDefault",(function(e){t.defaultText=e})),s&&f.$observe("translateValues",(function(e){e&&t.$parent.$watch((function(){angular.extend(t.interpolateParams,r(e)(t.$parent))}))})),l){var v=function(e){f.$observe(e,(function(n){var o=angular.lowercase(e.substr(14,1))+e.substr(15);t.interpolateParams[o]=n}))};for(var S in f)Object.prototype.hasOwnProperty.call(f,S)&&"translateValue"===S.substr(0,14)&&"translateValues"!==S&&v(S)}var y=function(){for(var e in p)p.hasOwnProperty(e)&&p[e]&&C(e,p[e],t,t.interpolateParams)},C=function(t,n,o,r){e(n,r,c).then((function(e){I(e,o,!0,t)}),(function(e){I(e,o,!1,t)}))},I=function(t,n,r,i){if("translate"===i){r||void 0===n.defaultText||(t=n.defaultText),d.html(n.preText+t+n.postText);var s=e.isPostCompilingEnabled(),c=void 0!==a.translateCompile,l=c&&"false"!==a.translateCompile;(s&&!c||l)&&o(d.contents())(n)}else{r||void 0===n.defaultText||(t=n.defaultText);var u=f.$attr[i].substr(15);d.attr(u,t)}};t.$watch("interpolateParams",y,!0);var b=i.$on("$translateChangeSuccess",y);d.text().length&&g(""),y(),t.$on("$destroy",b)}}}}]),angular.module("pascalprecht.translate").directive("translateCloak",["$rootScope","$translate",function(e,t){return{compile:function(n){var o=function(){n.addClass(t.cloakClassName())},r=function(){n.removeClass(t.cloakClassName())},i=e.$on("$translateChangeEnd",(function(){r(),i(),i=null}));return o(),function(e,n,i){i.translateCloak&&i.translateCloak.length&&i.$observe("translateCloak",(function(e){t(e).then(r,o)}))}}}}]),angular.module("pascalprecht.translate").filter("translate",["$parse","$translate",function(e,t){var n=function(n,o,r){return angular.isObject(o)||(o=e(o)(this)),t.instant(n,o,r)};return n.$stateful=!0,n}])},function(e,t,n){var o;
/*!
 * angular-translate - v2.15.2 - 2017-06-22
 * 
 * Copyright (c) 2017 The angular-translate team, Pascal Precht; Licensed MIT
 */void 0===(o=function(){return function(){function e(e,t){"use strict";return function(n){if(!n||!(angular.isArray(n.files)||angular.isString(n.prefix)&&angular.isString(n.suffix)))throw new Error("Couldn't load static files, no files and prefix or suffix specified!");n.files||(n.files=[{prefix:n.prefix,suffix:n.suffix}]);for(var o=[],r=n.files.length,i=0;i<r;i++)o.push(function(o){if(!o||!angular.isString(o.prefix)||!angular.isString(o.suffix))throw new Error("Couldn't load static file, no prefix or suffix specified!");var r=[o.prefix,n.key,o.suffix].join("");return angular.isObject(n.fileMap)&&n.fileMap[r]&&(r=n.fileMap[r]),t(angular.extend({url:r,method:"GET"},n.$http)).then((function(e){return e.data}),(function(){return e.reject(n.key)}))}({prefix:n.files[i].prefix,key:n.key,suffix:n.files[i].suffix}));return e.all(o).then((function(e){for(var t=e.length,n={},o=0;o<t;o++)for(var r in e[o])n[r]=e[o][r];return n}))}}return e.$inject=["$q","$http"],angular.module("pascalprecht.translate").factory("$translateStaticFilesLoader",e),e.displayName="$translateStaticFilesLoader","pascalprecht.translate"}()}.apply(t,[]))||(e.exports=o)},function(e,t,n){"use strict";window.JsonUtil=function(){return{jsonStringify:function(e){let t={};t=e instanceof Error?{name:e.name,message:e.message,stack:e.stack,code:e.code}:e instanceof Response?{ok:e.ok,redirected:e.redirected,status:e.status,statusText:e.statusText,type:e.type,url:e.url}:e;return JSON.stringify(t)}}}},function(e,t,n){(function(){var e,n,o,r,i={}.hasOwnProperty,a=[].slice;e={LF:"\n",NULL:"\0"},o=function(){var t;function n(e,t,n){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:""}return n.prototype.toString=function(){var t,o,r,a,s;for(o in t=[this.command],(r=!1===this.headers["content-length"])&&delete this.headers["content-length"],s=this.headers)i.call(s,o)&&(a=s[o],t.push(o+":"+a));return this.body&&!r&&t.push("content-length:"+n.sizeOfUTF8(this.body)),t.push(e.LF+this.body),t.join(e.LF)},n.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},t=function(t){var o,r,i,a,s,c,l,u,d,f,p,g,h,m,v,S,y;for(a=t.search(RegExp(""+e.LF+e.LF)),i=(s=t.substring(0,a).split(e.LF)).shift(),c={},g=function(e){return e.replace(/^\s+|\s+$/g,"")},h=0,v=(S=s.reverse()).length;h<v;h++)u=(f=S[h]).indexOf(":"),c[g(f.substring(0,u))]=g(f.substring(u+1));if(o="",p=a+2,c["content-length"])d=parseInt(c["content-length"]),o=(""+t).substring(p,p+d);else for(r=null,l=m=p,y=t.length;(p<=y?m<y:m>y)&&(r=t.charAt(l))!==e.NULL;l=p<=y?++m:--m)o+=r;return new n(i,c,o)},n.unmarshall=function(n){var o;return function(){var r,i,a,s;for(s=[],r=0,i=(a=n.split(RegExp(""+e.NULL+e.LF+"*"))).length;r<i;r++)(null!=(o=a[r])?o.length:void 0)>0&&s.push(t(o));return s}()},n.marshall=function(t,o,r){return new n(t,o,r).toString()+e.NULL},n}(),n=function(){var t;function n(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return n.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},t=function(){return Date.now?Date.now():(new Date).valueOf},n.prototype._transmit=function(e,t,n){var r;for(r=o.marshall(e,t,n),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},n.prototype._setupHeartbeat=function(n){var o,i,a,s,c,l;if((c=n.version)===r.VERSIONS.V1_1||c===r.VERSIONS.V1_2)return i=(l=function(){var e,t,o,r;for(r=[],e=0,t=(o=n["heart-beat"].split(",")).length;e<t;e++)s=o[e],r.push(parseInt(s));return r}())[0],o=l[1],0!==this.heartbeat.outgoing&&0!==o&&(a=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+a+"ms"),this.pinger=r.setInterval(a,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==i?(a=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+a+"ms"),this.ponger=r.setInterval(a,function(e){return function(){var n;if((n=t()-e.serverActivity)>2*a)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+n+"ms"),e.ws.close()}}(this))):void 0},n.prototype._parseConnect=function(){var e,t,n,o;switch(o={},(e=1<=arguments.length?a.call(arguments,0):[]).length){case 2:o=e[0],t=e[1];break;case 3:e[1]instanceof Function?(o=e[0],t=e[1],n=e[2]):(o.login=e[0],o.passcode=e[1],t=e[2]);break;case 4:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3];break;default:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3],o.host=e[4]}return[o,t,n]},n.prototype.connect=function(){var n,i,s,c;return n=1<=arguments.length?a.call(arguments,0):[],c=this._parseConnect.apply(this,n),s=c[0],this.connectCallback=c[1],i=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(n){return function(r){var a,s,c,l,u,d,f,p,g,h,m,v;if(l="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(a=new Uint8Array(r.data),"function"==typeof n.debug&&n.debug("--- got data length: "+a.length),function(){var e,t,n;for(n=[],e=0,t=a.length;e<t;e++)s=a[e],n.push(String.fromCharCode(s));return n}().join("")):r.data,n.serverActivity=t(),l!==e.LF){for("function"==typeof n.debug&&n.debug("<<< "+l),v=[],g=0,h=(m=o.unmarshall(l)).length;g<h;g++)switch((u=m[g]).command){case"CONNECTED":"function"==typeof n.debug&&n.debug("connected to server "+u.headers.server),n.connected=!0,n._setupHeartbeat(u.headers),v.push("function"==typeof n.connectCallback?n.connectCallback(u):void 0);break;case"MESSAGE":p=u.headers.subscription,(f=n.subscriptions[p]||n.onreceive)?(c=n,d=u.headers["message-id"],u.ack=function(e){return null==e&&(e={}),c.ack(d,p,e)},u.nack=function(e){return null==e&&(e={}),c.nack(d,p,e)},v.push(f(u))):v.push("function"==typeof n.debug?n.debug("Unhandled received MESSAGE: "+u):void 0);break;case"RECEIPT":v.push("function"==typeof n.onreceipt?n.onreceipt(u):void 0);break;case"ERROR":v.push("function"==typeof i?i(u):void 0);break;default:v.push("function"==typeof n.debug?n.debug("Unhandled frame: "+u):void 0)}return v}"function"==typeof n.debug&&n.debug("<<< PONG")}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof i?i(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),s["accept-version"]=r.VERSIONS.supportedVersions(),s["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",s)}}(this)},n.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},n.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger)return r.clearInterval(this.ponger)},n.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},n.prototype.subscribe=function(e,t,n){var o;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),o=this,{id:n.id,unsubscribe:function(){return o.unsubscribe(n.id)}}},n.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},n.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},n.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},n.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},n.prototype.ack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},n.prototype.nack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},n}(),r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var o;return null==t&&(t=["v10.stomp","v11.stomp"]),o=new(r.WebSocketClass||WebSocket)(e,t),new n(o)},over:function(e){return new n(e)},Frame:o},null!==t&&(t.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(e,t){return window.setInterval(t,e)},r.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=r):t||(self.Stomp=r)}).call(this)},function(e,t,n){"use strict";function o(e){let t=e.VIDEO_CALL;return{store:function(n){try{cordova.plugins.phonertc.storeToken(n)}catch(e){console.error("Error when storing token via phonertc: ",e)}return t===e.C2C_AGENT?localStorage.setItem("c2c_auth_token",n):localStorage.setItem("user_token",n)},retrieve:function(){return t===e.C2C_AGENT?localStorage.getItem("c2c_auth_token"):localStorage.getItem("user_token")},clear:function(){try{cordova.plugins.phonertc.clearToken()}catch(e){console.error("Error when clearing token via phonertc: "+e)}return t===e.C2C_AGENT?localStorage.removeItem("c2c_auth_token"):localStorage.removeItem("user_token")},setUseModule:function(e){t=e}}}o.$inject=["UsageModule"],e.exports=o},function(e,t){e.exports=function(){return{DEVICE_READY:"deviceready",RESUME:"resume",PAUSE:"pause"}}},function(e,t){e.exports=function(){return{VIDEO_CALL:"VIDEO_CALL",C2C_AGENT:"C2C_AGENT",C2C_CLIENT:"C2C_CLIENT"}}},function(e,t,n){"use strict";e.exports=function(){return{store:function(e,t){return localStorage.setItem(e,t)},retrieve:function(e){return localStorage.getItem(e)},remove:function(e){return localStorage.removeItem(e)},getAndRemove:function(e){var t=localStorage.getItem(e);return localStorage.removeItem(e),t}}}},function(e,t,n){"use strict";e.exports=function(){var e={};return{setUser:function(t){e.user=t},getUser:function(){return e.user},setSignalServerUrl:function(t){e.signalServerUrl=t},getSignalServerUrl:function(){return e.signalServerUrl},setIsNotificationBased:function(t){e.isNotificationBased=t},getIsNotificationBased:function(){return e.isNotificationBased},setAppStatus:function(t){e.appStatus=t},getAppStatus:function(){return e.appStatus}}}},function(e,t,n){"use strict";function o(e,t,n){return{request:function(e){var t=n.retrieve();return t&&(e.headers.Auth="Bearer "+t),e},response:function(e){return e&&e.headers&&e.headers("Auth")&&n.store(e.headers("Auth")),e},responseError:function(t){return 401!==t.status&&403!==t.status||console.log(t.status),e.reject(t)}}}o.$inject=["$q","$injector","TokenStorage"],e.exports=o},function(e,t,n){"use strict";e.exports=function(){return{setPath:function(e){try{cordova.plugins.phonertc.setServicePath(e)}catch(e){console.error("Error while setting path via phonertc: ",e)}localStorage.setItem("mobileServiceEndpoint",e)},getPath:function(){return localStorage.getItem("mobileServiceEndpoint")}}}},function(e,t){function n(e,t,n,o){this.searchAppointment=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/appointmentService/searchAppointment",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.createAppointmentWithClaimId=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/appointmentService/createAppointmentWithClaimId",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getAppointmentById=function(n){var r=o.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/appointmentService/"+n}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.createAppointment=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/appointmentService/createAppointment",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.createCustomerAppointment=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/customerAppointmentService",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.updateAppointment=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/appointmentService/updateAppointment",data:n}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","TokenStorage","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.createAppointmentDeviceInfo=function(r){var i=n.getPath(),a=o(r),s=e.defer();return t({method:"post",url:i+"/rest/api/appointmentDeviceInfoService",data:a,headers:{"Content-Type":"application/json"}}).then((function(e){s.resolve(e)}),(function(e){s.reject(e)})),s.promise};let o=function(e){var t={};return t.appointmentId=e,t.deviceInfo={},t.deviceInfo.model=device.model,t.deviceInfo.manufacturer=device.manufacturer,t.deviceInfo.platform=device.platform,t.deviceInfo.serial=device.serial,t.deviceInfo.uuid=device.uuid,t.deviceInfo.deviceVersion=device.version,t}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n,o){this.getBinaryListByAppointmentIdAndBinaryType=function(o,r){var i=n.getPath(),a=e.defer();return t({method:"post",data:{appointmentId:o,binaryType:r},url:i+"/rest/api/fileService/getBinaryListByAppointmentIdAndBinaryType"}).then((function(e){a.resolve(e)}),(function(e){a.reject(e)})),a.promise},this.getUniqueIndexForBinaryRecord=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/fileService/getUniqueIndexForBinaryRecord",data:o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getBinaryById=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/fileService/getBinaryById/"+o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getBinaryByIdWithoutDownload=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/fileService/withoutDownload/"+o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise};var r=function(){var o=n.getPath(),r=e.defer();return t({method:"GET",url:o+"/rest/api/fileService/chunkSize",headers:{HideLoadingBar:!0}}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise};this.getChunkSize=function(){return new Promise(e=>{r().then(t=>{e(t.data)})})},this.createChunkedAppointmentBinaryFile=function(e,t,o,a){return new Promise(s=>{r().then(r=>{let c=Math.ceil(o.fileSize/r.data);var l=n.getPath()+"/rest/api/fileService/createChunkedAppointmentBinaryFile/"+e+"/"+t;const u=new Array(c).fill().map((e,t)=>t).reverse();var d=Math.random().toString(36).substr(2,9);i(d,l,u,o,a,r.data).then(e=>{s(e)}).catch((function(e){console.log(e)}))})})};var i=function(e,t,n,r,a,s,c){return new Promise((l,u)=>{if(!n.length)return console.log("All parts uploaded"),void l(c);const d=n.pop(),f=d*s,p=r.slice(f,f+s);(function(e,t,n,r,i,a,s){return new Promise((c,l)=>{const u=new XMLHttpRequest;u.open("PUT",n);u.setRequestHeader("Content-Type",a.type),u.setRequestHeader("Authorization","Bearer "+o.retrieve()),u.setRequestHeader("X-Chunk-Id",i),u.setRequestHeader("X-Chunk-Size",s),u.setRequestHeader("X-Real-Time",a.realTime),u.setRequestHeader("X-Remaining-Chunk-Count",e),u.setRequestHeader("X-Content-Id",t),u.setRequestHeader("X-Content-Length",a.fileSize),u.setRequestHeader("X-Content-Name",a.name),function(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=e=>{var n=o.result.indexOf(","),r=o.result.substr(n+1);t(r)},o.readAsDataURL(e),o.onerror=e=>n(e)})}(r).then(e=>{u.send(e)}),u.onreadystatechange=()=>{4===u.readyState&&200===u.status&&(u.response?c({chunkId:i,appointmentBinary:JSON.parse(u.response)}):c({chunkId:i}))},u.onerror=l})})(n.length,e,t,p,d,r,s).then(o=>{a&&a(o.chunkId+1),l(i(e,t,n,r,a,s,o.appointmentBinary))}).catch(()=>{n.push(d)})})};this.downloadFile=function(e,t,r,i,a,s){var c=n.getPath()+("/rest/api/storageService/"+e+"/"+o.retrieve()),l=new XMLHttpRequest;l.onerror=i,l.addEventListener("progress",a),l.onloadstart=r,l.open("GET",c,!0),l.responseType="blob",l.onloadend=function(n){if(200==this.status){var o=this.response;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,(function(n){console.log("file system open: "+n.name),n.root.getFile(t,{create:!0,exclusive:!1},(function(t){s(t,o,e)}))}))}},l.send()}}n.$inject=["$q","$http","ServicePath","TokenStorage"],e.exports=n},function(e,t){function n(e,t,n,o,r){this.currentUser=null,this.getIPAddress=function(){var n=e.defer();return t({method:"get",url:"https://cors-anywhere.herokuapp.com/https://api.ipify.org/"}).then((function(e){n.resolve(e)}),(function(e){n.reject(e)})),n.promise},this.updateUserDeviceInfo=function(n){var o=r.getPath(),i=e.defer();return t({method:"post",url:o+"/rest/api/userService/updateUserDeviceInfo",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.sendNotification=function(n){var o=r.getPath(),i=e.defer();return t({method:"post",url:o+"/rest/api/userService/sendNotification",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getUserInfo=function(n){var o=r.getPath(),i=e.defer();return t({method:"get",url:o+"/rest/api/userService/"+n}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.searchUserList=function(n){var o=r.getPath(),i=e.defer();return t({method:"post",url:o+"/rest/api/userService/searchUserList",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getUsersAppointments=function(){var n=r.getPath(),o=e.defer();return t({method:"get",url:n+"/rest/api/userService/appointments"}).then((function(e){o.resolve(e)}),(function(e){o.reject(e)})),o.promise},this.getHandlersAppointments=function(n){var o=r.getPath(),i=e.defer();return t({method:"get",url:o+"/rest/api/userService/"+n+"/appointments"}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.fetchCurrentUser=async function(e){if(!e&&!(e=o.retrieve()))return console.debug("Not fetching current user, since there is no token"),void this.clearCurrentUser();try{let t=await n.getDataFromJwtToken(e);if(200===t.status&&t.data){let e=t.data;this.setCurrentUser(e)}}catch(e){console.error("Failed to fetch token data from server: "+JSON.stringify(e)),this.clearCurrentUser()}},this.setCurrentUser=function(e){e?(this.currentUser={},Object.assign(this.currentUser,e),delete this.currentUser.token):this.clearCurrentUser()},this.clearCurrentUser=function(){this.currentUser=null},this.getCurrentUser=function(){return this.currentUser},this.changePassword=function(e,n,o){var i=r.getPath();return t({method:"post",url:i+"/rest/api/userService/changePassword",data:{userInfo:{id:e},password:n,confirmPassword:o}})}}n.$inject=["$q","$http","TokenService","TokenStorage","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.createConfiguration=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/companyConfigurationService",data:o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getConfigurationsByCompanyId=function(o){var r=n.getPath(),i=e.defer();return t({method:"GET",url:r+"/rest/api/companyConfigurationService/all/"+o,headers:{"Content-Type":"application/json",HideLoadingBar:!0}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getPublicConfigurations=function(){var o=n.getPath(),r=e.defer();return t({method:"GET",url:o+"/rest/api/companyConfigurationService/public",headers:{"Content-Type":"application/json",HideLoadingBar:!0}}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise},this.updateConfiguration=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/companyConfigurationService/updateConfiguration",data:o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.bulkUpdateConfiguration=function(o,r){var i=n.getPath(),a=e.defer();return t({method:"POST",url:i+"/rest/api/companyConfigurationService/bulkUpdate/"+r,data:o,headers:{"Content-Type":"application/json"}}).then((function(e){a.resolve(e)}),(function(e){a.reject(e)})),a.promise},this.removeConfiguration=function(o){var r=n.getPath(),i=e.defer();return t({method:"DELETE",url:r+"/rest/api/companyConfigurationService/configuration"}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getConfigurationsByTypeAndCompanyId=function(o,r){var i=n.getPath(),a={configuration:{type:o},companyId:r},s=e.defer();return t({method:"POST",url:i+"/rest/api/companyConfigurationService/getConfigurationsByTypeAndCompanyId",data:a,headers:{"Content-Type":"application/json",HideLoadingBar:!0}}).then((function(e){s.resolve(e)}),(function(e){s.reject(e)})),s.promise},this.getConfigurationByTypeKeyAndCompanyId=function(o,r,i){var a=n.getPath(),s={configuration:{type:o,key:r},companyId:i},c=e.defer();return t({method:"post",url:a+"/rest/api/companyConfigurationService/getConfigurationByKeyAndCompanyId",data:s,headers:{"Content-Type":"application/json"}}).then((function(e){c.resolve(e)}),(function(e){c.reject(e)})),c.promise},this.filterCompanyConfigurationsBySelectedKeys=function(e,t){let n=new Map;return Object.keys(t).forEach((function(o){let r=new Map;for(let n=0;n<e.length;n++){if(e[n].configuration.type==o){let i=t[o];for(let t=0;t<i.length;t++){let o=e[n].configuration.key;if(i[t]==o){let t=e[n].value;r.set(o,t);break}}}}n.set(o,r)})),n},this.isUseJanusProxy=function(e){let t=!1;for(let n=0;n<e.length;n++){"JANUS"==e[n].configuration.type&&"USE_JANUS_PROXY"==e[n].configuration.key&&(t="T"==e[n].configuration.value)}return t}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n,o,r,i,a,s,c,l,u,d,f,p,g,h){var m=null;this.contacts={},this.duplicateMessages={},this.callInProgress=!1,this.hideFromContactList=[],this.endCallInitiatior=!1,this.onlineUsers=[],this.currentUser={},this.companyId=null,this.incomingCall=!1,this.caller={},this.publisherSession=null,this.publishingInProgress=!1,this.callConfigurations={},this.isAnswerReceivedTimers={};let v=ParticipationType();this.callEventId=null,this.calleeUsers={},this.occupied=!1,this.updateVideoPosition=function(){t.$broadcast("updateVideoPosition")};var S=this;function y(e){return S.publishingInProgress=!0,c.info("publish call"),new Promise((n,o)=>{let r={};function s(e,t,n){let o=b(e.socket);o?(c.info("isCallEventActive userInfo",e.socket),S.callEventId?S.getCallEventById(S.callEventId).then((function(r){r?(c.info("isCallEventActive callEvent signalService.callEventId",S.callEventId),e.callEventId&&0!=e.callEventId?S.getCallEventById(e.callEventId).then((function(r){r?(c.info("isCallEventActive callEvent display.callEventId",e.callEventId),t(o)):(c.warn("isCallEventActive callEvent display.callEventId error",e.callEventId),n(o))})):t(o)):n(o)})).catch((function(){n(o)})):e.callEventId&&0!=e.callEventId?S.getCallEventById(e.callEventId).then((function(r){r?(c.info("isCallEventActive callEvent display.callEventId",e.callEventId),t(o)):(c.warn("isCallEventActive callEvent display.callEventId error",e.callEventId),n(o))})).catch((function(){n(o)})):(c.warn("isCallEventActive callEvent is null"),n(o))):(c.warn("isCallEventActive userInfo error socket",e.socket),n(o))}function l(){Object.keys(S.contacts).length>0?Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()})):S.publisherSession&&S.publisherSession.close(),a.destroySession()}r.onSessionDisconnect=function(e,t,n){c.info("onSessionDisconnect session type: "+t.config.ptype+" socket: "+e.socket+" pluginHandleId: "+n),"publisher"===t.config.ptype?(S.publisherSession=null,S.removePublisherSessionByUUID(S.currentUser.uuid),T()):"subscriber"===t.config.ptype&&setTimeout((function(){S.contacts[e.socket]&&(S.duplicateMessages={},S.contacts[e.socket].onSessionLeftCall(),delete S.contacts[e.socket]),delete S.calleeUsers[e.socket],S.removeSubscriberSessionByPluginHandleId(n),0===Object.keys(S.contacts).length&&(c.info("onSessionDisconnect leaveVideoRoom",e.socket),S.getCallEventsByUUID(S.currentUser).then((function(e){0!=e.length&&0!=Object.keys(S.calleeUsers).length||(c.info("onSessionDisconnect close publisher"),S.publisherSession?S.publisherSession.close():C())})).catch((function(e){c.error("onSessionDisconnect getCallEventsByUUID error",e),0==Object.keys(S.calleeUsers).length&&(S.publisherSession?S.publisherSession.close():C())})))}),1e3)},r.onNewSubscriberSession=function(e,t){let n=i.defer();c.info("onNewSubscriberSession socket",e.socket);return s(e,(function(o){t.onSessionLeftCall=function(){S.leftCallInfo(o)},S.contacts[e.socket]=t,S.contacts[e.socket].participationType=o.participationType,S.updateVideoPosition(),n.resolve()}),(function(e){e&&A(e),t.close(),n.reject()})),n.promise},r.onSubscriberSessionAnswer=function(e){let n=i.defer();c.info("onSubscriberSessionAnswer",e.socket);return s(e,(function(e){let o={user:e,contactCount:Object.keys(S.contacts).length};t.$broadcast("callAnswered",o),S.callInProgress=!0,S.updateVideoPosition(),n.resolve()}),(function(t){t&&A(t),S.contacts[e.socket]&&S.contacts[e.socket].close(),n.reject()})),n.promise},r.onSubscriberSessionReady=function(e,t){c.info("onSubscriberSessionReady: "+t.pluginHandleId,e.socket);let n={room:S.currentUser.room,uuid:S.currentUser.uuid,pluginHandleId:String(t.pluginHandleId),callEventId:0!=e.callEventId&&e.callEventId?e.callEventId:S.callEventId,callArchitecture:"SFU",requestInfo:t};S.sendSubscriberSessionReady(n,e.socket)},r.onPublisherSessionReady=function(e){c.info("onPublisherSessionReady: "+e.pluginHandleId,S.currentUser.socket);let t={room:S.currentUser.room,uuid:S.currentUser.uuid,callArchitecture:"SFU",requestInfo:e,isParticipantTypeHost:S.currentUser.participationType===v.HOST,participantId:S.currentUser.participantId,recordingDirectory:S.callConfigurations.get("JANUS").get("RECORDING_PATH"),record:"T"===S.callConfigurations.get("VIDEO").get("AUTO_RECORD")&&"SERVER"===S.callConfigurations.get("MEETING").get("RECORD_TYPE")};S.sendPublisherSessionReady(t).then((function(e){n()})).catch((function(e){o(e)}))},r.onRemotePublisherLeft=function(e){c.info("onRemotePublisherLeft remoteFeedId: "+e);let t=Object.keys(S.contacts);if(t.length>0)for(let n=0;n<t.length;n++){let o=S.contacts[t[n]];o.config.janusRemoteFeed.rfid==e&&(c.info("onRemotePublisherLeft leave remoteFeedId: "+e,t[n]),o.participationType==v.HOST?Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()})):o.close())}else S.publisherSession&&S.publisherSession.close(),c.info("onRemotePublisherLeft. Unable to find session to close with user remote feed id = "+e)},r.onPublisherLeft=function(){c.info("onPublisherLeft"),a.destroySession()},r.onKickedFromRoom=function(){c.info("Signalling: onKickedFromRoom"),l()},r.onDestroyedVideoRoom=function(){c.info("onDestroyedVideoRoom: "+Object.keys(S.contacts).length),l()},r.onNoSuchRoomError=function(){c.info("onNoSuchRoomError"),l()},r.hasAnyJanusDestroyLock=function(e){let t=i.defer();return c.info("Signalling: hasAnyJanusDestroyLock: "+e),S.hasAnyJanusDestroyLock(e).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)})),t.promise},r.destroyLockIsActive=function(){t.$broadcast("destroyLockIsActive"),a.destroySession()},r.addJanusInfoToRedis=function(e){let t=i.defer();return c.info("Signalling: addJanusInfoToRedis"),S.addJanusInfoToRedis(e,S.currentUser.room).then((function(e){t.resolve()})).catch((function(e){t.reject(e)})),t.promise},r.fetchRemoteVideoStreamConstraints=function(e){S.getRemoteVideoStreamConstraints(e)},r.conf=S.callConfigurations,r.callEventId=e||0,a.publish(S.currentUser,r).then((function(e){c.info("publish call"),S.publisherSession=e,r.callEventId&&S.getCallEventById(r.callEventId).then((function(e){e||(S.publisherSession.close(),o("The call is not active"))}))})).catch((function(e){S.publisherSession&&S.publisherSession.close(),o(e)})).finally((function(){S.publishingInProgress=!1}))})}function C(){c.info("closeSessions: "+Object.keys(S.contacts).length);var e=0;S.getCallEventsByUUID(S.currentUser).then((function(t){c.info("closeSessions callEvent: ",t);let n=e=t.length;t.forEach((function(e){let t={};e.callee==S.currentUser.uuid?t=I(e.caller):e.caller==S.currentUser.uuid&&(t=I(e.callee)),t&&t.uuid&&(t.callEventId=e.id,S.removeCallEventByEventId(t).then((function(){"call"==e.eventName&&e.caller==S.currentUser.uuid?S.sendDiallingEndSignal(t):S.contacts[t.socket]||A(t),n--,0==n&&Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()}))})))}))})).finally((function(){0==Object.keys(S.contacts).length&&(S.removeSubscriberSessionListByUUID(S.currentUser.uuid),S.publisherSession?S.publisherSession.close():T()),0==e&&Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()}))}))}function I(e){return S.onlineUsers.find(t=>t.uuid==e)}function b(e){return S.onlineUsers.find(t=>t.socket==e)}function T(){c.info("endMeeting"),a.destroySession(),t.$broadcast("endMeeting",{endCallInitiatior:S.endCallInitiatior}),S.callInProgress=!1,S.endCallInitiatior=!1}function I(e){return S.onlineUsers.find(t=>t.uuid==e)}function b(e){return S.onlineUsers.find(t=>t.socket==e)}function w(e,n){return c.info("signalling.call",n),new Promise((o,r)=>{let i={onSessionAnswer:function(){n.participantId=n.participantId?n.participantId:0,c.info("onSessionAnswer",n),S.getCallEventById(S.callEventId).then((function(e){if(e){let e=Object.keys(S.contacts),o={user:n,contactCount:e.length};t.$broadcast("callAnswered",o),S.callInProgress=!0,S.updateVideoPosition();let r={room:S.currentUser.room,uuid:S.currentUser.uuid,pluginHandleId:String(S.contacts[n.socket].sessionKey),callEventId:S.callEventId,callArchitecture:"MESH"};S.sendSubscriberSessionReady(r,n.socket)}else S.contacts[n.socket].close()}))},onSessionDisconnect:function(){if(c.info("onSessionDisconnect",n),S.contacts[n.socket]){t.$broadcast("sessionDisconnected",{session:S.contacts[n.socket]});let e=S.hideFromContactList.map((function(e){return e.socket})).indexOf(n.socket);e>-1&&S.hideFromContactList.splice(e,1),S.contacts[n.socket].onSessionLeftCall(),S.removeSubscriberSessionByPluginHandleId(S.contacts[n.socket].sessionKey),delete S.contacts[n.socket],delete S.calleeUsers[n.socket],t.$broadcast("endMeeting",{endCallInitiatior:S.endCallInitiatior})}0===Object.keys(S.contacts).length&&(S.duplicateMessages=[],S.callInProgress=!1),S.endCallInitiatior=!1},onSendMessage:function(e){m.emit("sendMessage",n,{type:"phonertc_handshake",data:window.btoa(JSON.stringify(e)),encoded:!0},null,e=>{e&&e.error&&c.error("sendMessage phonertc_handshake",e.error)}),console.log(JSON.stringify(e))},fetchRemoteVideoStreamConstraints:function(e){S.getRemoteVideoStreamConstraints(e)}};s.call(e,n,S.callConfigurations,i).then((function(e){n.participantId=n.participantId?n.participantId:0,S.getCallEventById(S.callEventId).then((function(t){if(t){S.contacts[n.socket]=e;let t=b(n.socket);S.contacts[n.socket].participationType=t.participationType,S.contacts[n.socket].onSessionLeftCall=function(){S.leftCallInfo(n)},o()}else e.close(),r("The call is not active")}))})).catch((function(e){r(e)}))})}function A(e){m.emit("sendMessage",e,{type:"hangup",callEventId:e.callEventId}),c.info("onHangup",e)}function E(n,r){switch(c.info("signalling.onMessageReceive ",r),r.type){case"call":n.participantId=n.participantId?n.participantId:0,S.callEventId=r.callEventId,n.callEventId=r.callEventId,S.currentUser.serverName=r.serverName,n.callArchitecture=r.callArchitecture,t.$broadcast("incomingCall",n);break;case"accept":e.cancel(S.isAnswerReceivedTimers[n.socket]);break;case"answer":if(e.cancel(S.isAnswerReceivedTimers[n.socket]),clearTimeout(t.sendingCallTimeCounterIntervalId),S.updateVideoPosition(),$(".loading").remove(),$(".loadingSpan").remove(),"MESH"===r.callArchitecture){var i=Object.keys(S.contacts);0!==i.length&&m.emit("sendMessage",n,{type:"add_to_group",contacts:i,isInitiator:!1},null,e=>{e&&e.error&&c.error("sendMessage add_to_group",e.error)}),n.callEventId=r.callEventId,w(!0,n).then((function(){S.setParticipationType(v.HOST)})).catch((function(e){S.calleeUsers={},c.error("P2PVideoCallService call",e)}))}m.emit("sendMessage",n,{type:"answer_ack",callEventId:r.callEventId},null,e=>{e&&e.error&&c.error("sendMessage answer_ack",e.error)}),c.info("answer",n);break;case"busy":e.cancel(S.isAnswerReceivedTimers[n.socket]),(a=S.hideFromContactList.indexOf(n.socket))>-1&&S.hideFromContactList.splice(a,1),S.calleeUsers[n.socket]&&S.calleeUsers[n.socket].onCallRevert&&S.calleeUsers[n.socket].onCallRevert(),u.showToastrLongBottom(n.fullName+" "+o.instant("ASSISTBOX_BUSY")),c.info("busy",n);break;case"ignore":var a;e.cancel(S.isAnswerReceivedTimers[n.socket]),c.info("ignoreCallInfo",n),(a=S.hideFromContactList.indexOf(n.socket))>-1&&S.hideFromContactList.splice(a,1),Object.keys(S.contacts).length>0&&S.contacts[n.socket]&&S.contacts[n.socket].close(),S.ignoreCallInfo(n),S.calleeUsers[n.socket]&&S.calleeUsers[n.socket].onCallRevert&&S.calleeUsers[n.socket].onCallRevert();break;case"diallingEnd":break;case"hangup":c.info("hangup call message callEventId: "+r.callEventId+" signalservice calleventId: "+S.callEventId,n),S.calleeUsers[n.socket]?(S.calleeUsers[n.socket]&&S.calleeUsers[n.socket].onCallRevert&&S.calleeUsers[n.socket].onCallRevert(),S.contacts[n.socket]?S.contacts[n.socket].close():S.getCallEventsInRoom().then((function(e){0==e.length&&S.publisherSession&&S.publisherSession.close()}))):S.callEventId===r.callEventId?Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()})):S.contacts[n.socket]&&S.contacts[n.socket].close();break;case"phonertc_handshake":if(e.cancel(S.isAnswerReceivedTimers[n.socket]),r.encoded){var s=r.data,l=window.atob(s);console.log("phonertc_handshake decoded message data = "+l),r.data=l}if(S.duplicateMessages[n.socket]||"bye"==r.type||(S.duplicateMessages[n.socket]=[]),-1===S.duplicateMessages[n.socket].indexOf(r.data)){S.duplicateMessages[n.socket].push(r.data);var d=S.contacts[n.socket],f=JSON.parse(r.data);d.receiveMessage(f),"bye"==f.type&&delete S.duplicateMessages[n.socket]}break;case"add_to_group":r.contacts.forEach((function(t){S.hideFromContactList.push(t),w(r.isInitiator,t),r.isInitiator||e((function(){m.emit("sendMessage",t,{type:"add_to_group",contacts:[S.currentUser],isInitiator:!0},null,e=>{e&&e.error&&c.error("sendMessage add_to_group",e.error)})}),1500),u.showToastrLongBottom(t.fullName+" "+o.instant("ASSISTBOX_JOINED_THE_CALL"))}));break;case"position":var p=function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};m.emit("sendMessage",r.requester,{type:"positionCallBack",currentPos:t},null,e=>{e&&e.error&&c.error("sendMessage positionCallBack",e.error)})};function g(e){c.error("coordinatesOnError",e),m.emit("sendMessage",r.requester,{type:"positionCallBack",error:e},null,e=>{e&&e.error&&c.error("sendMessage positionCallBack coordinatesOnError",e.error)})}var h=o.use();"android"==cordova.platformId?cordova.plugins.locationServices.geolocation.getCurrentPosition(p,g,{lang:h,maximumAge:1,enableHighAccuracy:!0}):navigator.geolocation.getCurrentPosition(p,g,{maximumAge:1,enableHighAccuracy:!0});break;case"positionCallBack":t.$broadcast("positionSuccessCallBack",{currentPos:r.currentPos});break;case"cameraFlashOff":var y=function(e){m.emit("sendMessage",r.requester,{type:"cameraFlashOffError",error:e},null,e=>{e&&e.error&&c.error("sendMessage cameraFlashOffError flashLightSwitchOffErrorCallBack",e.error)})};"Back"==sessionStorage.getItem("camera")?window.plugins.flashlight.switchOff((function(){m.emit("sendMessage",r.requester,{type:"cameraFlashOffSuccess"},null,e=>{e&&e.error&&c.error("sendMessage cameraFlashOffSuccess flashLightSwitchOffSuccessCallBack",e.error)})}),y):y("front_cam_error");break;case"cameraFlashOn":var C=function(e){m.emit("sendMessage",r.requester,{type:"cameraFlashOnError",error:e},null,e=>{e&&e.error&&c.error("sendMessage cameraFlashOnError flashLightSwitchOnErrorCallBack",e.error)})};"Back"==sessionStorage.getItem("camera")?window.plugins.flashlight.switchOn((function(){m.emit("sendMessage",r.requester,{type:"cameraFlashOnSuccess"},null,e=>{e&&e.error&&c.error("sendMessage cameraFlashOnSuccess flashLightSwitchOnSuccessCallBack",e.error)})}),C):C("front_cam_error");break;case"chatMessage":t.$broadcast("chatMessage",{messageData:r.messageData});break;case"triggerRemoteAction":r.remoteActionRequest.type;t.$broadcast("triggerRemoteAction",{remoteActionRequestMessage:r.remoteActionRequest,callBack:function(e){m.emit("sendMessage",r.requester,{type:"triggerRemoteActionResult",remoteActionResult:e},null,e=>{e&&e.error&&c.error("sendMessage triggerRemoteActionResult triggerRemoteActionCallBack",e.error)})}});break;case"changeTrackType":t.$broadcast("changeTrackType",{trackType:r.trackType});break;case"roomInfoReceived":console.log("client received room info"),S.sendCallSignal(n).then((function(){c.info("sendCallSignal",n)})).catch(e=>{u.showErrorToastr(o.instant("ASSISTBOX_SEND_CALL_ERROR")),c.error("SignalService sendCall",e)});break;case"closeContactForm":t.$broadcast("customerCloseContactForm");break;case"submitContactForm":n.firstName=r.contactInfo.firstName,n.lastName=r.contactInfo.lastName,n.phoneNo=r.contactInfo.phone,n.email=r.contactInfo.email,S.contacts[n.socket].onSessionLeftCall=function(){S.leftCallInfo(n)},t.$broadcast("customerSubmitContactForm",{contactInfo:r.contactInfo});break;case"changeStreamConstraints":c.info("changeStreamConstraints",n),cordova.plugins.phonertc.changeRemoteStreamConstraints(r.messageData.streamConstraints,parseInt(n.participantId));break;case"permissionDenied":t.$broadcast("permissionDenied"),S.calleeUsers[n.socket]&&S.calleeUsers[n.socket].onCallRevert&&S.calleeUsers[n.socket].onCallRevert();break;case"kick":c.info("kick",n),Object.keys(S.contacts).forEach((function(e){S.contacts[e].close()}));break;case"connectingCallError":R(n),S.calleeUsers[n.socket]&&S.calleeUsers[n.socket].onCallRevert&&S.calleeUsers[n.socket].onCallRevert(),S.contacts[n.socket]?S.contacts[n.socket].close():S.getCallEventsInRoom().then((function(e){0==e.length&&S.publisherSession&&S.publisherSession.close()}));let I={message:r,user:n};c.error("sendMessageError",I);break;case"triggerContactForm":t.$broadcast("triggerContactForm");break;case"sendRoomAndParticipantInfo":const b=r.room,T=r.participantId;S.occupied=!0,S.currentUser.room=b,S.currentUser.participantId=T,c.info("received room info",b),t.$broadcast("roomAndParticipantInfoReceived",b,T,r.guestToken,n);break;case"forwardToQueue":c.info("forwardToQueue",r.messageData.queueCode),t.$broadcast("forwardToQueue",r.messageData.queueCode)}}function _(e){e.socket==S.currentUser.socket||e.participationType==v.HOST?(0==Object.keys(S.calleeUsers).length&&0==Object.keys(S.contacts).length&&S.publisherSession&&S.publisherSession.close(),Object.keys(S.calleeUsers).forEach((function(e){S.calleeUsers[e].onCallRevert&&S.calleeUsers[e].onCallRevert()})),Object.keys(S.contacts).forEach((function(e){S.contacts[e]&&S.contacts[e].close()}))):(S.calleeUsers[e.socket]&&S.calleeUsers[e.socket].onCallRevert&&S.calleeUsers[e.socket].onCallRevert(),S.contacts[e.socket]&&S.contacts[e.socket].close())}function R(e){let t=e?e.fullName+" "+o.instant("ASSISTBOX_CONNECTING_CALL_ERROR"):o.instant("DIALOGS_ERROR_MSG");u.showToastrLongBottom(t)}this.isConnected=function(){return m&&m.connected},this.sendCallSignal=function(n){S.currentUser.serverName=void 0;var o=i.defer();let r=S.callConfigurations.get("CALL").get("CALL_ARCHITECTURE");S.calleeUsers[n.socket]=n,S.setParticipationType(v.HOST);let a=function(n){n.callEventId=Math.random().toString(36).substr(2,9),"MESH"===r&&(S.callEventId=n.callEventId),S.isAnswerReceivedTimers[n.socket]=e((function(){S.callInProgress||t.$broadcast("answerNotReceived",n)}),2e4),S.calleeUsers[n.socket].onCallRevert=function(){!function(e){delete S.calleeUsers[e.socket],S.getCallEventsInRoom().then((function(e){0==e.length&&S.publisherSession&&S.publisherSession.close()}))}(this)};let i={type:"call",callArchitecture:r,callEventId:n.callEventId,serverName:S.currentUser.serverName};m.emit("sendMessage",n,i,null,e=>{e&&e.error&&(delete S.calleeUsers[n.socket],0==Object.keys(S.calleeUsers).length&&S.publisherSession&&S.publisherSession.close(),o.reject(e)),e&&!e.error&&o.resolve()})};if("SFU"===r)h.getJanusGatewayServerName(S.currentUser.room).then(e=>{200==e.status?(S.currentUser.serverName=e.data.serverName,S.publisherSession?S.publisherSession&&a(n):S.publishingInProgress||y().then((function(){Object.keys(S.calleeUsers).forEach((function(e){a(S.calleeUsers[e])}))})).catch((function(e){c.error("SfuVideoRoomService call",e),S.calleeUsers={},o.reject(e)}))):(c.error("Signalling: getJanusGatewayServerName returns invalid response!"),o.reject())}).catch(e=>{S.currentUser.serverName=void 0,c.error("Signalling: LoadBalancerService getJanusGatewayServerName",e),o.reject(e)});else if("MESH"===r)a(n);else{delete S.calleeUsers[n.socket];let e="Call architecture is invalid!";o.reject(e)}return o.promise},this.sendPositionSignal=function(e){let t=i.defer();return m.emit("sendMessage",e,{type:"position",requester:S.currentUser},null,e=>{e&&e.error&&(c.error("sendPositionSignal",e.error),t.reject()),e&&!e.error&&(c.error("sendPositionSignal success"),t.resolve())}),t.promise},this.cameraFlashOff=function(e){let t=i.defer();return m.emit("sendMessage",e,{type:"cameraFlashOff",requester:S.currentUser},null,e=>{e&&e.error&&(c.error("cameraFlashOff",e.error),t.reject()),e&&!e.error&&(c.error("cameraFlashOff success"),t.resolve())}),t.promise},this.cameraFlashOn=function(e){let t=i.defer();return m.emit("sendMessage",e,{type:"cameraFlashOn",requester:S.currentUser},null,e=>{e&&e.error&&(c.error("cameraFlashOn",e.error),t.reject()),e&&!e.error&&(c.error("cameraFlashOn success"),t.resolve())}),t.promise},this.ignoreCall=function(e){m.emit("sendMessage",e,{type:"ignore",callEventId:e.callEventId})},this.endCall=function(t){c.info("end call for user: ",t),S.endCallInitiatior=!0,t?(A(t),S.contacts[t.socket]&&S.contacts[t.socket].close(),e.cancel(S.isAnswerReceivedTimers[t.socket])):(S.duplicateMessages=[],C())},this.answerCall=function(e,t){c.info("answerCall"),e.participantId=e.participantId?e.participantId:0,S.setParticipationType(v.PARTICIPANT);let n=function(e){S.getCallEventById(e.callEventId).then((function(t){if(t){let t=function(t){"MESH"===e.callArchitecture&&S.updateVideoPosition(),c.info("sending answer"),m.emit("sendMessage",t,{type:"answer",callArchitecture:t.callArchitecture,callEventId:t.callEventId},null,e=>{e&&e.error&&(c.error("answerCall answer signal",e.error),R(t),S.publisherSession&&S.publisherSession.close()),e&&!e.error&&($(".loading").remove(),$(".loadingSpan").remove())})};S.updateVideoPosition(),"MESH"===e.callArchitecture?w(!1,e).then((function(){t(e)})).catch((function(e){c.error("P2PVideoCallService call",e)})):"SFU"===e.callArchitecture?S.publisherSession?t(e):y(e.callEventId).then((function(){t(e)})).catch((function(e){c.error("SfuVideoRoomService call",e)})):c.error("Call architecture is invalid!")}}))};t?m.emit("sendMessage",e,{type:"accept",callEventId:e.callEventId},null,t=>{t&&t.error&&(c.error("answerCall accept signal",t.error),R(e)),t&&!t.error&&n(e)}):n(e)},this.setParticipationType=function(e){m.emit("set_participation_type",e)},this.setOnlineUsers=function(e,n){S.onlineUsers.length=0,e.forEach((function(e){e.uuid!==n.uuid?S.onlineUsers.push(e):t.$broadcast("updateCurrentUserSocket",e.socket)}))},this.getOnlineUsers=function(){return S.onlineUsers},this.setCompanyId=function(e){S.companyId=e},this.connect=function(n,a,s,l){var d=i.defer();return s.token=a,c.info("signalling.connect"),r.getPublicConfigurations().then((function(i){let f={TURN:["TURN_URL"],CALL:["CALL_ARCHITECTURE"],JANUS:["JANUS_REST_ENDPOINT","RECORDING_PATH","HOSTNAME","PORT","USE_JANUS_PROXY"],VIDEO:["AUTO_RECORD"],MEETING:["ICE_TRANSPORT_POLICY","RECORD_TYPE"],SIGNAL_SERVER:["SIGNAL_SERVER_URL"]};r.isUseJanusProxy(i.data)?c.info("Janus proxy is enabled"):(c.info("Janus proxy is disabled"),f.JANUS.push("API_SECRET")),S.callConfigurations=r.filterCompanyConfigurationsBySelectedKeys(i.data,f);var p=s.room,g={transports:["websocket"],room:p,forceNew:!0,reconnection:!1,query:{room:p}};if(m&&m.disconnected)try{c.info("signalling.io.connect"),m=io.connect(n,g)}catch(e){c.error("socket io connect",error)}else m&&m.connected?(c.info("socket.connected is true"),s.socket=m.io.engine.id,S.currentUser=s,t.$broadcast("updateCurrentUserSocket",S.currentUser.socket),e((function(){d.resolve(S.currentUser)}),500)):m=io.connect(n,g);m.removeAllListeners(),m.on("online",(function(e){c.info("signalling.socket.on.online"),-1===S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket)&&e.socket!==S.currentUser.socket&&S.onlineUsers.push(e)})),m.on("activate_user",(function(e){c.info("signalling.socket.on.activateUser",e);var n=S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket);-1!=n&&(S.onlineUsers.splice(n,1),S.onlineUsers.push(e),u.showToastrLongTop(e.fullName+" "+o.instant("ASSISTBOX_ONLINE")),t.$broadcast("activateUser",e))})),m.on("inactivate_user",(function(e){c.info("signalling.socket.on.inactivate_user",e);var n=S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket);-1!=n&&(S.onlineUsers.splice(n,1),S.onlineUsers.push(e),u.showToastrLongTop(e.fullName?e.fullName:o.instant("ASSISTBOX_PARTICIPANT")+" "+o.instant("ASSISTBOX_OFFLINE")),t.$broadcast("inactivateUser",e)),_(e)})),m.on("offline",(function(e){c.info("signalling.socket.on.offline",e);var n=S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket);-1!==n&&(S.onlineUsers.splice(n,1),u.showToastrLongTop(e.fullName?e.fullName:o.instant("ASSISTBOX_PARTICIPANT")+" "+o.instant("ASSISTBOX_OFFLINE")),t.$broadcast("offlineUser",e)),_(e)})),m.on("socket_replaced",(function(){c.info("socket_replaced"),l.onSocketReplaced&&l.onSocketReplaced()})),m.on("exist_user",(function(e){t.$broadcast("checkExistingUser",e)})),m.on("replace_socket",(function(e){c.info("signalling.socket.on.replace_socket",e);var t=S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket);-1!=t&&S.onlineUsers.splice(t,1),e.socket==S.currentUser.socket?(l.onReplaceSocket&&l.onReplaceSocket(e),Object.keys(S.calleeUsers).forEach((function(e){S.calleeUsers[e].onCallRevert&&S.calleeUsers[e].onCallRevert()})),0==Object.keys(S.contacts).length?S.leaveRoom(s.room):S.endCall()):_(e),S.updateVideoPosition()})),m.on("connect",(function(){c.info("socket connected js side",m.connected),m.emit("authenticate",{token:a})})),m.on("authenticate_error",(function(e){c.error("authenticate_error",e),d.reject()})),m.on("connected",(function(){c.info("socket connected",m.connected),m.connected?(s.socket=m.io.engine.id,S.currentUser=s,c.info("socket.io.engine.id: "+m.io.engine.id),t.$broadcast("updateCurrentUserSocket",S.currentUser.socket),d.resolve(S.currentUser)):d.reject()})),m.on("connect_error",(function(e){c.error("socket connection error",e),t.$broadcast("onSignalServiceConnectError")})),m.on("users_in_room",(function(e){c.info("signalling.socket.on.users_in_room",e),S.setOnlineUsers(e,S.currentUser)})),m.on("error",(function(e){c.error("socket error",e),d.reject()})),m.on("reconnect_attempt",(function(){c.info("reconnect attempt"),m.io.opts.transports=["websocket"]})),m.on("messageReceived",E),m.on("set_user_participation_type",(function(e){var t=S.onlineUsers.map((function(e){return e.socket})).indexOf(e.socket);-1!=t?(S.onlineUsers.splice(t,1),S.onlineUsers.push(e)):(S.currentUser.participationType=e.participationType,c.info("set user participation type",e))})),m.on("clients_in_queue",(function(e,n,o){t.$broadcast("clientsInQueue",e,n,o)})),m.on("agents_in_queue",(function(e){t.$broadcast("agentsInQueue",e),console.log(e)})),m.on("client_queue_order",(function(e){console.log("client_queue_order : "+e),t.$broadcast("queueOrder",e)})),m.on("occupy_user",(function(e,n){S.currentUser.participationType=v.PARTICIPANT,S.occupied?(c.info("user already occupied",e),m.emit("user_already_occupied",e,n)):(S.occupied=!0,c.info("occupy user successful",e),m.emit("occupy_user_successful",e,n),t.$broadcast("occupied"),S.leaveClientQueue(S.currentUser.queueId),S.onlineUsers.push(e))}))})).catch((function(){d.reject("Unable to get company configurations!")})),d.promise},this.removeOccupyListeners=function(){c.info("signalling.removeOccupyListeners"),m.removeAllListeners("occupy_user_successful"),m.removeAllListeners("occupy_user_error"),m.removeAllListeners("client_not_responding")},this.removeClientFromQueue=function(e,t){c.info("signalling.removeClientFromQueue"),m.emit("remove_client_from_queue",e,t)},this.setAgentState=function(t,n){var o=!1,r=i.defer();if(!m||m.disconnected)return r.reject(),r.promise;e((function(){o=!0,r.reject()}),5e3);return m.emit("set_agent_state",t,f.retrieve(),"MOBILE",p.retrieve("session_id"),n,(function(e,t){e?(c.error("signalling.socket.on.set_agent_state.error",e),o||r.reject(e)):o||(c.info("signalling.socket.on.set_agent_state.success",t),r.resolve(t))})),r.promise},this.getAgentState=function(){var t=!1,n=i.defer();if(m.disconnected)return n.reject(),n.promise;e((function(){t=!0,n.reject()}),7500);return m.on("agent_availability_success",(function(e){t||n.resolve(e)})),m.on("agent_availability_error",(function(e){c.error("signalling.socket.on.agent_availability_error",e),t||n.reject(e)})),m.emit("agent_availability"),m.emit("get_agent_state",(function(e,o){e?(c.error("signalling.socket.on.get_agent_state.error",e),t||n.reject(e)):(c.info("signalling.socket.on.get_agent_state.success",o),t||n.resolve(o))})),n.promise},this.getClientsInQueues=function(e){var t=i.defer();return m.on("get_clients_in_queues",(function(e){t.resolve(e),m.removeAllListeners("get_clients_in_queues"),m.removeAllListeners("get_clients_in_queues_error")})),m.on("get_clients_in_queues_error",(function(e){t.reject(e),m.removeAllListeners("get_clients_in_queues"),m.removeAllListeners("get_clients_in_queues_error")})),m.emit("get_clients_in_queues",e),t.promise},this.occupyClient=function(e,t,n){S.removeOccupyListeners();let o=e,r=setTimeout(()=>{S.removeOccupyListeners(),n.userNotResponding(o,t)},15e3);m.on("occupy_user_successful",(function(e,t){S.removeOccupyListeners(),n.occupySuccessful(e,t),clearTimeout(r)})),m.on("occupy_user_error",(function(e){S.removeOccupyListeners(),n.occupyUserError(e),clearTimeout(r)})),m.on("client_not_responding",(function(e,t){S.removeOccupyListeners(),n.userNotResponding(e,t)}));m.emit("occupy_user",e,t,(function(e){o=e}))},this.agentOnline=function(e){var n=i.defer();return m.on("agent_online_successful",(function(){n.resolve()})),m.on("agent_online_error",(function(e){c.error("signalling.socket.on.agent_online_error",e),n.reject(e)})),m.on("close_call_screen",(function(e){t.$broadcast("closeCallScreen",e)})),m.emit("agent_online",S.currentUser,f.retrieve(),"MOBILE"),n.promise},this.rejectCallFromQueue=function(e,t){m.emit("agent_reject_call",e,f.retrieve(),"MOBILE",t.getTime(),p.retrieve("session_id"),p.retrieve("call_id")),p.remove("call_id"),cordova.plugins.phonertc.clearCallId()},this.canceledCallFromQueue=function(e){m.emit("canceled_call",e,f.retrieve(),"MOBILE",(new Date).getTime(),p.retrieve("session_id"),p.retrieve("call_id")),p.remove("call_id"),cordova.plugins.phonertc.clearCallId()},this.joinRoom=function(e){return S.currentUser.room=e,c.debug("Signalling: emit join room request = "+e),new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("Signalling: join_room No socket connection.",e),n("No socket connection.")):m.emit("join_room",e,e=>{e&&e.error&&(c.error("Signalling: Join room response has error."),n(e)),c.debug("Signalling: User joined to room"),t()})})},this.setParticipantIdToCurrentUser=function(e){S.currentUser.participantId=e},this.leaveRoom=function(e){m.emit("leave_room",e),c.info("leave room = "+e)},this.sendRoomAndParticipantInfo=function(e,t,n,o){S.currentUser.room=n,m.emit("sendMessage",e,{type:"sendRoomAndParticipantInfo",queueId:t,room:n,participantId:e.participantId,guestToken:o})},this.sendMeetingResultInfo=function(e,t,n){m.emit("sendMessage",e,{type:"sendMeetingResultInfo",queueId:t,meetingResult:n},{token:f.retrieve(),source:"MOBILE",sessionId:p.retrieve("session_id"),callId:p.retrieve("call_id")||g.getRandomId()})},this.sendCallReceivedInfo=function(e,t,n){m.emit("agent_received_call",e,f.retrieve(),"MOBILE",t.getTime(),p.retrieve("session_id"),p.retrieve("call_id"),n)},this.createStateLog=function(e){m.emit("create_state_log",e,f.retrieve(),"MOBILE",p.retrieve("session_id"))},this.triggerContactForm=function(e){m.emit("sendMessage",e,{type:"triggerContactForm"})},this.checkAgentOnline=function(){m.emit("check_agent_online",S.currentUser)},this.replaceExistingUser=function(e){m.emit("replace_existing_user",e,f.retrieve(),"MOBILE",p.retrieve("session_id"))},this.getRemoteVideoStreamConstraints=function(e){c.info("get_stream_constraints_participant",e);let t=function(e){return S.onlineUsers.find(t=>t.participantId==e)}(e);t?m.emit("get_stream_constraints_participant",t,e=>{e&&e.error?c.error("get_stream_constraints_participant error",e):(c.info("get_stream_constraints_participant",e),e.streamConstraints?cordova.plugins.phonertc.changeRemoteStreamConstraints(e.streamConstraints,parseInt(e.participantId)):c.debug("get_stream_constraints_participant: No streamConstraints in the response, skip processing remote stream constraints"))}):c.warn("get_stream_constraints_participant: No user by participantId: "+e+" #online users: "+S.onlineUsers.length)},this.joinClientQueue=function(e,t){S.currentUser.queueId=e,m.emit("join_client_queue",S.currentUser,e,t)},this.leaveClientQueue=function(e){m.emit("leave_client_queue",e)},this.changeStreamConstraints=function(e,t){let n={streamConstraints:{audio:e,video:t},fromUser:S.currentUser};m.emit("sendMessage",null,{type:"changeStreamConstraints",messageData:n})},this.online=function(e){var t=i.defer();return m.emit("login",e,e.room),m.on("login_error",(function(e){console.log("login error : "+e),t.reject(e)})),m.on("login_successful",(function(e){S.setOnlineUsers(e,S.currentUser),console.log("login_successful"),t.resolve()})),m.on("disconnect",(function(e){c.error("socket disconnect",e),S.endCall(),a.destroyVideoRoom(S.currentUser.room),S.currentUser.socket&&d.deleteAllByUUID(S.currentUser).then((function(e){200==e.status&&c.info("socket disconnect deleteAllByUUID success socketId: ",S.currentUser.socket)})).catch((function(e){c.error("socket disconnect deleteAllByUUID",e)}))})),t.promise},this.activateUser=function(e){m.emit("activate_user",e.room),m.on("activate_user_error",(function(t){console.log("activate_user_error: "+t),u.showToastrLongTop(o.instant("ASSISTBOX_OFFLINE")),c.error("activateUserError",e)}))},this.inactivateUser=function(e){m.emit("inactivate_user",e.room),m.on("inactivate_user_error",(function(e){c.error("inactivate user error",e)}))},this.renegotiate=function(e,t){Object.keys(S.contacts).forEach((function(n){let o=S.contacts[n];"publisher"==o.ptype&&(o.streams.audio=e,o.streams.video=t,o.renegotiate())})),S.publisherSession&&(S.publisherSession.streams.audio=e,S.publisherSession.streams.video=t,S.publisherSession.renegotiate())},this.sendBlurMessage=function(e){m.emit("sendMessage",null,{type:"blurRemoteVideoView",messageData:e},null,e=>{e&&e.error&&c.error("blurRemoteVideoView",e.error)})},this.sendChatMessage=function(e){var t=i.defer();return"ALL"===e.toUser&&(e.toUser=null),m.emit("sendMessage",e.toUser,{type:"chatMessage",messageData:e},{token:f.retrieve()},e=>{e&&e.error&&(c.error("sendChatMessage",e.error),t.reject()),e&&!e.error&&(c.error("sendChatMessage success"),t.resolve())}),t.promise},this.queueForwarding=function(e){var t=i.defer();return"ALL"===e.toUser&&(e.toUser=null),m.emit("sendMessage",e.toUser,{type:"forwardToQueue",messageData:e},e=>{e&&e.error&&(c.error("queueForwarding",e.error),t.reject()),e&&!e.error&&(c.error("queueForwarding success"),t.resolve())}),t.promise},this.disconnectCurrentUserSocket=function(){c.info("signalling.socket.on.disconnectCurrentUserSocket"),m.removeAllListeners(),m&&(m.close(),c.info("disconnectCurrentUserSocket socket disconnected"))},this.sendDiallingEndSignal=function(e){c.info("sendDiallingEndSignal"),m.emit("sendMessage",e,{type:"diallingEnd",callEventId:e.callEventId})},this.diallingEnd=function(e){c.info("dialling end signal"),m.emit("sendMessage",e,{type:"diallingEnd",callEventId:e.callEventId},null,e=>{e&&!e.error&&S.getCallEventsByUUID(S.currentUser).then((function(e){0==e.length&&S.publisherSession&&S.publisherSession.close()}))})},this.leftCallInfo=function(e){if(!S)return;let t="";t=l.isEmpty(e.fullName)?l.isEmpty(e.firstName)&&l.isEmpty(e.lastName)?o.instant("ASSISTBOX_PARTICIPANT"):(e.firstName||"")+" "+(e.lastName||""):e.fullName,u.showToastrLongBottom(t+" "+o.instant("ASSISTBOX_HAS_LEFT_CALL")),c.info("leftCallInfo",e)},this.ignoreCallInfo=function(e){if(S){var n=e.fullName;t.sendingCall=!1,t.contactName="",StatusBar.hide(),StatusBar.overlaysWebView(!0),clearTimeout(t.sendingCallTimeCounterIntervalId),u.showToastrLongBottom(n+" "+o.instant("ASSISTBOX_HAS_REJECTED_CALL")),c.info("ignoreCallInfo",e)}},this.sendRoomInfoReceivedMessage=function(e){m.emit("sendMessage",e,{type:"roomInfoReceived"})},t.$on("updateCurrentUserSocket",(function(e,t){S&&(S.currentUser.socket=t)})),this.removeListeners=function(){m.removeAllListeners()},this.getCallEventsInRoom=function(){return new Promise((e,t)=>{!m||m&&m.disconnected?(c.warn("getCallEventsInRoom No socket connection."),t("No socket connection.")):m.emit("get_call_events_in_room",S.currentUser.room,n=>{c.info("get_call_events_in_room_success",n),n&&n.error&&t(n),e(n)})})},this.getCallEventByCallee=function(e){return new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("getCallEventByCallee No socket connection.",e),n("No socket connection.")):m.emit("get_call_event_by_callee",e,S.currentUser.room,e=>{c.info("get_call_event_by_callee_success",e),e&&e.error&&n(e),t(e)})})},this.getCallEventById=function(e){return new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("getCallEventById No socket connection.",e),n("No socket connection.")):m.emit("get_call_event_by_event_id",e,o=>{c.info("get_call_event_by_event_id_success eventId:"+e,o),o&&o.error&&n(o),t(o)})})},this.getCallEventsByUUID=function(e){return c.info("getCallEventsByUUID",e),new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("getCallEventsByUUID No socket connection.",e),n("No socket connection.")):m.emit("get_call_events_by_uuid",e.uuid,e.room,e=>{c.info("get_call_events_by_uuid_success",e),e&&e.error&&n(e),t(e)})})},this.removeCallEventByEventId=function(e){return new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("removeCallEventByEventId No socket connection.",e),n("No socket connection.")):m.emit("remove_call_events_by_event_id",e.callEventId,e.room,e=>{c.info("remove_call_events_by_event_id_success"),e&&e.error&&n(e),t()})})},this.removeSubscriberSessionByPluginHandleId=function(e){c.info("removeSubscriberSessionByPluginHandleId"),m.emit("remove_subscriber_session_by_plugin_handle_id",e,S.currentUser.room)},this.removeSubscriberSessionListByUUID=function(e){c.info("removeSubscriberSessionListByUUID"),m.emit("remove_subscriber_session_by_uuid",e,S.currentUser.room)},this.sendSubscriberSessionReady=function(e,t){!m||m&&m.disconnected?(c.warn("subscriber_session_start no socket connection."),reject("No socket connection.")):m.emit("subscriber_session_ready",e,e=>{if(e&&e.error){c.error("subscriber_session_ready",e);let n=b(t);n&&(R(n),A(n)),S.calleeUsers[t]&&S.calleeUsers[t].onCallRevert&&S.calleeUsers[t].onCallRevert(),S.contacts[t]?S.contacts[t].close():0===Object.keys(S.contacts).length&&S.getCallEventsInRoom().then((function(e){0!==e.length&&0!==Object.keys(S.calleeUsers).length||(S.publisherSession?S.publisherSession.close():S.checkVideoRoomAndLeave())}))}})},this.sendPublisherSessionReady=function(e){return new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("publisher_session_start no socket connection."),n("No socket connection.")):m.emit("publisher_session_ready",e,e=>{e&&e.error&&(c.error("publisher_session_start",e),R(),C(),n(e.error)),e&&!e.error&&(c.info("publisher_session_start",e),t())})})},this.hasAnyJanusDestroyLock=function(e){return new Promise((t,n)=>{!m||m&&m.disconnected?(c.warn("Signalling: hasAnyJanusDestroyLock No socket connection.",e),n("No socket connection.")):m.emit("has_any_destroy_lock",e,o=>{c.info("Signalling: has_any_destroy_lock",o,e),o&&o.error&&(c.error("Signalling: has_any_destroy_lock",o,e),n(o.error)),o&&!o.error&&t(o.result)})})},this.addJanusInfoToRedis=function(e,t){return new Promise((n,o)=>{!m||m&&m.disconnected?(c.warn("Signalling: addJanusInfoToRedis No socket connection.",t),o("No socket connection.")):m.emit("add_janus_info_to_redis",e,t,e=>{c.info("Signalling: add_janus_info_to_redis",e,t),e&&e.error&&(c.error("Signalling: add_janus_info_to_redis",e,t),o(e.error)),e&&!e.error&&n()})})},this.removePublisherSessionByUUID=function(e){c.info("Signalling: removePublisherSessionByUUID"),m.emit("remove_publisher_session_by_uuid",e,S.currentUser.room)}}n.$inject=["$timeout","$rootScope","$compile","$translate","ConfigurationService","$q","SfuVideoRoomService","P2PVideoCallService","LogService","StringUtil","ToastrService","RedisSignalService","TokenStorage","LocalStorageUtil","RandomUtil","LoadBalancerService"],e.exports=n},function(e,t){function n(e,t,n,o){this.login=function(o){o.extraParameters={},o.extraParameters.validForInSeconds=5184e3;var r=n.getPath(),i=e.defer();return o.deviceInfo=this.createDeviceInfo(),o.source="MOBILE",console.log("login.sessionId-> "+o.sessionId),t({method:"post",url:r+"/rest/api/authenticationService/login",data:o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.signUp=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/authenticationService/signup",data:o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.logout=function(e){var r=n.getPath();let i={deviceInfo:this.createDeviceInfo(),sessionId:o.retrieve("session_id"),source:"MOBILE",socketReplaced:e};return console.log("logout.sessionId-> "+i.sessionId),t({method:"POST",url:r+"/rest/api/authenticationService/logout",data:i,headers:{"Content-Type":"application/json"}})},this.createDeviceInfo=function(){return{model:device.model,manufacturer:device.manufacturer,platform:navigator.userAgent,serial:device.serial,uuid:device.uuid,deviceVersion:device.version}}}n.$inject=["$q","$http","ServicePath","LocalStorageUtil"],e.exports=n},function(e,t){function n(){this.isEmpty=function(e){return!e||0===e.length},this.getRandomId=function(){return Math.random().toString(36).substr(2,9)},this.stringify=function(e){return"object"==typeof e&&null!=e?JSON.stringify(e,this.replaceErrors):e},this.replaceErrors=function(e,t){if(t instanceof Error){let e={};return Object.getOwnPropertyNames(t).forEach((function(n){e[n]=t[n]})),e}return t}}n.$inject=[],e.exports=n},function(e,t){e.exports=function(){this.getCryptoRand=function(){const e=new Uint32Array(1);return(window.crypto||window.msCrypto).getRandomValues(e),e[0]/4294967296},this.getRandomAlphaNumericString=function(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var n="";0!=e--;){var o=this.getCryptoRand()*t.length;n+=t.charAt(o)}return n},this.getRandomId=function(){return console.log("RANDOM_CRYPTO"),([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}}},function(e,t,n){(function(t){function n(e,n,o,r){this.noop=function(){},this.janus=null;let i=null,a=null,s=null,c=null,l=this,u=LogSeverity(),d={},f=!1,p=[],g=function(e,t,o,r){r==u.Info?n.info(e):r==u.Error&&n.error(e)},h=function(e,t,o,r,i){i==u.Info?n.info(e,t):i==u.Error&&n.error(e,t)};function m(e,t,n){let o=JSON.stringify({socket:e.socket,username:e.fullName,participantId:e.participantId?e.participantId:0,callEventId:n}),r=parseInt(e.room);return new Promise((e,n)=>{let a={request:"join",room:parseInt(r),ptype:t,display:o};i.send({message:a,success:function(){e()},error:function(){n()}})})}function v(r,i,a,s,u,f){n.info("SfuVideoRoom: Invoked newRemoteFeed with opaqueId="+r+", roomId="+i+", feedId="+s+", userSocket=",u.socket);let p=null;l.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:r,success:function(e){p=e,p.simulcastStarted=!1,n.info("SfuVideoRoom: Plugin attached! ("+JSON.stringify(p.getPlugin())+", id="+JSON.stringify(p.getId())+")"),n.info("SfuVideoRoom:  -- This is a subscriber");let t={request:"join",room:parseInt(i),ptype:"subscriber",feed:s,private_id:c};n.info("SfuVideoRoom: Join room as subscriber for feed="+s),p.send({message:t})},error:function(e){n.error("SfuVideoRoom:  -- Error attaching plugin... ",e)},onmessage:function(r,s){n.info("SfuVideoRoom ::: Got a message (subscriber) :::",r);let c=r.videoroom;n.info("SfuVideoRoom: Event",c),r.error?(426==r.error_code&&l.janus&&f.onNoSuchRoomError(),n.error("SfuVideoRoom: newRemoteFeed onmessage error",r.error)):c&&("attached"===c?(p.rfid=r.id,p.rfdisplay=r.display,n.info("SfuVideoRoom: Successfully attached to feed "+JSON.stringify(p.rfid)+" ("+JSON.stringify(p.rfdisplay)+") in room "+JSON.stringify(r.room))):"event"===c&&n.info("SfuVideoRoom: newRemoteFeed onmessage event: ",r)),s&&(n.info("SfuVideoRoom: Handling SDP as well... ",s),function(r,i,a,s,c){let l=c.conf;return new Promise((u,f)=>{o.getCoturnToken().then((function(o){let p={isInitiator:!1,turn:{host:l.get("TURN").get("TURN_URL"),username:o.data.username,password:o.data.password},streams:{audio:!1,video:!1},callArchitecture:l.get("CALL").get("CALL_ARCHITECTURE"),ptype:"subscriber",janusRemoteFeed:s,roomId:r,participantId:i,remoteParticipantId:parseInt(a.participantId),logger:g,jsonLogger:h,iceTransportPolicy:l.get("MEETING").get("ICE_TRANSPORT_POLICY")},m=new cordova.plugins.phonertc.Session(p);m.on("sendMessage",(function(e){if("offer"===e.type){n.info("SfuVideoRoom: subscriberSession Remote handle is sending local offer to remote",e);let t={request:"configure",audio:p.streams.audio,video:p.streams.video};s.send({message:t,jsep:e})}if("answer"==e.type)if(n.info("SfuVideoRoom: subscriberSession Remote handle is sending answer to remote",e),c.onSubscriberSessionReady&&s)d.jsep=t.from(JSON.stringify(e)).toString("base64"),d.sessionId=s.session.getSessionId(),d.pluginHandleId=s.getId(),d.encoded=!0,c.onSubscriberSessionReady(a,d);else{let t={request:"start",room:r};s.send({message:t,jsep:e})}if("candidate"===e.type){n.info("SfuVideoRoom: subscriberSession Local candidate is generated: ",e);let t={candidate:e.candidate,sdpMLineIndex:e.label,sdpMid:e.id};n.info("SfuVideoRoom: subscriberSession Remote feed plugin is sending local candidate to remote",t),s.sendTrickleCandidate(t)}"IceGatheringChange"==e.type&&e.state&&"complete"==e.state.toLowerCase()&&(n.info("SfuVideoRoom: Ice gathering is completed!"),s.sendTrickleCandidate({completed:!0}))})),m.on("answer",(function(){c.onSubscriberSessionAnswer(a).then((function(){})).catch((function(e){n.error("SfuVideoRoom: onSubscriberSessionAnswer hangup",a)}))})),m.on("iceConnected",(function(){n.info("SfuVideoRoom: subscriberSession Ice connection is established!"),e.$broadcast("iceConnected",{session:m})})),m.on("iceDisconnected",(function(){n.info("SfuVideoRoom: subscriberSession Ice connection is lost!"),e.$broadcast("iceDisconnected",{session:m})})),m.on("disconnect",(function(){n.info("SfuVideoRoom: subscriberSession disconnect",a.socket),n.info("SfuVideoRoom: Feed "+JSON.stringify(m.config.janusRemoteFeed.rfid)+" ("+JSON.stringify(m.config.janusRemoteFeed.rfdisplay)+") has left the room, detaching"),e.$broadcast("sessionDisconnected",{session:m}),c.onSessionDisconnect(a,m,s.getId())})),m.on("fetchRemoteVideoStreamConstraints",(function(e){c&&c.fetchRemoteVideoStreamConstraints&&c.fetchRemoteVideoStreamConstraints(e.remoteParticipantId)}));m.call((function(){u(m)}),(function(e){n.error("SfuVideoRoom: subscriberSession call errorCallback",e),f(e)}),{attachLocalMedia:!1,attachRemoteMedia:!0})}))})}(i,a,u,p,f).then((function(e){f.onNewSubscriberSession(u,e).then((function(){e.receiveMessage(s)})).catch((function(e){n.warn("SfuVideoRoom: onNewSubscriberSession hangup",u)}))})).catch((function(e){n.error("SfuVideoRoom: WebRTC error",e)})))},iceState:function(e){n.info("SfuVideoRoom: ICE state of this WebRTC PeerConnection (feed #"+JSON.stringify(p.rfdisplay)+") changed to "+JSON.stringify(e))},webrtcState:function(e){n.info("SfuVideoRoom: Janus says this WebRTC PeerConnection (feed #"+JSON.stringify(p.rfdisplay)+") is "+(e?"up":"down")+" now")},onlocalstream:function(e){},onremotestream:function(e){},oncleanup:function(){n.info("SfuVideoRoom: ::: Got a cleanup notification (remote feed "+u.socket+") :::")}})}this.publish=function(u,S){const y=parseInt(u.room),C=parseInt(u.participantId),I=r.retrieve(),b=u.serverName;let T=S.conf;return new Promise((r,w)=>{function A(){o.getAssistboxTokenForJanus(y).then((function(I){let b=I.data.assistboxTokenForJanus;l.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:b,success:function(e){i=e,n.info("SfuVideoRoom: Plugin attached! ("+JSON.stringify(i.getPlugin())+", id="+JSON.stringify(i.getId())+")"),n.info("SfuVideoRoom:  -- This is a publisher/manager");function t(e,t,o,r,a){l.checkVideoRoomExistence(t,o).then((function(t){t?m(e,r,a.callEventId).then((function(){n.info("SfuVideoRoom: Joining video room request has just sent")})).catch((function(e){n.error("SfuVideoRoom joinVideoRoom",e),w(e)})):function(e){let t=e.socket,n=parseInt(e.room);return new Promise((e,o)=>{let r={request:"create",room:parseInt(n),display:t,videoorient_ext:!1};i.send({message:r,success:function(t){"created"===t.videoroom?e():o()},error:function(e){let t=e.errorCode+e.error;o(t)}})})}(e).then((function(){m(e,r,a.callEventId).then((function(){n.info("SfuVideoRoom: Joining video room request has just sent")})).catch((function(){n.error("SfuVideoRoom joinVideoRoom: An error occurred while joining the video room!")}))})).catch((function(e){n.error("SfuVideoRoom createVideoRoom",e),w(e)}))})).catch((function(e){n.error("SfuVideoRoom checkVideoRoomExistence",e),w("An error occurred while checking the video room!")}))}if(S.hasAnyJanusDestroyLock){let e=3;!function o(){S.hasAnyJanusDestroyLock(y).then((function(n){n?(e--,e>0?o():S.destroyLockIsActive()):t(u,y,C,"publisher",S)})).catch((function(e){n.error("SFUVideoRoom hasAnyJanusDestroyLock",e),w("An error occurred while checking the janus destroy lock!")}))}()}else t(u,y,C,"publisher",S)},error:function(e){n.error("SfuVideoRoom: -- Error attaching plugin",e),w(e)},consentDialog:function(e){n.info("SfuVideoRoom: consentDialog event is fired!")},iceState:function(e){n.info("SfuVideoRoom: ICE state changed to",e)},mediaState:function(e,t){n.info("SfuVideoRoom: Janus "+(t?"started":"stopped")+" receiving our",e)},webrtcState:function(e){n.info("SfuVideoRoom: Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(m,I){n.info("SfuVideoRoom ::: Got a message (publisher) ::: ",m);let T=m.videoroom;if(n.info("SfuVideoRoom: Event",T),T)if("joined"===T){if(s=m.id,c=m.private_id,n.info("SfuVideoRoom: Successfully joined room "+JSON.stringify(m.room)+" with ID "+s),function(r,a,s){let c=parseInt(r.room),l=parseInt(r.participantId),u=s.conf;return new Promise((f,p)=>{o.getCoturnToken().then((function(o){let m={isInitiator:!0,turn:{host:u.get("TURN").get("TURN_URL"),username:o.data.username,password:o.data.password},streams:{audio:!0,video:!0},callArchitecture:u.get("CALL").get("CALL_ARCHITECTURE"),ptype:"publisher",roomId:parseInt(c),participantId:l,logger:g,jsonLogger:h,iceTransportPolicy:u.get("MEETING").get("ICE_TRANSPORT_POLICY")},v=new cordova.plugins.phonertc.Session(m);v.on("sendMessage",(function(e){if("offer"==e.type)if(n.info("SfuVideoRoom: Sfu plugin is sending local offer to remote",e),s.onPublisherSessionReady&&i)d.jsep=t.from(JSON.stringify(e)).toString("base64"),d.sessionId=i.session.getSessionId(),d.pluginHandleId=i.getId(),d.encoded=!0,d.psid=a,s.onPublisherSessionReady(d);else if(i){let t={request:"configure",audio:m.streams.audio,video:m.streams.video};i.send({message:t,jsep:e})}if("candidate"==e.type){n.info("SfuVideoRoom: Local candidate is generated ",e);let t={candidate:e.candidate,sdpMLineIndex:e.label,sdpMid:e.id};n.info("SfuVideoRoom: Sfu plugin is sending local candidate to remote",t),i&&i.sendTrickleCandidate(t)}"IceGatheringChange"==e.type&&e.state&&"complete"==e.state.toLowerCase()&&(n.info("SfuVideoRoom: Ice gathering is completed!"),i&&i.sendTrickleCandidate({completed:!0}))})),v.on("iceConnected",(function(){n.info("SfuVideoRoom: Ice connection is established!"),e.$broadcast("iceConnected",{session:v})})),v.on("iceDisconnected",(function(){n.info("SfuVideoRoom: Ice connection is lost!"),e.$broadcast("iceDisconnected",{session:v})})),v.on("disconnect",(function(){n.info("SfuVideoRoom: Disconnecting publisher session."),s&&s.onSessionDisconnect&&s.onSessionDisconnect(r.socket,v),e.$broadcast("sessionDisconnected",{session:v})}));v.call((function(){f(v)}),(function(e){p(e)}),{attachLocalMedia:!0,attachRemoteMedia:!1})})).catch(e=>{n.info("SfuVideoRoom: Get coturn token credentials error!")})})}(u,s,S).then((function(e){a=e,r(e)})).catch((function(e){n.error("SfuVideoRoom publishToVideoRoom",e),w(e)})),m.publishers){let e=m.publishers;n.info("SfuVideoRoom: Got a list of available publishers/feeds",e);for(let t=0;t<e.length;t++){let o=e[t].id,r=e[t].display,i=e[t].audio_codec,a=e[t].video_codec;if(n.info("SfuVideoRoom:  >> ["+JSON.stringify(o)+"] "+JSON.stringify(r)+" (audio: "+JSON.stringify(i)+", video: "+JSON.stringify(a)+")"),n.info("SfuVideoRoom: Before invoke newRemoteFeed with opaqueId="+b+", roomId="+y+", feedId="+o+", userSocket=",r),o&&r){let e=JSON.parse(r);v(b,y,C,o,e,S)}}}}else if("destroyed"===T)S.onDestroyedVideoRoom(),n.info("SfuVideoRoom: The room has been destroyed!");else if("event"===T)if(m.publishers){let e=m.publishers;n.info("SfuVideoRoom: Got a list of available publishers/feeds",e);for(let t=0;t<e.length;t++){let o=e[t].id,r=e[t].display,i=e[t].audio_codec,a=e[t].video_codec;if(n.info("SfuVideoRoom:  >> ["+JSON.stringify(o)+"] "+JSON.stringify(r)+" (audio: "+JSON.stringify(i)+", video: "+JSON.stringify(a)+")"),n.info("SfuVideoRoom: Before invoke newRemoteFeed with opaqueId="+b+", roomId="+y+", feedId="+JSON.stringify(o)+", userSocket",r.socket),o&&r){let e=JSON.parse(r);v(b,y,C,o,e,S)}}}else if(m.leaving){let e=m.leaving,t=m.reason;if(n.info("SFUVideoRoom: Msg=leaving. Publisher left: "+e+" reason "+t),"ok"===e)"kicked"===t?S.onKickedFromRoom&&!f&&S.onKickedFromRoom():S.onPublisherLeft&&!f&&S.onPublisherLeft(),f=!0;else{let t=p.find((function(t){return t===e}));S.onRemotePublisherLeft&&!t&&S.onRemotePublisherLeft(e),t||p.push(e)}}else if(m.unpublished){let e=m.unpublished;if(n.info("SFUVideoRoom: Msg=unpublished. Publisher left",e),"ok"===e)S.onPublisherLeft&&!f&&S.onPublisherLeft(),f=!0;else{let t=p.find((function(t){return t===e}));S.onRemotePublisherLeft&&!t&&S.onRemotePublisherLeft(e),t||p.push(e)}}else m.hangup?n.info("SfuVideoRoom: Hang up received on sfu video room service."):m.error&&(426==m.error_code&&l.janus&&S.onNoSuchRoomError(),n.error("SfuVideoRoom",m.error));I&&(n.info("SfuVideoRoom: Handling SDP as well... ",I),"answer"==I.type&&a.receiveMessage(I));let A=m.result;A&&"done"===A&&n.info("SfuVideoRoom: janus plugin closed the echo test ")},onlocalstream:function(e){n.info("SfuVideoRoom: onlocalstream event is fired!")},onremotestream:function(e){n.info("SfuVideoRoom: onremotestream event is fired!")},oncleanup:function(){n.info("SfuVideoRoom: ::: Got a cleanup notification: we are unpublished now :::")}})})).catch(e=>{n.info("SfuVideoRoom: Get janus token error!")})}function E(e){n.error("SfuVideoRoom: Janus library initialization has failed!",e),w(e)}function _(){a=null,i=null,l.janus=null,c=null,n.info("SfuVideoRoom: Janus library has destroyed!")}Janus.init({appointmentId:y,debug:"all",authToken:I,logger:n,serverName:b,callback:function(){function e(){let e={server:T.get("JANUS").get("JANUS_REST_ENDPOINT"),success:A,error:E,destroyed:_};"T"==T.get("JANUS").get("USE_JANUS_PROXY")?(n.info("SfuVideoRoom: Janus proxy is enabled"),l.janus=new Janus(e)):(n.info("SfuVideoRoom: Janus proxy is disabled"),e.apisecret=T.get("JANUS").get("API_SECRET"),l.janus=new Janus(e))}"F"==T.get("JANUS").get("USE_JANUS_PROXY")&&(d.apisecret=T.get("JANUS").get("API_SECRET")),d.authToken=I,d.hostname=T.get("JANUS").get("HOSTNAME"),d.port=T.get("JANUS").get("PORT"),d.server=T.get("JANUS").get("JANUS_REST_ENDPOINT"),d.serverName=b,S.addJanusInfoToRedis?S.addJanusInfoToRedis(d).then((function(){e()})).catch((function(e){n.error("SFUVideoRoom addJanusInfoToRedis",e),w("An error occurred while add janus info to redis!")})):e()}})})},this.unpublishOwnFeed=function(){if(i){let e={request:"unpublish"};i.send({message:e})}},this.leaveVideoRoom=function(){if(i){let e={request:"leave"};i.send({message:e}),n.info("SFUVideoRoom: leave video room")}},this.destroyVideoRoom=function(e){if(i){let t={request:"destroy",room:parseInt(e)};i.send({message:t})}},this.destroySession=function(){l.janus&&l.janus.destroy(),n.info("SFUVideoRoom: SFU plugin is destroy")},this.checkVideoRoomExistence=function(e,t){return new Promise((t,o)=>{let r={request:"exists",room:parseInt(e)};i.send({message:r,success:function(e){n.info("SfuVideoRoom checkVideoRoomExistence: "+e.exists),"success"===e.videoroom?t(e.exists):o()},error:function(e){o(e)}})})}}n.$inject=["$rootScope","LogService","InternalTokenService","TokenStorage"],e.exports=n}).call(this,n(45).Buffer)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var o=n(47),r=n(48),i=n(49);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,o):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|g(t,n),r=(e=s(e,o)).write(t,n);r!==o&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?s(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function g(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return x(e).length;default:if(o)return j(e).length;t=(""+t).toLowerCase(),o=!0}}function h(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return _(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function v(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,o)),c.isBuffer(t))return 0===t.length?-1:S(e,t,n,o,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):S(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function S(e,t,n,o,r){var i,a=1,s=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var u=-1;for(i=n;i<s;i++)if(l(e,i)===l(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===c)return u*a}else-1!==u&&(i-=i-u),u=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var d=!0,f=0;f<c;f++)if(l(e,i+f)!==l(t,f)){d=!1;break}if(d)return i}return-1}function y(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var a=0;a<o;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function C(e,t,n,o){return V(j(t,e.length-n),e,n,o)}function I(e,t,n,o){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function b(e,t,n,o){return I(e,t,n,o)}function T(e,t,n,o){return V(x(t),e,n,o)}function w(e,t,n,o){return V(function(e,t){for(var n,o,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),o=n>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function A(e,t,n){return 0===t&&n===e.length?o.fromByteArray(e):o.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,a,s,c,l=e[r],u=null,d=l>239?4:l>223?3:l>191?2:1;if(r+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[r+1]))&&(c=(31&l)<<6|63&i)>127&&(u=c);break;case 3:i=e[r+1],a=e[r+2],128==(192&i)&&128==(192&a)&&(c=(15&l)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:i=e[r+1],a=e[r+2],s=e[r+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,o.push(u>>>10&1023|55296),u=56320|1023&u),o.push(u),r+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",o=0;for(;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=4096));return n}(o)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,o){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof o?s(e,t).fill(n,o):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=c.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(o,r),r+=a.length}return o},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):h.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,o,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(o>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(i,a),l=this.slice(o,r),u=e.slice(t,n),d=0;d<s;++d)if(l[d]!==u[d]){i=l[d],a=u[d];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return I(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function R(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function O(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=F(e[i]);return r}function P(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,o,r,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function U(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function N(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function M(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function $(e,t,n,o,i){return i||M(e,0,n,4),r.write(e,t,n,o,23,4),n+4}function D(e,t,n,o,i){return i||M(e,0,n,8),r.write(e,t,n,o,52,8),n+8}c.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;n=new c(r,void 0);for(var i=0;i<r;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},c.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return $(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return $(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!c.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=c.isBuffer(e)?e:j(new c(e,o).toString()),s=a.length;for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var o=e.length,r=null,i=[],a=0;a<o;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function x(e){return o.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(46))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],o=t[1];return 3*(n+o)/4-o},t.toByteArray=function(e){for(var t,n=l(e),o=n[0],a=n[1],s=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),c=0,u=a>0?o-4:o,d=0;d<u;d+=4)t=r[e.charCodeAt(d)]<<18|r[e.charCodeAt(d+1)]<<12|r[e.charCodeAt(d+2)]<<6|r[e.charCodeAt(d+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;2===a&&(t=r[e.charCodeAt(d)]<<2|r[e.charCodeAt(d+1)]>>4,s[c++]=255&t);1===a&&(t=r[e.charCodeAt(d)]<<10|r[e.charCodeAt(d+1)]<<4|r[e.charCodeAt(d+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t);return s},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],a=0,s=n-r;a<s;a+=16383)i.push(u(e,a,a+16383>s?s:a+16383));1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)o[s]=a[s],r[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var r,i,a=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(o[(i=r)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,o,r){var i,a,s=8*r-o-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?r-1:0,f=n?-1:1,p=e[t+d];for(d+=f,i=p&(1<<-u)-1,p>>=-u,u+=s;u>0;i=256*i+e[t+d],d+=f,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=o;u>0;a=256*a+e[t+d],d+=f,u-=8);if(0===i)i=1-l;else{if(i===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,o),i-=l}return(p?-1:1)*a*Math.pow(2,i-o)},t.write=function(e,t,n,o,r,i){var a,s,c,l=8*i-r-1,u=(1<<l)-1,d=u>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=o?0:i-1,g=o?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?f/c:f*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=g,s/=256,r-=8);for(a=a<<r|s,l+=r;l>0;e[n+p]=255&a,p+=g,a/=256,l-=8);e[n+p-g]|=128*h}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){function n(e,t,n){this.noop=function(){},this.call=function(o,r,i,a){return t.info("P2PVideoCallService call fired user: ",r),new Promise((s,c)=>{n.getCoturnToken().then((function(n){console.log((new Date).toString()+": calling to "+r.fullName+", isInitiator: "+o);let l=r.participantId?r.participantId:0,u={isInitiator:o,turn:{host:i.get("TURN").get("TURN_URL"),username:n.data.username,password:n.data.password},streams:{audio:!0,video:!0},callArchitecture:i.get("CALL").get("CALL_ARCHITECTURE"),ptype:"publisher",roomId:parseInt(r.room),iceTransportPolicy:i.get("MEETING").get("ICE_TRANSPORT_POLICY"),remoteParticipantId:parseInt(l)},d=new cordova.plugins.phonertc.Session(u);d.on("sendMessage",(function(e){a&&a.onSendMessage&&a.onSendMessage(e)})),d.on("answer",(function(){a&&a.onSessionAnswer&&a.onSessionAnswer()})),d.on("iceConnected",(function(){t.info("P2PVideoCallService iceConnected"),e.$broadcast("iceConnected",{session:d})})),d.on("iceDisconnected",(function(){t.info("P2PVideoCallService iceDisconnected"),e.$broadcast("iceDisconnected",{session:d})})),d.on("disconnect",(function(){t.info("P2PVideoCallService disconnect"),a&&a.onSessionDisconnect&&a.onSessionDisconnect()})),d.on("peerConnected",(function(){t.info("P2PVideoCallService peerConnected"),e.$broadcast("peerConnected")})),d.on("fetchRemoteVideoStreamConstraints",(function(e){a&&a.fetchRemoteVideoStreamConstraints&&a.fetchRemoteVideoStreamConstraints(e.remoteParticipantId)}));let f=function(){t.info("P2PVideoCallService successCallback"),s(d)},p=function(e){t.error("P2PVideoCallService errorCallback"),c(e)};d.on("sessionCreated",(function(){t.info("P2PVideoCallService sessionCreated");d.call(f,p,{attachLocalMedia:!0,attachRemoteMedia:!0})}))})).catch(e=>{t.error("Get coturn token credentials error!")})})}}n.$inject=["$rootScope","LogService","InternalTokenService"],e.exports=n},function(e,t,n){"use strict";function o(e,t,n){var o;function r(){t.get("$ionicLoading").hide()}return{request:function(e){return e.headers.HideLoadingBar?delete e.headers.HideLoadingBar:(o=!0,t.get("$ionicLoading").show({content:"Loading",animation:"fade-in",showBackdrop:!0})),e},response:function(e){return o=!1,n((function(){o||r()}),1e3),e},responseError:function(t){return r(),e.reject(t)}}}o.$inject=["$q","$injector","$timeout"],e.exports=o},function(e,t,n){"use strict";function o(e){this.findMimeTypeFromFileName=function(t){var n=e.defer();try{$.getJSON("mime_types.json",(function(e){Object.keys(e).forEach((function(e){t===e&&n.resolve(e)}))})).fail((function(){n.reject()}))}catch(e){return n.reject(e)}return n.promise}}o.$inject=["$q"],e.exports=o},function(e,t){function n(e,t,n){this.sendSms=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/messageSenderService/shareLinkViaSms",data:o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.sendMail=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/messageSenderService/shareLinkViaEmail",data:o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getAppointmentById=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/appointmentService/getAppointmentById",data:o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.sendNotification=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/userService/sendNotification/",data:o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getChatMessagesOfAppointment=function(o){var r=n.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/chatMessageService/searchChatMessages",data:o,headers:{HideLoadingBar:!0}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.getDepartmentsByCompanyId=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/departmentService/byCompany/"+o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.findUsersInDepartment=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/departmentService/"+o+"/users",headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e){this.showToastrLongBottom=function(e){let t=-40;"android"==cordova.platformId&&(t=-160),window.plugins.toast.showWithOptions({message:e,duration:"long",position:"bottom",addPixelsY:t},(function(){}),(function(){}))},this.showStyledToastrLongBottom=function(e,t){let n=-40;"android"==cordova.platformId&&(n=-160),window.plugins.toast.showWithOptions({message:e,duration:"long",position:"bottom",addPixelsY:n,styling:t},(function(){}),(function(){}))},this.showToastrLongTop=function(e){window.plugins.toast.showWithOptions({message:e,duration:"long",position:"top",addPixelsY:40},(function(){}),(function(){}))},this.showToastrShortBottom=function(e){let t=-40;"android"==cordova.platformId&&(t=-160),window.plugins.toast.showWithOptions({message:e,duration:"short",position:"bottom",addPixelsY:t},(function(){}),(function(){}))},this.showToastrShortTop=function(e){window.plugins.toast.showWithOptions({message:e,duration:"short",position:"top",addPixelsY:40},(function(){}),(function(){}))},this.showToastrCustom=function(e,t,n,o){window.plugins.toast.showWithOptions({message:e,duration:t,position:n,addPixelsY:o},(function(){}),(function(){}))},this.showErrorToastr=function(t){if(t&&t.data)window.plugins.toast.showWithOptions({message:t.data.errorMessage,duration:"long",position:"bottom",addPixelsY:-40},(function(){}),(function(){}));else{let n=t||e.instant("ASSISTBOX_UNEXPECTED_ERROR");window.plugins.toast.showWithOptions({message:n,duration:"short",position:"bottom",addPixelsY:-40},(function(){}),(function(){}))}}}n.$inject=["$translate"],e.exports=n},function(e,t){function n(e,t){this.findQueuesOfLoggedInUser=function(){const n=t.getPath();return e({method:"GET",url:n+"/rest/api/queueUserMapService/getQueuesOfLoggedInUser"})},this.findQueuesByUsersCompany=function(){const n=t.getPath();return e({method:"GET",url:n+"/rest/api/queueInfoService/findQueuesByUsersCompany"})},this.getAvailableAgentCountForAllQueueWithToken=function(){const n=t.getPath();return e({method:"GET",url:n+"/rest/api/queueInfoService/getAvailableAgentCountForAllQueueWithToken"})},this.getQueueInfo=function(n){const o=t.getPath();return e({method:"GET",url:o+"/rest/api/queueInfoService/"+n})},this.getAvailableAgentCountInQueue=function(){const n=t.getPath();return e({method:"GET",url:n+"/rest/api/queueInfoService/getCountOfAvailableAgentsWithToken",headers:{HideLoadingBar:!0}})}}n.$inject=["$http","ServicePath"],e.exports=n},function(e,t,n){"use strict";e.exports=function(){return{checkBooleanConfiguration:function(e,t){return!(!e.data[t]||"T"!=e.data[t])}}}},function(e,t){function n(e,t,n,o,r,i,a,s){var c;this.handleUserLogin=function(l,u,d,f){c=d,s.getDataFromJwtToken(u).then((function(s){!function(s,l){var u=s.data.userFullName,d=s.data.companyId;if("resume"==l&&(n.$broadcast("applicationResume",c),!a.isEmpty(i.current.name)))return;"CLAIM_HANDLER"===s.data.userRole||"ADMIN"===s.data.userRole?e.getConfigurationsByTypeAndCompanyId("COMPANY",d).then((function(e){if(o.checkBooleanConfiguration(e,"USE_CLICK_TO_CALL")){var n="mobile"+a.getRandomId(),l={fullName:u,socket:"",uuid:n,companyId:d,userId:s.data.userId,companyType:s.data.companyType,userRole:s.data.userRole};i.go("queuePage",{currentUser:l,callQueueId:c},{location:"replace"})}else t.showErrorToastr(r.instant("ASSISTBOX_MISSING_REQUIRED_CONF")),i.go("login",null,{location:"replace"})})).catch((function(e){console.log(e),t.showErrorToastr(e)})):i.go("login",null,{location:"replace"})}(s,f)})).catch((function(e){console.log(e),n.$broadcast("connectionError")}))}}n.$inject=["ConfigurationService","ToastrService","$rootScope","ConfigurationUtil","$translate","$state","StringUtil","TokenService"],e.exports=n},function(e,t){function n(e,t,n,o){this.createClaim=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/claimService/createClaim",data:n}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.updateClaim=function(n){var r=o.getPath(),i=e.defer();return t({method:"post",url:r+"/rest/api/claimService/updateClaim",data:n}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","TokenStorage","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.getHiddenComponentList=function(o){var r=n.getPath(),i=e.defer();return t({method:"GET",url:r+"/rest/api/hiddenComponents/"+o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){var o=n.getPath();this.createAppointmentBinary=function(n){var r=e.defer();return t({method:"POST",url:o+"/rest/api/appointmentBinaryService",data:n,headers:{"Content-Type":"application/json"}}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){var o=n.getPath();this.processMediaFile=function(n){var r=e.defer();return t({method:"PUT",url:o+"/rest/api/mediaProcessingService/"+n,headers:{"Content-Type":"text/plain",HideLoadingBar:!0}}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.getCompany=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/companyService/"+o,headers:{"Content-Type":"application/json"}}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getCompanyLegalDetails=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/companyService/getCompanyLegalDetails/"+o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getVirtualBackgroundImage=function(o){var r=n.getPath(),i=e.defer();return t({method:"get",url:r+"/rest/api/companyService/virtualBackgroundImage/"+o}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},this.getLinkNotificationSettings=function(){var o=n.getPath(),r=e.defer();return t({method:"get",url:o+"/rest/api/companySettingsService/getLinkNotificationSettings"}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(){this.contacts={};let e=this,t=CallState(),n=ParticipationType();this.setContact=function(t){t.participantId=t.participantId?t.participantId:0,e.contacts[t.participantId]=t},this.deleteContact=function(t){let n=t||0;e.contacts[n]&&delete e.contacts[n]},this.setCallState=function(t,n){n.participantId=n.participantId?n.participantId:0,e.contacts[n.participantId]&&(e.contacts[n.participantId].state=t)},this.setParticipationType=function(t,n){let o=t.participantId?t.participantId:0;e.contacts[o].participationType=n},this.findCallingUsers=function(){let n=[];return Object.keys(e.contacts).forEach((function(o){e.contacts[o].state!=t.CALLING&&e.contacts[o].state!=t.CONNECTING&&e.contacts[o].state!=t.INCOMING&&e.contacts[o].state!=t.ANSWERED&&e.contacts[o].state!=t.VOIP||n.push(e.contacts[o])})),n},this.findCallingUserByParticipantId=function(n){let o=n||0;if(Object.keys(e.contacts).length>0&&e.contacts[o]&&(e.contacts[o].state==t.CALLING||e.contacts[o].state==t.CONNECTING||e.contacts[o].state==t.INCOMING||e.contacts[o].state==t.ANSWERED||e.contacts[o].state==t.VOIP))return e.contacts[o]},this.findOtherContacts=function(n){let o=[];return n.participantId=n.participantId?n.participantId:0,Object.keys(e.contacts).forEach((function(r){n.participantId!=r&&e.contacts[r]&&e.contacts[r].state!=t.HANGUP&&o.push(e.contacts[r])})),o},this.findHostContact=function(){return Object.values(e.contacts).find(e=>e.participationType==n.HOST)}}n.$inject=[],e.exports=n},function(e,t){function n(e,t,n,o,r,i,a){var s;const c=1,l=2,u=3,d=4,f=5,p=6;var g,h=o.getCurrentUser();let m,v=1,S=0,y=0;function C(...e){for(const[t,n]of e.entries())e[t]=i.stringify(n);return e.join(", ")}function I(t,n){0!==g&&(null==g||7===g?function(){var t=e.defer();(h=o.getCurrentUser())&&h.companyId?r.getConfigurationByTypeKeyAndCompanyId("CLIENT_LOGGER","LEVEL",h.companyId).then((function(e){200==e.status&&t.resolve(e.data.value),t.reject()})).catch((function(e){t.reject(e)})):setTimeout(()=>{t.resolve(7)},200);return t.promise}().then(e=>{g!=e&&(!function(e){cordova.plugins.phonertc.setNativeLogLevel(e)}(e),g=e),b(t,n)}).catch(e=>{console.error("Log level not retrieved by log service",e)}):b(t,n))}function b(e,t){if(!(e>g))switch(e){case p:T(p,t);break;case f:T(f,t);break;case d:T(d,t);break;case u:T(u,t);break;case l:T(l,t);break;case c:T(c,t)}}function T(e,r){if(!h){if(!o.getCurrentUser())return;h=o.getCurrentUser()}try{let o=new A(e,r);s||(s=n.getPath()),m&&m.connected?function(e){m.send("/app/createLog",w(),JSON.stringify(e))}(o):e<3&&(!function(e){t({method:"POST",url:s+"/rest/api/loggers",data:e,headers:{"Content-Type":"application/json",HideLoadingBar:!0}})}(o),v<3&&(v++,this.connectToSocket(s)))}catch(e){console.log(e)}}function w(){let e={};const t=a.retrieve();return t&&(e["Auth-Token"]=t),e}this.trace=function(...e){console.trace((new Date).toString(),...e),I(p,C(...e))},this.debug=function(...e){console.debug((new Date).toString(),...e),I(f,C(...e))},this.info=function(...e){console.info((new Date).toString(),...e),I(d,C(...e))},this.warn=function(...e){console.warn((new Date).toString(),...e),I(u,C(...e))},this.error=function(...e){console.error((new Date).toString(),...e),I(l,C(...e))},this.critical=function(...e){console.error((new Date).toString(),...e),I(c,C(...e))},this.setAppointmentId=function(e){S=parseInt(e),cordova.plugins.phonertc.setLogAppointmentId(S)},this.setParticipantId=function(e){y=parseInt(e),cordova.plugins.phonertc.setLogParticipantId(y)},this.clearLogLevelAndCurrentUser=function(){g=0,h=void 0},this.connectToSocket=function(e){m=Stomp.client(function(e){let t;t=e.startsWith("https:")?e.replace("https:","wss:"):e.replace("http:","ws:");return t+="/rest/logSocket",t}(e)),m.debug=null,m.connect(w(),(function(e){console.log("Connected: "+e),T(0,"Log socket connected")}),(function(e){let t="Log socket connection error: "+JsonUtil().jsonStringify(e);console.error(t),T(2,t)}))};class A{constructor(e,t){this.level=e,this.message=window.btoa(unescape(encodeURIComponent(t))),this.url=window.btoa(unescape(encodeURIComponent(document.URL))),this.referer=window.btoa(unescape(encodeURIComponent(document.referrer))),this.companyId=h.companyId,this.userId=h.userId?h.userId:0,this.userRole=h.userRole,this.username=h.username?h.username:null,this.appointmentId=S,this.participantId=y,this.encoded=!0}toJSON(){return{level:this.level,message:this.message,url:this.url,referer:this.referer,companyId:this.companyId,userId:this.userId,username:this.username,userRole:this.userRole,appointmentId:this.appointmentId,participantId:this.participantId,encoded:this.encoded}}}return this}n.$inject=["$q","$http","ServicePath","UserService","ConfigurationService","StringUtil","TokenStorage"],e.exports=n},function(e,t){function n(e,t,n){this.deleteAllByUUID=function(o){var r=n.getPath(),i=e.defer();return t({method:"DELETE",url:r+"/rest/api/redisSignalService/"+o.socket+"/"+o.uuid+"/"+o.room+"/"+o.companyId}).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n,o){this.getTokenAsJson=function(){o.getPath();if(null==n.retrieve())return null;var e=n.retrieve();e&&this.getDataFromJwtToken(e).then((function(e){return e}))},this.getDataFromJwtToken=function(e){var n=o.getPath();return t({method:"POST",url:n+"/rest/api/tokenService/getDataFromJwtToken",data:e,headers:{"Content-Type":"text/plain"}})},this.updateGuestTokenForAppointment=function(e,n){var r=o.getPath();return t({method:"PUT",headers:{"Content-Type":"application/json"},url:r+"/rest/api/tokenService/updateGuestTokenForAppointment",data:{token:e,appointmentId:n}})},this.getTokenWithAccessKey=function(e){var n=o.getPath();return t({method:"GET",url:n+"/rest/api/tokenService/getTokenWithAccessKey/"+e})}}n.$inject=["$q","$http","TokenStorage","ServicePath"],e.exports=n},function(e,t){function n(e,t){this.saveMeetingResult=function(n){var o=t.getPath();return request=e({method:"POST",url:o+"/rest/api/meetingResultService",data:n,headers:{"Content-Type":"application/json",HideLoadingBar:!0}})},this.calculateMeetingTime=function(e,t){return e&&t?(t.getTime()-e.getTime())/1e3:0}}n.$inject=["$http","ServicePath"],e.exports=n},function(e,t){function n(e,t){this.maxCommentLength=400,this.createSurveyResult=function(n){var o=t.getPath();return e({method:"post",url:o+"/rest/api/surveyResultService",data:n,headers:{"Content-Type":"application/json"}})}}n.$inject=["$http","ServicePath"],e.exports=n},function(e,t){function n(e,t,n){this.getCoturnToken=function(){let o=n.getPath(),r=e.defer();return t({method:"get",url:o+"/rest/api/internalTokenService/coturn/token"}).then((function(e){r.resolve(e)}),(function(e){r.reject(e)})),r.promise},this.getAssistboxTokenForJanus=function(e){let o=n.getPath();return t({method:"GET",url:o+"/rest/api/internalTokenService/janus/assistboxToken/"+e})}}n.$inject=["$q","$http","ServicePath"],e.exports=n},function(e,t,n){"use strict";function o(e,t){let n=!1;function o(t){if(!n){n=!0;var r=e.instant("ASSISTBOX_PERMISSION_FAILED_TITLE"),i=e.instant("ASSISTBOX_PERMISSION_FAILED"),a=e.instant("ASSISTBOX_CLOSE"),s=e.instant("ASSISTBOX_SETTINGS");navigator.notification.confirm(i,(function(e){n=!1,1==e?cordova.plugins.phonertc.openSettings():t&&o(t)}),r,[s,a])}}this.checkVideoCallPermissions=function(){return new Promise((e,t)=>{cordova.plugins.phonertc.checkVideoCallPermissions(e,(function(){o(!0),t()}))})},this.checkStoragePermissions=function(){return new Promise((e,t)=>{"ios"!==cordova.platformId?cordova.plugins.phonertc.checkStoragePermissions(e,(function(){o(!1),t()})):e()})}}o.$inject=["$translate","$state"],e.exports=o},function(e,t){function n(e,t){this.getFreeswitchServerIpAddress=function(n){let o=t.getPath();return e({method:"GET",url:o+"/rest/api/loadBalancerService/freeswitch/"+n})},this.getJanusGatewayServerName=function(n){let o=t.getPath();return e({method:"GET",url:o+"/rest/api/loadBalancerService/janus/"+n})}}n.$inject=["$http","ServicePath"],e.exports=n}]);